<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-07-23 Thu 16:19 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>bauer: an Emacs+Nix IDE</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Matthew Bauer" />
<meta name="description" content="My Emacs configuration"
 />
<meta name="keywords" content="dotfiles config ide emacs nix bauer" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="https://matthewbauer.us/style.css" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">bauer: an Emacs+Nix IDE
<br />
<span class="subtitle">Bauer’s Automated Unified Emacs Realm</span>
</h1>
<p>
This ORG-mode file generates an Emacs configuration. I am calling it an
<a href="https://www.gnu.org/s/emacs/">Emacs</a>+<a href="https://nixos.org">Nix</a> IDE. That is, the Emacs configuration is <i>integrated</i> with hardcoded
Nix store paths. This provides a kind of functional Emacs configuration. The
integration between Emacs &amp; Nix comes with lots of useful side effects. The raw
Org file can always be downloaded <a href="https://matthewbauer.us/bauer/README.org">here</a>. You can create pull requests &amp; issues on
<a href="https://github.com/matthewbauer/bauer">the GitHub repo</a>. You can access my website at <a href="https://matthewbauer.us">https://matthewbauer.us</a>.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#usage">Usage</a>
<ul>
<li><a href="#install">Installing/upgrading</a></li>
<li><a href="#develop">Developing</a></li>
<li><a href="#nonix">Without Nix</a></li>
</ul>
</li>
<li><a href="#emacs">Emacs init file</a>
<ul>
<li><a href="#orgdd4353b">Increase GC</a></li>
<li><a href="#org2cf7949">Autoloads &amp; Misc.</a></li>
<li><a href="#org3667f9a">Custom config</a></li>
<li><a href="#orgd1f8b3f">Setup use-package</a></li>
<li><a href="#org5730cd0">Key bindings</a></li>
<li><a href="#org9004282">Setup installer</a></li>
<li><a href="#packages">Packages</a></li>
<li><a href="#org67c67c5">END</a></li>
</ul>
</li>
<li><a href="#profiles">Profiles</a>
<ul>
<li><a href="#org00a7650"><code>.profile</code></a></li>
<li><a href="#zshrc"><code>.zshrc</code></a></li>
<li><a href="#orga0a3d19"><code>etc-profile.sh</code></a></li>
</ul>
</li>
<li><a href="#bootstrap">Bootstrapping</a>
<ul>
<li><a href="#site-paths"><code>site-paths.el.in</code></a></li>
<li><a href="#org427435c"><code>bootstrap.sh</code></a></li>
<li><a href="#runemacs"><code>runemacs.sh</code></a></li>
</ul>
</li>
<li><a href="#build">Building</a>
<ul>
<li><a href="#orga13971f"><code>default.nix</code>: the tangler</a></li>
<li><a href="#orgc801148"><code>bauer.nix</code>: the build script</a></li>
<li><a href="#org99fbe76">Invoking it</a></li>
</ul>
</li>
<li><a href="#ci">Continuous integration</a>
<ul>
<li><a href="#travis"><code>.travis.yml</code></a></li>
</ul>
</li>
<li><a href="#extra">Extra</a>
<ul>
<li><a href="#org58c4ecf"><code>update.sh</code></a></li>
<li><a href="#org67d60fb"><code>.gitignore</code></a></li>
<li><a href="#org69868c9"><code>.gitattributes</code></a></li>
<li><a href="#org8b8ccf3"><code>init.el</code></a></li>
<li><a href="#org4388206">NixOS module</a></li>
<li><a href="#orgbbe7aaf">NixOS virtualbox &amp; installer</a></li>
<li><a href="#org72f911d">Deploy script</a></li>
<li><a href="#orgea797ca">Gist script</a></li>
<li><a href="#org83e1fb3">LICENSE</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org0840768" class="outline-2">
<h2 id="usage">Usage</h2>
<div class="outline-text-2" id="text-usage">
</div>

<div id="outline-container-orgfc31080" class="outline-3">
<h3 id="install">Installing/upgrading</h3>
<div class="outline-text-3" id="text-install">
<p>
This is the script that I use to setup all of my new machines but it&rsquo;s portable
enough for anyone to use.
</p>

<p>
To install, just run this command from your shell:
</p>

<div class="org-src-container">
<pre class="src src-shell">curl https://matthewbauer.us/bauer/install | sh
</pre>
</div>

<p>
Once it’s installed, you can open Emacs at any time with this command:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-string">"$HOME/.nix-profile/bin/run"</span>
</pre>
</div>

<p>
If you don&rsquo;t like it, it&rsquo;s also very easy to uninstall. Just run:
</p>

<div class="org-src-container">
<pre class="src src-shell">nix-env -e bauer
nix-collect-garbage -d
</pre>
</div>
</div>
</div>

<div id="outline-container-org7dcdd35" class="outline-3">
<h3 id="develop">Developing</h3>
<div class="outline-text-3" id="text-develop">
<p>
After you’ve installed it, it’s easy to make changes. By default, the
configuration lives in <code>~/.local/share/bauer</code>. To make changes just follow this
process,
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">cd</span> ~/.local/share/bauer
nix-build
./result/run README.org
</pre>
</div>

<p>
The last line will spawn an Emacs frame in the Git repo. Anything in that file
can be change. Once you’ve made a change, just run <code>M-x dev-restart</code> to rebuild
the configuration &amp; restart Emacs. Make any changes you want to <a href="./README.html">the README.org
file</a> or any of the files in <a href="./site-lisp">the site-lisp folder</a>. Make sure you commit your
changes afterward by typing <code>C-c p v</code>, then <code>cc</code>. If you have already forked
<a href="https://github.com/matthewbauer/bauer">this repo on GitHub</a>, you can add it as a remote by typing <code>Mg</code> followed by your
GitHub username within Magit. To push to it, just type <code>Pr</code> then find your
username in the list &amp; press enter. Pull requests are always welcome through
GitHub!
</p>
</div>
</div>

<div id="outline-container-org5c755e2" class="outline-3">
<h3 id="nonix">Without Nix</h3>
<div class="outline-text-3" id="text-nonix">
<p>
You can also use this configuration without Nix. This just gives you the Emacs
configuration without any of the Nix integrations. All of the binaries will have
to be provided externally. To get started, run the following:
</p>

<div class="org-src-container">
<pre class="src src-shell">mv ~/.emacs.d ~/.emacs.d.old
git clone https://github.com/matthewbauer/bauer <span class="org-sh-escaped-newline">\</span>
          ~/.emacs.d
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbbe3735" class="outline-2">
<h2 id="emacs">Emacs init file</h2>
<div class="outline-text-2" id="text-emacs">
<p>
This is the main part of the IDE. It is written in Emacs Lisp &amp; will be loaded
every time Emacs is started.
</p>
</div>

<div id="outline-container-orgdd4353b" class="outline-3">
<h3 id="orgdd4353b">Increase GC</h3>
<div class="outline-text-3" id="text-orgdd4353b">
<p>
Increasing GC is a common way to speed up Emacs. <code>gc-cons-threshold</code> sets at
what point Emacs should invoke its garbage collector Some people set it to a
really larger number permanently. This works well until the garbage is actually
collected (then you have to wait a long time). I’ve decided to just set it
temporarily to a large number so we only garbage collect once on startup. After
that we reset it to the standard value. Read <a href="http://bling.github.io/blog/2016/01/18/why-are-you-changing-gc-cons-threshold/">@bling’s post</a> for more info on
this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">-*- mode: emacs-lisp; coding: utf-8; -*-</span>

(<span class="org-keyword">defvar</span> <span class="org-variable-name">file-name-handler-alist-backup</span>
        file-name-handler-alist)
(<span class="org-keyword">setq</span> gc-cons-threshold most-positive-fixnum
      file-name-handler-alist nil)
(add-hook 'after-init-hook
  (<span class="org-keyword">lambda</span> ()
    (garbage-collect)
    (<span class="org-keyword">setq</span> gc-cons-threshold
            (car (get 'gc-cons-threshold 'standard-value))
      file-name-handler-alist
        (append
          file-name-handler-alist-backup
          file-name-handler-alist))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2cf7949" class="outline-3">
<h3 id="org2cf7949">Autoloads &amp; Misc.</h3>
<div class="outline-text-3" id="text-org2cf7949">
<p>
Setup some initial aliases for Emacs. These give us an easy way to use these
functions without actually require&rsquo;ing them. Ideally, Emacs should pick these up
through the automatic autoloading method, but that sometimes conflicts with the
compiling phases used later.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">eval-and-compile</span>
  (autoload 'package-installed-p <span class="org-string">"package"</span>)
  (autoload 'use-package-autoload-keymap <span class="org-string">"use-package"</span>)
  (autoload 'pcomplete-arg <span class="org-string">"pcomplete"</span>)
  (autoload 'pcomplete--here <span class="org-string">"pcomplete"</span>)
  (autoload 'tramp-tramp-file-p <span class="org-string">"tramp"</span>)
  (autoload 'tramp-dissect-file-name <span class="org-string">"tramp"</span>)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">view-mode-map</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">iso-transl-ctl-x-8-map</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">dired-mode-map</span>))
</pre>
</div>

<p>
When we are within a terminal we want to be able to use the mouse, so
<code>xterm-mouse-mode</code> is enabled here.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">unless</span> (display-graphic-p)
  (xterm-mouse-mode 1))
</pre>
</div>

<p>
Hack to avoid tty-run-terminal-initialization on non-graphical Emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">unless</span> (display-graphic-p)
  (advice-add #'tty-run-terminal-initialization <span class="org-builtin">:override</span> #'ignore)
  (add-hook 'window-setup-hook
    (<span class="org-keyword">lambda</span> ()
      (advice-remove #'tty-run-terminal-initialization #'ignore)
      (tty-run-terminal-initialization (selected-frame) nil t))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3667f9a" class="outline-3">
<h3 id="org3667f9a">Custom config</h3>
<div class="outline-text-3" id="text-org3667f9a">
<p>
<a href="./lisp/set-defaults.el">set-defaults</a> provides an easy way to override the default custom files. This
means that when you customize a variable it will appear as ‘standard’ even
though it’s not what the package originally defined as the default. This is
useful for an Emacs distribution to provide <i>better defaults</i> while still
letting the user override them. Look through the lispdoc of the package for
documentation on how this works. Eventually, this will be added to MELPA for use
in other Emacs distributions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">set-defaults</span>)
</pre>
</div>
</div>

<div id="outline-container-org630e34a" class="outline-4">
<h4 id="org630e34a">Better defaults</h4>
<div class="outline-text-4" id="text-org630e34a">
<p>
These are some <b>better</b> defaults for Emacs. They shouldn’t require any packages
to be installed to work (those go in use-package). In addition, they should take
almost no time to run (meaning they probably shouldn’t have custom init hooks).
The format of arguments to <code>set-defaults</code> is identical to the one used by
<code>custom-set-variables</code>.
</p>

<table id="org7c46545" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Default Variable</th>
<th scope="col" class="org-left">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">TeX-auto-save</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">TeX-auto-untabify</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">TeX-electric-escape</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">TeX-parse-self</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">ad-redefinition-action</td>
<td class="org-left">&rsquo;accept</td>
</tr>

<tr>
<td class="org-left">apropos-do-all</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">async-shell-command-buffer</td>
<td class="org-left">&rsquo;new-buffer</td>
</tr>

<tr>
<td class="org-left">auth-source-save-behavior</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">auto-revert-check-vc-info</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">auto-revert-interval</td>
<td class="org-left">2</td>
</tr>

<tr>
<td class="org-left">auto-revert-verbose</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">backward-delete-char-untabify-method</td>
<td class="org-left">&rsquo;hungry</td>
</tr>

<tr>
<td class="org-left">bookmark-save-flag</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">checkdoc-spellcheck-documentation-flag</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">comint-input-ignoredups</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">comint-process-echoes</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">comint-prompt-read-only</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">comint-scroll-to-bottom-on-input</td>
<td class="org-left">&rsquo;this</td>
</tr>

<tr>
<td class="org-left">company-require-match</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">company-selection-wrap-around</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">compilation-always-kill</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">compilation-ask-about-save</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">compilation-skip-threshold</td>
<td class="org-left">2</td>
</tr>

<tr>
<td class="org-left">completions-cycle-threshold</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">completions-format</td>
<td class="org-left">&rsquo;vertical</td>
</tr>

<tr>
<td class="org-left">cursor-in-non-selected-windows</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">custom-safe-themes</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">custom-search-field</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">delete-by-moving-to-trash</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">delete-old-versions</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">dired-hide-details-hide-symlink-targets</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">dired-omit-verbose</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">dired-recursive-copies</td>
<td class="org-left">&rsquo;top</td>
</tr>

<tr>
<td class="org-left">dired-recursive-deletes</td>
<td class="org-left">&rsquo;top</td>
</tr>

<tr>
<td class="org-left">dtrt-indent-verbosity</td>
<td class="org-left">0</td>
</tr>

<tr>
<td class="org-left">eldoc-idle-delay</td>
<td class="org-left">0.4</td>
</tr>

<tr>
<td class="org-left">eshell-bad-command-tolerance</td>
<td class="org-left">1</td>
</tr>

<tr>
<td class="org-left">eshell-cmpl-autolist</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">eshell-cmpl-cycle-completions</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">eshell-cmpl-cycle-cutoff-length</td>
<td class="org-left">2</td>
</tr>

<tr>
<td class="org-left">eshell-cmpl-ignore-case</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">eshell-cp-overwrite-files</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">eshell-default-target-is-dot</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">eshell-destroy-buffer-when-process-dies</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">eshell-hist-ignoredups</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">eshell-list-files-after-cd</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">eshell-review-quick-commands</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">eshell-save-history-on-exit</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">eshell-scroll-show-maximum-output</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">eshell-stringify</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">eshell-visual-options</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">eval-expression-print-level</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">frame-inhibit-implied-resize</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">flycheck-emacs-lisp-load-path</td>
<td class="org-left">&rsquo;inherit</td>
</tr>

<tr>
<td class="org-left">flycheck-standard-error-navigation</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">flymake-no-changes-timeout</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">flymake-start-syntax-check-on-newline</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">flyspell-highlight-properties</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">flyspell-issue-welcome-flag</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">fortune-always-compile</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">haskell-process-check-cabal-config-on-load</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">haskell-process-suggest-add-package</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">haskell-process-suggest-haskell-docs-imports</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">haskell-process-suggest-hoogle-imports</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">haskell-process-suggest-language-pragmas</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">haskell-process-suggest-no-warn-orphans</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">haskell-process-suggest-overloaded-strings</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">haskell-process-suggest-restart</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">help-window-select</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">history-delete-duplicates</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">ibuffer-default-display-maybe-show-predicates</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">ibuffer-expert</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">ibuffer-show-empty-filter-groups</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">ibuffer-shrink-to-minimum-size</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">ibuffer-use-other-window</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">imenu-auto-rescan</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">indicate-empty-lines</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">indent-tabs-mode</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">ispell-quietly</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">ispell-silently-savep</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">js2-mode-show-parse-errors</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">js2-mode-show-strict-warnings</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">js2-strict-missing-semi-warning</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">kill-do-not-save-duplicates</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">kill-whole-line</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">line-spacing</td>
<td class="org-left">0.1</td>
</tr>

<tr>
<td class="org-left">load-prefer-newer</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">mac-allow-anti-aliasing</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">mac-command-key-is-meta</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">mac-command-modifier</td>
<td class="org-left">&rsquo;meta</td>
</tr>

<tr>
<td class="org-left">mac-option-key-is-meta</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">mac-option-modifier</td>
<td class="org-left">&rsquo;super</td>
</tr>

<tr>
<td class="org-left">mac-right-option-modifier</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">magit-clone-set-remote.pushDefault</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">magit-log-auto-more</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">magit-remote-add-set-remote.pushDefault</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">magit-save-repository-buffers</td>
<td class="org-left">&rsquo;dontask</td>
</tr>

<tr>
<td class="org-left">mmm-submode-decoration-level</td>
<td class="org-left">2</td>
</tr>

<tr>
<td class="org-left">mode-line-default-help-echo</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">next-error-recenter</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">ns-function-modifier</td>
<td class="org-left">&rsquo;hyper</td>
</tr>

<tr>
<td class="org-left">ns-pop-up-frames</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">nsm-save-host-names</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">nxml-sexp-element-flag</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">nxml-slash-auto-complete-flag</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">org-confirm-babel-evaluate</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">org-export-with-toc</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">org-html-htmlize-output-type</td>
<td class="org-left">&rsquo;css</td>
</tr>

<tr>
<td class="org-left">org-log-done</td>
<td class="org-left">&rsquo;time</td>
</tr>

<tr>
<td class="org-left">org-special-ctrl-a/e</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">org-support-shift-select</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">projectile-ignored-project-function</td>
<td class="org-left">&rsquo;file-remote-p</td>
</tr>

<tr>
<td class="org-left">projectile-require-project-root</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">projectile-switch-project-action</td>
<td class="org-left">&rsquo;projectile-dired</td>
</tr>

<tr>
<td class="org-left">projectile-verbose</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">proof-auto-action-when-deactivating-scripting</td>
<td class="org-left">&rsquo;retract</td>
</tr>

<tr>
<td class="org-left">proof-autosend-enable</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">proof-electric-terminator-enable</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">proof-fast-process-buffer</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">proof-script-fly-past-comments</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">proof-shell-fiddle-frames</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">proof-splash-enable</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">proof-sticky-errors</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">proof-tidy-response</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">resize-mini-windows</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">revert-without-query</td>
<td class="org-left">&rsquo;(&ldquo;.&rdquo;)</td>
</tr>

<tr>
<td class="org-left">ruby-insert-encoding-magic-comment</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">save-abbrevs</td>
<td class="org-left">&rsquo;silently</td>
</tr>

<tr>
<td class="org-left">save-interprogram-paste-before-kill</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">scroll-conservatively</td>
<td class="org-left">101</td>
</tr>

<tr>
<td class="org-left">scroll-preserve-screen-position</td>
<td class="org-left">&rsquo;always</td>
</tr>

<tr>
<td class="org-left">sentence-end-double-space</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">set-mark-command-repeat-pop</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">sh-learn-basic-offset</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">shell-completion-execonly</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">shell-input-autoexpand</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">sp-autoskip-closing-pair</td>
<td class="org-left">&rsquo;always</td>
</tr>

<tr>
<td class="org-left">sp-highlight-pair-overlay</td>
<td class="org-left">nil</td>
</tr>

<tr>
<td class="org-left">tab-always-indent</td>
<td class="org-left">&rsquo;complete</td>
</tr>

<tr>
<td class="org-left">tags-add-tables</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">tags-revert-without-query</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">term-input-autoexpand</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">term-input-ignoredups</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">text-quoting-style</td>
<td class="org-left">&rsquo;quote</td>
</tr>

<tr>
<td class="org-left">tls-checktrust</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">undo-limit</td>
<td class="org-left">800000</td>
</tr>

<tr>
<td class="org-left">undo-strong-limit</td>
<td class="org-left">12000000</td>
</tr>

<tr>
<td class="org-left">undo-outer-limit</td>
<td class="org-left">120000000</td>
</tr>

<tr>
<td class="org-left">undo-tree-auto-save-history</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">uniquify-buffer-name-style</td>
<td class="org-left">&rsquo;forward</td>
</tr>

<tr>
<td class="org-left">use-package-always-defer</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">vc-allow-async-revert</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">vc-command-messages</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">vc-make-backup-files</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">version-control</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">view-read-only</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">whitespace-line-column</td>
<td class="org-left">120</td>
</tr>

<tr>
<td class="org-left">which-key-idle-delay</td>
<td class="org-left">0.4</td>
</tr>

<tr>
<td class="org-left">which-key-idle-secondary-delay</td>
<td class="org-left">0.4</td>
</tr>

<tr>
<td class="org-left">woman-imenu</td>
<td class="org-left">t</td>
</tr>

<tr>
<td class="org-left">x-stretch-cursor</td>
<td class="org-left">t</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(apply 'set-defaults
       (mapcar (<span class="org-keyword">lambda</span> (x) (list (intern (car x))
                                 (<span class="org-keyword">if</span> (stringp (cadr x))
                                     (car (read-from-string (cadr x)))
                                   (cadr x)))) <span class="org-warning">defaults))</span>
</pre>
</div>

<p>
Misc. defaults that don’t fit above. TODO: move these above.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (file-exists-p user-emacs-directory)
  (make-directory (expand-file-name <span class="org-string">"auto-save/"</span> user-emacs-directory) t)
  (make-directory (expand-file-name <span class="org-string">"backup/"</span> user-emacs-directory) t)
  (make-directory (expand-file-name <span class="org-string">"undo-tree/"</span> user-emacs-directory) t))

(set-defaults
 '(auto-save-file-name-transforms `((<span class="org-string">".*"</span>
                                     ,(expand-file-name <span class="org-string">"auto-save/"</span>
                                                        user-emacs-directory) <span class="org-warning">t)))</span>
 '(bug-reference-bug-regexp
   (concat <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[Ii]ssue </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[Ff]ixe[ds] </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[Rr]esolve[ds]? </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[Cc]lose[ds]?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">"</span>
           <span class="org-string">"[Pp]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">ull [Rr]equest</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[Rr]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">(</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">#</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">)?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>))
 '(backup-directory-alist `((<span class="org-string">".*"</span> .
                             ,(expand-file-name <span class="org-string">"backup/"</span>
                                                user-emacs-directory))))
 '(company-auto-complete (<span class="org-keyword">lambda</span> ()
                           (<span class="org-keyword">and</span> (company-tooltip-visible-p)
                                (company-explicit-action-p))))
 '(company-continue-commands
   '(not save-buffer
         save-some-buffers
         save-buffers-kill-terminal
         save-buffers-kill-emacs
         comint-previous-matching-input-from-input
         comint-next-matching-input-from-input
         completion-at-point))
 '(company-backends '(company-elisp
                      company-css
                      company-cmake
                      company-nxml
                      (company-capf
                       company-files
                       company-keywords
                       company-dabbrev-code)
                      company-dabbrev))
 '(comint-password-prompt-regexp (concat
                                  <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">"</span>
                                  (regexp-opt
                                   '(<span class="org-string">"Enter"</span> <span class="org-string">"enter"</span> <span class="org-string">"Enter same"</span> <span class="org-string">"enter same"</span> <span class="org-string">"Enter the"</span> <span class="org-string">"enter the"</span>
                                     <span class="org-string">"Enter Auth"</span> <span class="org-string">"Old"</span> <span class="org-string">"old"</span> <span class="org-string">"New"</span> <span class="org-string">"new"</span> <span class="org-string">"'s"</span> <span class="org-string">"login"</span>
                                     <span class="org-string">"Kerberos"</span> <span class="org-string">"CVS"</span> <span class="org-string">"UNIX"</span> <span class="org-string">" SMB"</span> <span class="org-string">"LDAP"</span> <span class="org-string">"PEM"</span> <span class="org-string">"SUDO"</span>
                                     <span class="org-string">"[sudo]"</span> <span class="org-string">"Repeat"</span> <span class="org-string">"Bad"</span> <span class="org-string">"Retype"</span>)
                                   t)
                                  <span class="org-comment-delimiter">;; </span><span class="org-comment">Allow for user name to precede password equivalent (Bug#31075).</span>
                                  <span class="org-string">" +.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
                                  <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">"</span> (regexp-opt password-word-equivalents) <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">Response</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
                                  <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">, try</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">? *again</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string"> (empty for no passphrase)</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string"> (again)</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?"</span>
                                  <span class="org-comment-delimiter">;; </span><span class="org-comment">"[[:alpha:]]" used to be "for", which fails to match non-English.</span>
                                  <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string"> [[:alpha:]]+ .+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?[[:blank:]]*[:&#65306;&#6102;][[:blank:]]*\\'"</span>))
 '(compilation-environment '(<span class="org-string">"TERM=xterm-256color"</span>))
 '(completion-styles '(basic
                       partial-completion
                       emacs22
                       substring))
 '(custom-file (expand-file-name
                <span class="org-string">"settings.el"</span>
                user-emacs-directory))
 '(dired-listing-switches <span class="org-string">"-alhv"</span>)
 '(dired-omit-files <span class="org-string">"^\\.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^#.*#$"</span>)
 '(dirtrack-list '(<span class="org-string">"^[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]*:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">\e\\[[0-9]+m</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">$#\e]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> 1))
 '(eshell-banner-message <span class="org-string">""</span>)
 '(eshell-ls-dired-initial-args '(<span class="org-string">"-h"</span>))
 '(eshell-ls-initial-args <span class="org-string">"-h"</span>)
 '(eshell-prompt-function
   (<span class="org-keyword">lambda</span> ()
     (concat (<span class="org-keyword">when</span> (tramp-tramp-file-p default-directory)
               (concat
                (tramp-file-name-user
                 (tramp-dissect-file-name default-directory))
                <span class="org-string">"@"</span>
                (tramp-file-name-host
                 (tramp-dissect-file-name default-directory))
                <span class="org-string">" "</span>))
             (<span class="org-keyword">let</span> ((dir (eshell/pwd)))
               (<span class="org-keyword">if</span> (string= dir (getenv <span class="org-string">"HOME"</span>)) <span class="org-string">"~"</span>
                 (<span class="org-keyword">let</span> ((dirname (file-name-nondirectory dir)))
                   (<span class="org-keyword">if</span> (string= dirname <span class="org-string">""</span>) <span class="org-string">"/"</span> dirname))))
             (<span class="org-keyword">if</span> (= (user-uid) 0) <span class="org-string">" # "</span> <span class="org-string">" $ "</span>))))
 '(eshell-visual-commands
   '(<span class="org-string">"vi"</span> <span class="org-string">"screen"</span> <span class="org-string">"top"</span> <span class="org-string">"less"</span> <span class="org-string">"more"</span> <span class="org-string">"lynx"</span> <span class="org-string">"ncftp"</span> <span class="org-string">"pine"</span> <span class="org-string">"tin"</span>
     <span class="org-string">"trn"</span> <span class="org-string">"elm"</span> <span class="org-string">"ssh"</span> <span class="org-string">"mutt"</span> <span class="org-string">"tmux"</span> <span class="org-string">"htop"</span>
     <span class="org-string">"alsamixer"</span> <span class="org-string">"watch"</span> <span class="org-string">"elinks"</span> <span class="org-string">"links"</span> <span class="org-string">"nethack"</span> <span class="org-string">"vim"</span>
     <span class="org-string">"cmus"</span> <span class="org-string">"nmtui"</span> <span class="org-string">"nmtui-connect"</span> <span class="org-string">"nmtui-edit"</span> <span class="org-string">"ncdu"</span>
     <span class="org-string">"telnet"</span> <span class="org-string">"rlogin"</span>))
 '(eshell-visual-subcommands '((<span class="org-string">"vagrant"</span> <span class="org-string">"ssh"</span>)))
 '(find-ls-option '(<span class="org-string">"-print0 | xargs -P4 -0 ls -ldN"</span> . <span class="org-string">"-ldN"</span>))
 '(find-ls-subdir-switches <span class="org-string">"-ldN"</span>)
 '(flycheck-global-modes '(not erc-mode
                               message-mode
                               git-commit-mode
                               view-mode
                               outline-mode
                               text-mode
                               org-mode))
 '(flycheck-check-syntax-automatically '(save mode-enabled))
 '(frame-title-format
   '(<span class="org-builtin">:eval</span>
     (<span class="org-keyword">if</span> (buffer-file-name)
         (abbreviate-file-name (buffer-file-name))
       <span class="org-string">"%b"</span>)))
 '(haskell-compile-cabal-build-command <span class="org-string">"cabal new-build"</span>)
 '(haskell-hoogle-url <span class="org-string">"https://hoogle.haskell.org/?hoogle=%s"</span>)
 '(ibuffer-formats
   '((mark modified read-only <span class="org-string">" "</span> (name 16 -1) <span class="org-string">" "</span>
           (size 6 -1 <span class="org-builtin">:right</span>) <span class="org-string">" "</span> (mode 16 16) <span class="org-string">" "</span> filename)
     (mark <span class="org-string">" "</span> (name 16 -1) <span class="org-string">" "</span> filename)))
 '(ibuffer-never-show-predicates '(<span class="org-string">"\\*magit-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">diff</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">process</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:"</span>))
 '(ispell-extra-args '(<span class="org-string">"--sug-mode=ultra"</span>))
 '(magit-blame-disable-modes '(fci-mode view-mode yascroll-bar-mode))
 '(magit-process-find-password-functions
   '(magit-process-password-auth-source))
 '(magit-process-password-prompt-regexps '(
                                           <span class="org-string">"^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">Enter </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?[Pp]assphrase</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> for </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">RSA </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?key '.*'</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?: ?$"</span>
                                           <span class="org-string">"^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">Enter </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?[Pp]assword</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> for '?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">https?://</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?99:</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">']*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">'?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?: ?$"</span>
                                           <span class="org-string">"Please enter the passphrase for the ssh key"</span>
                                           <span class="org-string">"Please enter the passphrase to unlock the OpenPGP secret key"</span>
                                           <span class="org-string">"^.*'s password: ?$"</span>
                                           <span class="org-string">"^Yubikey for .*: ?$"</span>
                                           <span class="org-string">"^Enter PIN for .*: ?$"</span>
                                           <span class="org-string">"^\\[</span><span class="org-string"><span class="org-constant">sudo\\</span></span><span class="org-string">] password for .*: ?$"</span>))
 '(mouse-wheel-scroll-amount '(1
                               ((shift) . 5)
                               ((control))))
 '(minibuffer-prompt-properties
   '(read-only t
               cursor-intangible t
               face minibuffer-prompt))
 '(org-latex-listings-langs
   '((emacs-lisp <span class="org-string">"Lisp"</span>)
     (lisp <span class="org-string">"Lisp"</span>)
     (clojure <span class="org-string">"Lisp"</span>)
     (c <span class="org-string">"C"</span>)
     (cc <span class="org-string">"C++"</span>)
     (fortran <span class="org-string">"fortran"</span>)
     (perl <span class="org-string">"Perl"</span>)
     (cperl <span class="org-string">"Perl"</span>)
     (python <span class="org-string">"Python"</span>)
     (ruby <span class="org-string">"Ruby"</span>)
     (html <span class="org-string">"HTML"</span>)
     (xml <span class="org-string">"XML"</span>)
     (tex <span class="org-string">"TeX"</span>)
     (latex <span class="org-string">"[LaTeX]TeX"</span>)
     (shell-script <span class="org-string">"bash"</span>)
     (gnuplot <span class="org-string">"Gnuplot"</span>)
     (ocaml <span class="org-string">"Caml"</span>)
     (caml <span class="org-string">"Caml"</span>)
     (sql <span class="org-string">"SQL"</span>)
     (sqlite <span class="org-string">"sql"</span>)
     (makefile <span class="org-string">"make"</span>)
     (R <span class="org-string">"r"</span>)
     (nix <span class="org-string">"{}"</span>)
     (nil <span class="org-string">"{}"</span>)
     (yaml <span class="org-string">"{}"</span>)
     (gitattributes <span class="org-string">"{}"</span>)
     (gitignore <span class="org-string">"{}"</span>)
     (shell <span class="org-string">"{}"</span>)
     (gitconfig <span class="org-string">"{}"</span>)))
 '(org-latex-default-packages-alist
   '((<span class="org-string">"utf8"</span> <span class="org-string">"inputenc"</span> t
      (<span class="org-string">"pdflatex"</span>))
     (<span class="org-string">"T1"</span> <span class="org-string">"fontenc"</span> t
      (<span class="org-string">"pdflatex"</span>))
     (<span class="org-string">""</span> <span class="org-string">"graphicx"</span> t nil)
     (<span class="org-string">""</span> <span class="org-string">"grffile"</span> t nil)
     (<span class="org-string">""</span> <span class="org-string">"longtable"</span> nil nil)
     (<span class="org-string">""</span> <span class="org-string">"wrapfig"</span> nil nil)
     (<span class="org-string">""</span> <span class="org-string">"rotating"</span> nil nil)
     (<span class="org-string">"normalem"</span> <span class="org-string">"ulem"</span> t nil)
     (<span class="org-string">""</span> <span class="org-string">"amsmath"</span> t nil)
     (<span class="org-string">""</span> <span class="org-string">"textcomp"</span> t nil)
     (<span class="org-string">""</span> <span class="org-string">"amssymb"</span> t nil)
     (<span class="org-string">""</span> <span class="org-string">"capt-of"</span> nil nil)
     (<span class="org-string">""</span> <span class="org-string">"hyperref"</span> nil nil)
     (<span class="org-string">""</span> <span class="org-string">"parskip"</span> nil nil)
     (<span class="org-string">""</span> <span class="org-string">"alltt"</span> nil nil)
     (<span class="org-string">""</span> <span class="org-string">"upquote"</span> nil nil)
     (<span class="org-string">""</span> <span class="org-string">"listings"</span> nil nil)))
 '(package-archives
   '((<span class="org-string">"melpa"</span> . <span class="org-string">"https://melpa.org/packages/"</span>)
     (<span class="org-string">"org"</span> . <span class="org-string">"http://orgmode.org/elpa/"</span>)
     (<span class="org-string">"gnu"</span> . <span class="org-string">"https://elpa.gnu.org/packages/"</span>)))
 '(projectile-globally-ignored-files '(<span class="org-string">".DS_Store"</span> <span class="org-string">"TAGS"</span>))
 '(projectile-ignored-project-function
   (<span class="org-keyword">lambda</span> (file) (<span class="org-keyword">or</span> (file-remote-p file)
                      (string-prefix-p <span class="org-string">"/nix"</span> file)
                      (string-prefix-p <span class="org-string">"/nix/store"</span> file)
                      (string-suffix-p <span class="org-string">"/.local/share/Trash/files/"</span> file))))
 '(projectile-mode-line-prefix <span class="org-string">""</span>)
 '(projectile-mode-line-function
   (<span class="org-keyword">lambda</span> () (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (<span class="org-keyword">ignore-errors</span> (projectile-project-p))
                       (not (file-remote-p default-directory)))
                  (format <span class="org-string">" Projectile[%s]"</span> (projectile-project-name))
                <span class="org-string">""</span>)))
 '(savehist-additional-variables '(search-ring
                                   regexp-search-ring
                                   kill-ring
                                   comint-input-ring
                                   kmacro-ring
                                   sr-history-registry
                                   file-name-history
                                   tablist-name-filter))
 '(tab-stop-list (number-sequence 4 200 4))
 '(tramp-default-proxies-alist
   '(((regexp-quote (system-name)) nil nil)
     (nil <span class="org-string">"\\`</span><span class="org-string"><span class="org-constant">root\\</span></span><span class="org-string">'"</span> <span class="org-string">"/ssh:%h:"</span>)
     (<span class="org-string">".*"</span> <span class="org-string">"\\`</span><span class="org-string"><span class="org-constant">root\\</span></span><span class="org-string">'"</span> <span class="org-string">"/ssh:%h:"</span>)))
 '(uniquify-ignore-buffers-re <span class="org-string">"^\\*"</span>)
 '(uniquify-separator <span class="org-string">"/"</span>)
 '(undo-tree-mode-lighter <span class="org-string">""</span>)
 '(undo-tree-history-directory-alist
   `((<span class="org-string">".*"</span> . ,(expand-file-name <span class="org-string">"undo-tree/"</span> user-emacs-directory))))
 '(vc-git-diff-switches '(<span class="org-string">"-w"</span> <span class="org-string">"-U3"</span>))
 '(vc-ignore-dir-regexp
   (concat <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\`"</span>
           <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[\\/][\\/][</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\/]+[\\/]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">/"</span>
           <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">net</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">afs</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\.\\.\\.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
           <span class="org-string">"\\'</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\`/[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/|:][</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/|]*:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\"</span>
           <span class="org-string">"(\\`/[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/|:][</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">/|]*:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>))
 '(which-key-lighter <span class="org-string">""</span>)
 '(whitespace-action '(cleanup))
 '(whitespace-style '(face trailing lines space-before-tab
                           empty lines-style))
 '(whitespace-global-modes '(not erc-mode ses-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2120457" class="outline-4">
<h4 id="org2120457">Site paths</h4>
<div class="outline-text-4" id="text-org2120457">
<p>
Now, pull in generated paths from <code>site-paths.el</code>. Nix will generate this file
automatically for us &amp; different Emacs variables will be set to their Nix
store derivation paths. Everything should work fine if you don’t have this
available, though. If you are in Emacs &amp; already have the IDE installed you
can inspect this file by typing <code>C-h C-l site-paths</code>. It will look similar to a
<code>settings.el</code> file where each line corresponds to a customizable variable.
Unlike <code>settings.el</code>, each entry is path in the Nix store &amp; we verify it
exists before setting it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(load <span class="org-string">"site-paths"</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2857abf" class="outline-4">
<h4 id="org2857abf">Set environment</h4>
<div class="outline-text-4" id="text-org2857abf">
<p>
<code>set-envs</code> is provided by <a href="./lisp/set-defaults.el">set-defaults</a>. We can use it like
<code>custom-set-variables</code>, just it calls <code>setenv</code> instead of <code>setq</code>. All of
these entries correspond to environment variables that we want to always be
set in the Emacs process.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-envs
 '(<span class="org-string">"EDITOR"</span> <span class="org-string">"emacsclient -a emacs"</span>)
 '(<span class="org-string">"NODE_NO_READLINE"</span> <span class="org-string">"1"</span>)
 '(<span class="org-string">"PAGER"</span> <span class="org-string">"cat"</span>)
 '(<span class="org-string">"PS1"</span> <span class="org-string">"\\W &gt; "</span>)
 )
</pre>
</div>

<p>
Fix broken Git on Windows.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (eq window-system 'w32)
  (setenv <span class="org-string">"GIT_ASKPASS"</span> <span class="org-string">"git-gui--askpass"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef2a42b" class="outline-4">
<h4 id="orgef2a42b">Load custom file</h4>
<div class="outline-text-4" id="text-orgef2a42b">
<p>
This file allows users to override the above defaults. This will mean you
can use custom as you normally would in vanilla Emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(load custom-file t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd1f8b3f" class="outline-3">
<h3 id="orgd1f8b3f">Setup use-package</h3>
<div class="outline-text-3" id="text-orgd1f8b3f">
<p>
<a href="https://github.com/jwiegley/use-package">use-package</a> is an Emacs package by John Weigley allowing users to easily
configure other Emacs packages. It’s quite useful &amp; it will be used
extensively in this project.
</p>

<p>
Now to get <code>use-package</code> we will require <code>package.el</code> &amp; initialize it if
site-paths is not setup (meaning we’re outside the Nix expression). Because
site-paths should be available (unless you don’t have Nix), we can skip this
step. All of this is marked ‘eval-and-compile’ to make sure the compiler picks
it up on build phase.
</p>

<p>
So, there are basically two modes for using this configuration. One when
packages are installed externally (through Nix) &amp; another where they are
installed internally. This is captured in the variable ‘needs-package-init’
which will be t when we want to use the builtin package.el &amp; will be nil when
we want to just assume everything is available.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">eval-and-compile</span>
  (<span class="org-keyword">setq</span> needs-package-init
        (<span class="org-keyword">and</span> (not (locate-library <span class="org-string">"site-paths"</span>))
                 (not (<span class="org-keyword">and</span>
                    (boundp 'use-package-list--is-running)
                    use-package-list--is-running)))))
</pre>
</div>

<p>
First handle using <code>package.el</code>. We will do all of the work of bootstrapping
here including running <code>package-initialize</code>, ensuring <code>use-package</code>, &amp; <code>delight</code>
are installed.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> needs-package-init
  (<span class="org-keyword">require</span> '<span class="org-constant">package</span>)
  (package-initialize)
  (<span class="org-keyword">unless</span> (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))
  (<span class="org-keyword">unless</span> (package-installed-p 'delight)
    (package-refresh-contents)
    (package-install 'delight)))
</pre>
</div>

<p>
Actually require <code>use-package</code>,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">eval-and-compile</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">delight</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">bind-key</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">use-package</span>))
</pre>
</div>

<p>
Now let’s handle the case where all of the packages are already provided.
Basically, we’ll prevent use-package from running ‘ensure’ on anything.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">eval-and-compile</span>
  (<span class="org-keyword">setq</span> use-package-always-ensure needs-package-init)
  (<span class="org-keyword">when</span> (not needs-package-init)
    (<span class="org-keyword">setq</span> use-package-ensure-function 'ignore
          package-enable-at-startup nil
          package--init-file-ensured t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5730cd0" class="outline-3">
<h3 id="org5730cd0">Key bindings</h3>
<div class="outline-text-3" id="text-org5730cd0">
<p>
Using bind-key, setup some simple key bindings. None of these should overwrite
Emacs’ default keybindings. Also, they should only require vanilla Emacs to work
(non-vanilla Emacs key bindings should be put in their <code>use-package</code>
declaration). These are meant to all be as close to vanilla Emacs as possible. I
try to avoid extremely specific key binds here.
</p>

<p>
What is overwritten can be seen with <code>M-x describe-personal-keybindings</code>. The
goal is to overwrite as little as possible. When it is necessary to overwrite
Emacs keybinds, documentation on why should be provided.
</p>

<p>
First we include a library that provides some nice helper functions that will be
used as key bindings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">bauer</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">files</span>)
</pre>
</div>

<p>
Define some helper functions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">web-search</span> (start end)
  (<span class="org-keyword">interactive</span> <span class="org-string">"r"</span>)
  (<span class="org-keyword">let</span> ((q (buffer-substring-no-properties start end)))
    (browse-url (concat <span class="org-string">"http://www.google.com/search?btnI&amp;q="</span>
      (url-hexify-string q)))))
</pre>
</div>

<p>
Override browse-url to handle man protocol better.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">browse-url</span>)
(<span class="org-keyword">defun</span> <span class="org-function-name">my-browse-url</span> (url <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Ask a WWW browser to load URL.</span>
<span class="org-doc">Prompt for a URL, defaulting to the URL at or before point.</span>
<span class="org-doc">Invokes a suitable browser function which does the actual job.</span>
<span class="org-doc">The variable `</span><span class="org-doc"><span class="org-constant">browse-url-browser-function</span></span><span class="org-doc">' says which browser function to</span>
<span class="org-doc">use.  If the URL is a mailto: URL, consult `</span><span class="org-doc"><span class="org-constant">browse-url-mailto-function</span></span><span class="org-doc">'</span>
<span class="org-doc">first, if that exists.</span>

<span class="org-doc">The additional ARGS are passed to the browser function.  See the doc</span>
<span class="org-doc">strings of the actual functions, starting with `</span><span class="org-doc"><span class="org-constant">browse-url-browser-function</span></span><span class="org-doc">',</span>
<span class="org-doc">for information about the significance of ARGS (most of the functions</span>
<span class="org-doc">ignore it).</span>
<span class="org-doc">If ARGS are omitted, the default is to pass `</span><span class="org-doc"><span class="org-constant">browse-url-new-window-flag</span></span><span class="org-doc">'</span>
<span class="org-doc">as ARGS."</span>
  (<span class="org-keyword">interactive</span> (browse-url-interactive-arg <span class="org-string">"URL: "</span>))
  (<span class="org-keyword">unless</span> (called-interactively-p 'interactive)
    (<span class="org-keyword">setq</span> args (<span class="org-keyword">or</span> args (list browse-url-new-window-flag))))
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> url-handler-mode
             (not (file-name-absolute-p url))
             (not (string-match <span class="org-string">"\\`[a-z]+:"</span> url)))
    (<span class="org-keyword">setq</span> url (expand-file-name url)))
  (<span class="org-keyword">let</span> ((process-environment (copy-sequence process-environment))
        (<span class="org-keyword">function</span> (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> (string-match <span class="org-string">"\\`mailto:"</span> url)
                           browse-url-mailto-function)
                      (<span class="org-keyword">and</span> (string-match <span class="org-string">"\\`man:"</span> url)
                           browse-url-man-function)
                      browse-url-browser-function))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Ensure that `</span><span class="org-comment"><span class="org-constant">default-directory</span></span><span class="org-comment">' exists and is readable (b#6077).</span>
        (default-directory (<span class="org-keyword">or</span> (unhandled-file-name-directory default-directory)
                               (expand-file-name <span class="org-string">"~/"</span>))))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">When connected to various displays, be careful to use the display of</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">the currently selected frame, rather than the original start display,</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">which may not even exist any more.</span>
    (<span class="org-keyword">if</span> (stringp (frame-parameter nil 'display))
        (setenv <span class="org-string">"DISPLAY"</span> (frame-parameter nil 'display)))
    (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (consp function)
             (not (functionp function)))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">The `</span><span class="org-comment"><span class="org-constant">function</span></span><span class="org-comment">' can be an alist; look down it for first match</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">and apply the function (which might be a lambda).</span>
        (<span class="org-keyword">catch</span> '<span class="org-constant">done</span>
          (<span class="org-keyword">dolist</span> (bf function)
            (<span class="org-keyword">when</span> (string-match (car bf) url)
              (apply (cdr bf) url args)
              (<span class="org-keyword">throw</span> '<span class="org-constant">done</span> t)))
          (<span class="org-warning">error</span> <span class="org-string">"No browse-url-browser-function matching URL %s"</span>
                 url))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Unbound symbols go down this leg, since void-function from</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">apply is clearer than wrong-type-argument from dolist.</span>
      (apply function url args))))

(advice-add 'browse-url <span class="org-builtin">:override</span> 'my-browse-url)
</pre>
</div>

<p>
Now we will call <code>bind-keys</code>. We give it keys to bind &amp; what function to run
when those keys are pressed. Note on syntax of bind-keys: if you are unfamiliar
with how Emacs key binding works, you should read through <a href="https://www.masteringemacs.org/article/mastering-key-bindings-emacs">this article</a>. Some
things done below include:
</p>

<ul class="org-ul">
<li>Make frame and window management a little bit easier. These are all used to</li>
</ul>
<p>
better navigations.
</p>
<ul class="org-ul">
<li>Scale text size for different context. Defaults to 12pt fonts.</li>
<li>Add evaluator keys, useful for executing lisp expressions.</li>
<li>Add some read-only mode keybindings.</li>
</ul>

<table id="org6c8f65a" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Key combination</th>
<th scope="col" class="org-left">Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&lt;s-return&gt;</td>
<td class="org-left">toggle-frame-fullscreen</td>
</tr>

<tr>
<td class="org-left">s-C-&lt;left&gt;</td>
<td class="org-left">enlarge-window-horizontally</td>
</tr>

<tr>
<td class="org-left">s-C-&lt;right&gt;</td>
<td class="org-left">shrink-window-horizontally</td>
</tr>

<tr>
<td class="org-left">s-C-&lt;down&gt;</td>
<td class="org-left">shrink-window</td>
</tr>

<tr>
<td class="org-left">s-C-&lt;up&gt;</td>
<td class="org-left">enlarge-window</td>
</tr>

<tr>
<td class="org-left">&lt;S-s-up&gt;</td>
<td class="org-left">shrink-window</td>
</tr>

<tr>
<td class="org-left">&lt;S-s-down&gt;</td>
<td class="org-left">enlarge-window</td>
</tr>

<tr>
<td class="org-left">&lt;s-down&gt;</td>
<td class="org-left">windmove-down</td>
</tr>

<tr>
<td class="org-left">&lt;s-up&gt;</td>
<td class="org-left">windmove-up</td>
</tr>

<tr>
<td class="org-left">&lt;s-left&gt;</td>
<td class="org-left">windmove-left</td>
</tr>

<tr>
<td class="org-left">&lt;s-right&gt;</td>
<td class="org-left">windmove-right</td>
</tr>

<tr>
<td class="org-left">C-x 5 3</td>
<td class="org-left">iconify-frame</td>
</tr>

<tr>
<td class="org-left">C-x 5 4</td>
<td class="org-left">toggle-frame-fullscreen</td>
</tr>

<tr>
<td class="org-left">&lt;C-return&gt;</td>
<td class="org-left">other-window</td>
</tr>

<tr>
<td class="org-left">&lt;C-M-return&gt;</td>
<td class="org-left">other-window</td>
</tr>

<tr>
<td class="org-left">s-o</td>
<td class="org-left">other-window</td>
</tr>

<tr>
<td class="org-left">C-z</td>
<td class="org-left">delete-other-windows</td>
</tr>

<tr>
<td class="org-left">s-1</td>
<td class="org-left">other-frame</td>
</tr>

<tr>
<td class="org-left">M-+</td>
<td class="org-left">text-scale-increase</td>
</tr>

<tr>
<td class="org-left">M-_</td>
<td class="org-left">text-scale-decrease</td>
</tr>

<tr>
<td class="org-left">C-c m b</td>
<td class="org-left">eval-buffer</td>
</tr>

<tr>
<td class="org-left">C-c m e</td>
<td class="org-left">eval-last-sexp</td>
</tr>

<tr>
<td class="org-left">C-c m i</td>
<td class="org-left">eval-expression</td>
</tr>

<tr>
<td class="org-left">C-c m d</td>
<td class="org-left">eval-defun</td>
</tr>

<tr>
<td class="org-left">C-c m n</td>
<td class="org-left">eval-print-last-sexp</td>
</tr>

<tr>
<td class="org-left">C-c m r</td>
<td class="org-left">eval-region</td>
</tr>

<tr>
<td class="org-left">C-c C-u</td>
<td class="org-left">rename-uniquely</td>
</tr>

<tr>
<td class="org-left">C-c C-o</td>
<td class="org-left">browse-url-at-point</td>
</tr>

<tr>
<td class="org-left">H-l</td>
<td class="org-left">browse-url-at-point</td>
</tr>

<tr>
<td class="org-left">H-c</td>
<td class="org-left">compile</td>
</tr>

<tr>
<td class="org-left">s-c</td>
<td class="org-left">compile</td>
</tr>

<tr>
<td class="org-left">s-r</td>
<td class="org-left">revert-buffer</td>
</tr>

<tr>
<td class="org-left">M-s d</td>
<td class="org-left">find-grep-dired</td>
</tr>

<tr>
<td class="org-left">M-s F</td>
<td class="org-left">find-grep</td>
</tr>

<tr>
<td class="org-left">M-s G</td>
<td class="org-left">grep</td>
</tr>

<tr>
<td class="org-left">C-x r q</td>
<td class="org-left">save-buffers-kill-terminal</td>
</tr>

<tr>
<td class="org-left">C-c C-&lt;return&gt;</td>
<td class="org-left">delete-blank-lines</td>
</tr>

<tr>
<td class="org-left">C-&lt;f10&gt;</td>
<td class="org-left">menu-bar-mode</td>
</tr>

<tr>
<td class="org-left">C-x M-g</td>
<td class="org-left">browse-url-at-point</td>
</tr>

<tr>
<td class="org-left">M-s f</td>
<td class="org-left">find-name-dired</td>
</tr>

<tr>
<td class="org-left">s-SPC</td>
<td class="org-left">cycle-spacing</td>
</tr>

<tr>
<td class="org-left">C-c w w</td>
<td class="org-left">whitespace-mode</td>
</tr>

<tr>
<td class="org-left">M-g l</td>
<td class="org-left">goto-line</td>
</tr>

<tr>
<td class="org-left">&lt;C-M-backspace&gt;</td>
<td class="org-left">backward-kill-sexp</td>
</tr>

<tr>
<td class="org-left">C-x t</td>
<td class="org-left">toggle-truncate-lines</td>
</tr>

<tr>
<td class="org-left">C-x v H</td>
<td class="org-left">vc-region-history</td>
</tr>

<tr>
<td class="org-left">C-c SPC</td>
<td class="org-left">just-one-space</td>
</tr>

<tr>
<td class="org-left">C-c f</td>
<td class="org-left">flush-lines</td>
</tr>

<tr>
<td class="org-left">C-c o</td>
<td class="org-left">customize-option</td>
</tr>

<tr>
<td class="org-left">C-c O</td>
<td class="org-left">customize-group</td>
</tr>

<tr>
<td class="org-left">C-c F</td>
<td class="org-left">customize-face</td>
</tr>

<tr>
<td class="org-left">C-c q</td>
<td class="org-left">fill-region</td>
</tr>

<tr>
<td class="org-left">C-c s</td>
<td class="org-left">replace-string</td>
</tr>

<tr>
<td class="org-left">C-c u</td>
<td class="org-left">rename-uniquely</td>
</tr>

<tr>
<td class="org-left">C-c z</td>
<td class="org-left">clean-buffer-list</td>
</tr>

<tr>
<td class="org-left">C-c =</td>
<td class="org-left">count-matches</td>
</tr>

<tr>
<td class="org-left">C-c ;</td>
<td class="org-left">comment-or-uncomment-region</td>
</tr>

<tr>
<td class="org-left">C-c [</td>
<td class="org-left">align-regexp</td>
</tr>

<tr>
<td class="org-left">s-/</td>
<td class="org-left">comment-or-uncomment-region</td>
</tr>

<tr>
<td class="org-left">M-s l</td>
<td class="org-left">sort-lines</td>
</tr>

<tr>
<td class="org-left">M-s m</td>
<td class="org-left">multi-occur</td>
</tr>

<tr>
<td class="org-left">M-s M</td>
<td class="org-left">multi-occur-in-matching-buffers</td>
</tr>

<tr>
<td class="org-left">C-c i i</td>
<td class="org-left">imenu</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(mapc (<span class="org-keyword">lambda</span> (x) (bind-key (car x) (intern (cadr x)))) keybinds)
</pre>
</div>

<p>
Some bauer-specific custom keybindings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys
  ([f12] . next-error)
  ([f11] . previous-error)
  ([shift f12] . previous-error)
  ([mouse-9] . next-buffer)
  ([mouse-8] . previous-buffer))

(bind-keys
 (<span class="org-string">"C-c I"</span>   . bauer-find-config)
 <span class="org-builtin">:prefix-map</span> bauer-git
 <span class="org-builtin">:prefix</span> <span class="org-string">"s-g"</span>
 (<span class="org-string">"l"</span> . magit-clone)

 <span class="org-builtin">:prefix-map</span> bauer-help
 <span class="org-builtin">:prefix</span> <span class="org-string">"s-h"</span>
 (<span class="org-string">"k"</span> . describe-personal-keybindings)
 (<span class="org-string">"p"</span> . ffap)
 (<span class="org-string">"m"</span> . man)
 (<span class="org-string">"w"</span> . woman))
</pre>
</div>

<p>
Terminal mode key bindings follow. Scrolling in the term with the mouse should
move text.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">unless</span> window-system
  (global-set-key (kbd <span class="org-string">"&lt;mouse-4&gt;"</span>) 'scroll-down-line)
  (global-set-key (kbd <span class="org-string">"&lt;mouse-5&gt;"</span>) 'scroll-up-line))
</pre>
</div>

<p>
macOS-specific bindings follow. Fullscreen handling should use the macOS
feature, while by default it uses a custom Emacs stuff. In addition, drag and
drop needs a special binding.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (eq window-system 'mac)
  (<span class="org-keyword">defun</span> <span class="org-function-name">mac-fullscreen</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((fullscreen (frame-parameter nil 'fullscreen)))
      (<span class="org-keyword">if</span> (memq fullscreen '(fullscreen fullboth))
          (<span class="org-keyword">let</span> ((fullscreen-restore (frame-parameter nil 'fullscreen-restore)))
            (<span class="org-keyword">if</span> (memq fullscreen-restore '(maximized fullheight fullwidth))
                (set-frame-parameter nil 'fullscreen fullscreen-restore)
              (set-frame-parameter nil 'fullscreen nil)))
        (modify-frame-parameters
         nil `((fullscreen . fullscreen) (fullscreen-restore . ,fullscreen))))))

  (bind-key <span class="org-string">"C-x 5 4"</span> 'mac-fullscreen)

  (<span class="org-keyword">when</span> (fboundp 'ns-drag-n-drop-as-text)
    (global-set-key [M-s-drag-n-drop]
                   'ns-drag-n-drop-as-text)))
</pre>
</div>

<p>
Add special quotes and arrows to ctrl x 8 keymap.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys
 <span class="org-builtin">:package</span> iso-transl
 <span class="org-builtin">:map</span> iso-transl-ctl-x-8-map
 (<span class="org-string">"' /"</span>       . <span class="org-string">"&#8242;"</span>)
 (<span class="org-string">"\" /"</span>      . <span class="org-string">"&#8243;"</span>)
 (<span class="org-string">"\" ("</span>      . <span class="org-string">"&#8220;"</span>)
 (<span class="org-string">"\" )"</span>      . <span class="org-string">"&#8221;"</span>)
 (<span class="org-string">"' ("</span>       . <span class="org-string">"&#8216;"</span>)
 (<span class="org-string">"' )"</span>       . <span class="org-string">"&#8217;"</span>)
 (<span class="org-string">"4 &lt; -"</span>     . <span class="org-string">"&#8592;"</span>)
 (<span class="org-string">"4 - &gt;"</span>     . <span class="org-string">"&#8594;"</span>)
 (<span class="org-string">"4 b"</span>       . <span class="org-string">"&#8592;"</span>)
 (<span class="org-string">"4 f"</span>       . <span class="org-string">"&#8594;"</span>)
 (<span class="org-string">"4 p"</span>       . <span class="org-string">"&#8593;"</span>)
 (<span class="org-string">"4 n"</span>       . <span class="org-string">"&#8595;"</span>)
 (<span class="org-string">"&lt;down&gt;"</span>    . <span class="org-string">"&#8659;"</span>)
 (<span class="org-string">"&lt;S-down&gt;"</span>  . <span class="org-string">"&#8595;"</span>)
 (<span class="org-string">"&lt;left&gt;"</span>    . <span class="org-string">"&#8656;"</span>)
 (<span class="org-string">"&lt;S-left&gt;"</span>  . <span class="org-string">"&#8592;"</span>)
 (<span class="org-string">"&lt;right&gt;"</span>   . <span class="org-string">"&#8658;"</span>)
 (<span class="org-string">"&lt;S-right&gt;"</span> . <span class="org-string">"&#8594;"</span>)
 (<span class="org-string">"&lt;up&gt;"</span>      . <span class="org-string">"&#8657;"</span>)
 (<span class="org-string">"&lt;S-up&gt;"</span>    . <span class="org-string">"&#8593;"</span>)
 (<span class="org-string">","</span>         . <span class="org-string">"&#8230;"</span>))
</pre>
</div>

<p>
Bind help map keys.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys
  <span class="org-builtin">:map</span> help-map
  (<span class="org-string">"C-r"</span> . woman)
  (<span class="org-string">"j"</span> . woman)
  (<span class="org-string">"C-j"</span> . man)
  (<span class="org-string">"C-s"</span> . web-search))
</pre>
</div>

<p>
More keys that have custom functions. TODO: move these above
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-keys
 (<span class="org-string">"C-x ~"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (find-file <span class="org-string">"~"</span>)))
 (<span class="org-string">"C-x /"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (find-file <span class="org-string">"/"</span>)))
 (<span class="org-string">"C-x 4 C-x ~"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (find-file-other-window <span class="org-string">"~"</span>)))
 (<span class="org-string">"C-x 4 C-x /"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (find-file-other-window <span class="org-string">"/"</span>)))

 (<span class="org-string">"C-x M-p"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
                (<span class="org-keyword">save-excursion</span> (other-window 1)
                                (quit-window))))

 (<span class="org-string">"C-M--"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
              (update-font-size -1 t)))
 (<span class="org-string">"C-M-="</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
              (update-font-size 1 t)))
 (<span class="org-string">"C-M-0"</span> . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>)
              (update-font-size 12 nil))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9004282" class="outline-3">
<h3 id="org9004282">Setup installer</h3>
<div class="outline-text-3" id="text-org9004282">
<p>
Installer provides installation &amp; upgrading functionality. You can upgrade the
IDE at any time by typing <code>M-x upgrade</code> from within Emacs. You may have to
restart Emacs for the upgrade to take place. See <a href="./lisp/installer.el">installer.el</a> for documentation.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">installer</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd844011" class="outline-3">
<h3 id="packages">Packages</h3>
<div class="outline-text-3" id="text-packages">
<p>
Each of these entries are <code>use-package</code> calls that will both install &amp; load
the package for us. The most important are listed first in “Essentials”.
“Built-in&ldquo; Emacs packages are also configured. Next comes the “Programming
Language” modes. Finally, we list some miscellaneous modes.
</p>

<p>
This is an alphabetized listing of all Emacs packages needed by the IDE. To
resort, go to one of the package group headings &amp; type <code>C-c ^ a</code>.
</p>
</div>

<div id="outline-container-org21c2204" class="outline-4">
<h4 id="org21c2204">Essentials</h4>
<div class="outline-text-4" id="text-org21c2204">
<p>
These are the best &amp; most useful modes available to us in Emacs world.
</p>
</div>

<ul class="org-ul">
<li><a id="org6027f59"></a>aggressive-indent<br />
<div class="outline-text-5" id="text-org6027f59">
<p>
<a href="https://github.com/Malabarba/aggressive-indent-mode">GitHub</a>
</p>

<p>
Automatically indent code as you type. Only enabled for Lisp currently.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package aggressive-indent
  <span class="org-builtin">:hook</span> ((emacs-lisp-mode
          inferior-emacs-lisp-mode
          ielm-mode
          lisp-mode
          inferior-lisp-mode
          isp-interaction-mode
          slime-repl-mode) <span class="org-warning">. aggressive-indent-mode))</span>
</pre>
</div>
</div>
</li>

<li><a id="org3c51571"></a>align<br />
<div class="outline-text-5" id="text-org3c51571">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package align
  <span class="org-builtin">:bind</span> (<span class="org-string">"M-["</span> . align)
  <span class="org-builtin">:config</span>
  (add-to-list 'align-rules-list
               '(haskell-types
                 (regexp . <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">::</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">&#8759;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\s-+"</span>)
                 (modes quote (haskell-mode literate-haskell-mode))))
  (add-to-list 'align-rules-list
               '(haskell-assignment
                 (regexp . <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">=\\s-+"</span>)
                 (modes quote (haskell-mode literate-haskell-mode))))
  (add-to-list 'align-rules-list
               '(haskell-arrows
                 (regexp . <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">-&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">&#8594;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\s-+"</span>)
                 (modes quote (haskell-mode literate-haskell-mode))))
  (add-to-list 'align-rules-list
               '(haskell-left-arrows
                 (regexp . <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">&lt;-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">&#8592;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\s-+"</span>)
                 (modes quote (haskell-mode literate-haskell-mode))))
  )
</pre>
</div>
</div>
</li>

<li><a id="org653818a"></a>Company<br />
<div class="outline-text-5" id="text-org653818a">
<p>
<a href="http://company-mode.github.io">Website</a>
</p>

<p>
Company provides completions in Emacs. Activate them by pressing <code>C-M-i</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company
  <span class="org-builtin">:commands</span> global-company-mode
  <span class="org-builtin">:delight</span>
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:preface</span>
  (load <span class="org-string">"company-autoloads"</span> t t)
  (<span class="org-keyword">defun</span> <span class="org-function-name">company-complete-common-or-cycle-backward</span> ()
    <span class="org-doc">"Complete common prefix or cycle backward."</span>
    (<span class="org-keyword">interactive</span>)
    (company-complete-common-or-cycle -1))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> company-mode-map
              (<span class="org-string">"C-M-i"</span> . company-complete-common-or-cycle)
              <span class="org-builtin">:map</span> company-active-map
              (<span class="org-string">"RET"</span> . company-complete-selection)
              ([return] . company-complete-selection)
              (<span class="org-string">"C-j"</span> . company-complete-selection)

              (<span class="org-string">"TAB"</span> . company-complete-common-or-cycle)
              (<span class="org-string">"&lt;tab&gt;"</span> . company-complete-common-or-cycle)
              (<span class="org-string">"S-TAB"</span> . company-complete-common-or-cycle-backward)
              (<span class="org-string">"&lt;backtab&gt;"</span> . company-complete-common-or-cycle-backward)
              (<span class="org-string">"C-n"</span> . company-select-next)
              (<span class="org-string">"C-p"</span> . company-select-previous)

              (<span class="org-string">"C-/"</span> . company-search-candidates)
              (<span class="org-string">"C-M-/"</span> . company-filter-candidates)
              (<span class="org-string">"C-d"</span> . company-show-doc-buffer)
              )
  <span class="org-builtin">:hook</span> (<span class="org-comment-delimiter">;; </span><span class="org-comment">(minibuffer-setup . company-mode)</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(minibuffer-setup . (lambda ()</span>
         <span class="org-comment-delimiter">;;                       </span><span class="org-comment">(setq-local company-frontends '(company-preview-if-just-one-frontend))</span>
         <span class="org-comment-delimiter">;;                       </span><span class="org-comment">(setq-local company-auto-complete nil)))</span>
         (after-init . global-company-mode)
         (shell-mode .
                     (<span class="org-keyword">lambda</span> ()
                       (<span class="org-keyword">setq-local</span> company-backends '(company-capf))))
         (eshell-mode . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">setq-local</span> company-backends '(company-files)))))
  <span class="org-builtin">:config</span>
  (advice-add 'completion-at-point
              <span class="org-builtin">:around</span> (<span class="org-keyword">lambda</span> (old-function <span class="org-type">&amp;rest</span> args)
                        (<span class="org-keyword">if</span> company-mode
                            (apply 'company-complete-common-or-cycle args)
                          (apply old-function args))))
  (global-company-mode))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgfed195e"></a>company-irony<br />
<div class="outline-text-6" id="text-orgfed195e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-irony
  <span class="org-builtin">:commands</span> company-irony
  <span class="org-builtin">:hook</span> (irony-mode . (<span class="org-keyword">lambda</span> ()
    (<span class="org-keyword">setq-local</span> company-backends '(company-irony company-capf)))))
</pre>
</div>
</div>
</li>

<li><a id="org8e25860"></a>company-restclient<br />
<div class="outline-text-6" id="text-org8e25860">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-restclient
  <span class="org-builtin">:commands</span> company-restclient
  <span class="org-builtin">:hook</span> (restclient-mode . (<span class="org-keyword">lambda</span> ()
    (<span class="org-keyword">setq-local</span> company-backends '(company-restclient company-capf)))))
</pre>
</div>
</div>
</li>
<li><a id="orgbc81907"></a>company-anaconda<br />
<div class="outline-text-6" id="text-orgbc81907">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-anaconda
  <span class="org-builtin">:commands</span> company-anaconda
  <span class="org-builtin">:hook</span> (anaconda-mode . (<span class="org-keyword">lambda</span> ()
                           (<span class="org-keyword">setq-local</span> company-backends '((company-anaconda
                                                           company-capf))))))
</pre>
</div>
</div>
</li>
<li><a id="org5d57d52"></a>company-auctex<br />
<div class="outline-text-6" id="text-org5d57d52">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-auctex
  <span class="org-builtin">:commands</span> (company-auctex
             company-auctext-labels
             company-auctest-bibs
             company-auctex-macros
             company-auctext-symbols
             company-auctext-environments)
  <span class="org-builtin">:hook</span>
  (tex-mode . (<span class="org-keyword">lambda</span> ()
                (<span class="org-keyword">setq-local</span> company-backends '((company-auctex-labels
                                                company-auctex-bibs
                                                company-auctex-macros
                                                company-auctex-environments
                                                company-auctex-symbols
                                                company-capf))))))
</pre>
</div>
</div>
</li>
<li><a id="org0eb716a"></a>company-web<br />
<div class="outline-text-6" id="text-org0eb716a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-web
  <span class="org-builtin">:preface</span>
  (autoload 'company-web-html <span class="org-string">"company-web-html"</span>)
  (autoload 'company-web-jade <span class="org-string">"company-web-jade"</span>)
  (autoload 'company-web-slim <span class="org-string">"company-web-slim"</span>)
  <span class="org-builtin">:hook</span> ((web-mode . (<span class="org-keyword">lambda</span> ()
                       (<span class="org-keyword">setq-local</span> company-backends '(company-web-html
                                                      company-web-jade
                                                      company-web-slim
                                                      company-capf))))))
</pre>
</div>
</div>
</li>
<li><a id="orgbc82d49"></a>company-math<br />
<div class="outline-text-6" id="text-orgbc82d49">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-math
  <span class="org-builtin">:preface</span>
  (autoload 'company-math-symbols-latex <span class="org-string">"company-math"</span>)
  (autoload 'company-latex-commands <span class="org-string">"company-math"</span>)
  <span class="org-builtin">:hook</span>
  (TeX-mode . (<span class="org-keyword">lambda</span> ()
                (<span class="org-keyword">setq-local</span> company-backends '((company-math-symbols-latex
                                                company-latex-commands
                                                company-capf))))))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org25d4b4b"></a>Counsel<br />
<div class="outline-text-5" id="text-org25d4b4b">
<p>
<a href="https://github.com/abo-abo/swiper">GitHub</a>
</p>

<p>
Counsel provides a better selection experience to the default Emacs.
</p>

<p>
Counsel is only enabled on non-Windows systems. This is due to an issue in
counsel-find-file, see <a href="https://github.com/abo-abo/swiper/issues/773">https://github.com/abo-abo/swiper/issues/773</a> for more
info.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package counsel
  <span class="org-builtin">:disabled</span>
  <span class="org-builtin">:commands</span> (counsel-mode counsel-descbinds
             counsel-grep-or-swiper)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">counsel doesn&#8217;t work well with windows drives</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">see https://github.com/abo-abo/swiper/issues/773</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:if (not (string= system-type "windows-nt"))</span>

  <span class="org-builtin">:bind*</span> (([remap execute-extended-command] . counsel-M-x)
          ([remap find-library] . counsel-find-library)
          ([remap describe-bindings]  .
           counsel-descbinds)
          ([remap describe-face]  .
           counsel-describe-faces)
          ([remap list-faces-display] . counsel-faces)
          ([remap imenu] . counsel-imenu)
          ([remap load-library] . counsel-load-library)
          ([remap load-theme] . counsel-load-theme)
          ([remap yank-pop] . counsel-yank-pop)
          ([remap info-lookup-symbol] .
           counsel-info-lookup-symbol)
          ([remap pop-to-mark-command] .
           counsel-mark-ring)
          ([remap bookmark-jump] . counsel-bookmark)
          (<span class="org-string">"C-c j"</span> . counsel-git-grep)
          (<span class="org-string">"C-x l"</span> . counsel-locate)
          (<span class="org-string">"M-y"</span> . counsel-yank-pop)
          (<span class="org-string">"C-c i 8"</span> . counsel-unicode-char)
          (<span class="org-string">"C-x M-f"</span> . counsel-find-file)

          <span class="org-builtin">:map</span> help-map
          (<span class="org-string">"C-v"</span> . counsel-find-symbol)
          (<span class="org-string">"C-k"</span> . counsel-find-function-on-key)
          (<span class="org-string">"C-l"</span> . counsel-find-library)
          ))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org7583811"></a>ivy<br />
<div class="outline-text-6" id="text-org7583811">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ivy
  <span class="org-builtin">:commands</span> (ivy-read)
  <span class="org-builtin">:bind</span> (([remap list-buffers] . ivy-switch-buffer)
         ([remap switch-to-buffer] . ivy-switch-buffer)
         ([remap switch-to-buffer-other-window] .
          ivy-switch-buffer-other-window)
         <span class="org-builtin">:package</span> ivy
         <span class="org-builtin">:map</span> ivy-minibuffer-map
         (<span class="org-string">"&lt;escape&gt;"</span> . abort-recursive-edit))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">projectile-completion-system</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">magit-completing-read-function</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">projector-completion-system</span>)
  (<span class="org-keyword">setq</span> projectile-completion-system 'ivy
        magit-completing-read-function 'ivy-completing-read)
  <span class="org-builtin">:commands</span> (ivy-completing-read
             ivy-completion-in-region
             swiper))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org8bd1b15"></a>diff-hl<br />
<div class="outline-text-5" id="text-org8bd1b15">
<p>
This mode provides indicators at the right fringe of the Emacs buffer. These
indications show where a file has been edited from the last Git commit.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package diff-hl
  <span class="org-builtin">:disabled</span>
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:package</span> diff-hl
         <span class="org-builtin">:map</span> diff-hl-mode-map
         (<span class="org-string">"&lt;left-fringe&gt; &lt;mouse-1&gt;"</span> . diff-hl-diff-goto-hunk))
  <span class="org-builtin">:hook</span> ((prog-mode . diff-hl-mode)
         (vc-dir-mode . diff-hl-mode)
         (dired-mode . diff-hl-dir-mode)
         (magit-post-refresh . diff-hl-magit-post-refresh)
         (org-mode . diff-hl-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org01cf6f2"></a>dtrt-indent<br />
<div class="outline-text-5" id="text-org01cf6f2">
<p>
<a href="https://github.com/jscheid/dtrt-indent">GitHub</a>
</p>

<p>
This mode will try to 
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dtrt-indent
  <span class="org-builtin">:delight</span>
  <span class="org-builtin">:hook</span> (prog-mode . dtrt-indent-mode))
</pre>
</div>
</div>
</li>

<li><a id="orga4aa504"></a>Emacs shell<br />
<div class="outline-text-5" id="text-orga4aa504">
<p>
Emacs shell provides . Run eshell by typing <code>C-c e</code> or <code>M-x eshell</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eshell
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c M-t"</span> . eshell)
         (<span class="org-string">"C-c x"</span> . eshell)
         (<span class="org-string">"C-c e"</span> . eshell))
  <span class="org-builtin">:hook</span> (<span class="org-comment-delimiter">;; </span><span class="org-comment">(eshell-first-time-mode-hook . eshell-read-history)</span>
         (eshell-first-time-mode-hook . (<span class="org-keyword">lambda</span> () (add-hook 'eshell-expand-input-functions 'eshell-spawn-external-command))))
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">eshell-isearch-map</span>
    (<span class="org-keyword">let</span> ((map (copy-keymap isearch-mode-map)))
      (define-key map [(control ?m)] 'eshell-isearch-return)
      (define-key map [return]       'eshell-isearch-return)
      (define-key map [(control ?r)] 'eshell-isearch-repeat-backward)
      (define-key map [(control ?s)] 'eshell-isearch-repeat-forward)
      (define-key map [(control ?g)] 'eshell-isearch-abort)
      (define-key map [backspace]    'eshell-isearch-delete-char)
      (define-key map [delete]       'eshell-isearch-delete-char)
      map)
    <span class="org-doc">"Keymap used in isearch in Eshell."</span>)
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">eshell/q</span> 'eshell/exit)
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">eshell/\?</span> 'help)
  (<span class="org-keyword">defun</span> <span class="org-function-name">eshell-spawn-external-command</span> (beg end)
    <span class="org-doc">"Parse and expand any history references in current input."</span>
    (<span class="org-keyword">save-excursion</span>
      (goto-char end)
      (<span class="org-keyword">when</span> (looking-back <span class="org-string">"&amp;!"</span> beg)
        (delete-region (match-beginning 0) (match-end 0))
        (goto-char beg)
        (insert <span class="org-string">"spawn "</span>)))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgdfea879"></a>em-rebind<br />
<div class="outline-text-6" id="text-orgdfea879">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package em-rebind
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: move this back to customize</span>
  (<span class="org-keyword">setq</span> eshell-rebind-keys-alist
        '(([(control 97)] . eshell-bol)
          ([home] . eshell-bol)
          ([(control 100)] . eshell-delchar-or-maybe-eof)
          ([backspace] . eshell-delete-backward-char)
          ([delete] . eshell-delete-backward-char)
          ([(control 119)] . backward-kill-word)
          ([(control 117)] . eshell-kill-input)
          ([tab] . completion-at-point)
          ([(control 101)] . (<span class="org-keyword">lambda</span> ()
                               (<span class="org-keyword">interactive</span>) (end-of-line)))))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: move this back to customize</span>
  (<span class="org-keyword">setq</span> eshell-modules-list
        '(eshell-alias
          eshell-basic
          eshell-cmpl
          eshell-dirs
          eshell-glob
          eshell-hist
          eshell-ls
          eshell-pred
          eshell-prompt
          eshell-rebind
          eshell-script
          eshell-term
          eshell-tramp
          eshell-unix
          eshell-xtra
          )))

</pre>
</div>
</div>
</li>

<li><a id="org8a63b98"></a>esh-help<br />
<div class="outline-text-6" id="text-org8a63b98">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package esh-help
  <span class="org-builtin">:preface</span>
  (autoload 'esh-help-eldoc-command <span class="org-string">"esh-help"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">esh-help-turn-on</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">setq-local</span> eldoc-documentation-function
                'esh-help-eldoc-command)
    (<span class="org-keyword">setq</span> eldoc-documentation-function
                'esh-help-eldoc-command)
    (eldoc-mode 1))
  <span class="org-builtin">:hook</span> (eshell-mode . esh-help-turn-on))
</pre>
</div>
</div>
</li>

<li><a id="org950b3a9"></a>em-dired<br />
<div class="outline-text-6" id="text-org950b3a9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package em-dired
  <span class="org-builtin">:preface</span>
  (autoload 'em-dired-new <span class="org-string">"em-dired"</span>)
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:package</span> dired
         <span class="org-builtin">:map</span> dired-mode-map
         (<span class="org-string">"e"</span> . em-dired))
  <span class="org-builtin">:hook</span> (eshell-mode . em-dired-mode)
  <span class="org-builtin">:init</span>
  (advice-add 'eshell <span class="org-builtin">:before</span> 'em-dired-new))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org5b56a41"></a>Flycheck<br />
<div class="outline-text-5" id="text-org5b56a41">
<p>
<a href="http://www.flycheck.org/">Website</a>
</p>

<p>
Flycheck will annotate code with errors from the compiler or interpreter. It
supports many languages and give us a lot of features right out of the box.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flycheck
  <span class="org-builtin">:hook</span> ((prog-mode . flycheck-mode)
         (haskell-mode . (<span class="org-keyword">lambda</span> () (flycheck-mode -1)))
         (c++-mode . (<span class="org-keyword">lambda</span> () (flycheck-mode -1)))))
<span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package flycheck-haskell</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:hook (haskell-mode . flycheck-haskell-setup))</span>
(use-package flycheck-cask
  <span class="org-builtin">:hook</span> (emacs-lisp-mode . flycheck-cask-setup))
(use-package flycheck-rust
  <span class="org-builtin">:hook</span> (rust-mode . flycheck-rust-setup))
</pre>
</div>
</div>
</li>

<li><a id="orgf958401"></a>Gnus<br />
<div class="outline-text-5" id="text-orgf958401">
<p>
<a href="http://www.gnus.org">Website</a>
</p>

<p>
Gnus is an infamous email client &amp; news reader.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gnus
  <span class="org-builtin">:commands</span> gnus
  <span class="org-builtin">:hook</span> ((dired-mode . turn-on-gnus-dired-mode)))
</pre>
</div>
</div>
</li>

<li><a id="orgdc68739"></a>God Mode<br />
<div class="outline-text-5" id="text-orgdc68739">
<p>
<a href="https://github.com/chrisdone/god-mode">GitHub</a>
</p>

<p>
God Mode makes it easier to type Emacs shortcuts involving lots of modifier
keys. Activate it by pressing Escape (Notice “God” at the bottom of the screen).
You no longer have to press &amp; hold the control key!
</p>

<p>
Note that god-mode overwrites escape key. This can cause some issues for
certain Emacs keybinds.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  (use-package god-mode
    <span class="org-builtin">:bind</span> ((<span class="org-string">"&lt;escape&gt;"</span> . god-local-mode)
<span class="org-comment-delimiter">;;           </span><span class="org-comment">("ESC" . god-local-mode)</span>
))
</pre>
</div>
</div>
</li>

<li><a id="org6445c53"></a>helpful<br />
<div class="outline-text-5" id="text-org6445c53">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package helpful
  <span class="org-builtin">:if</span> (&gt;= emacs-major-version 25)
  <span class="org-builtin">:bind</span> (([remap describe-function] . helpful-callable)
         ([remap describe-variable] . helpful-variable)
         ([remap describe-key] . helpful-key)
         (<span class="org-string">"H-h"</span> . helpful-at-point)))
</pre>
</div>
</div>
</li>

<li><a id="org18ed3ec"></a>Hippie Expand<br />
<div class="outline-text-5" id="text-org18ed3ec">
<p>
Hippie provides dynamic expansions. Try it out by pressing <code>M-/</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hippie-exp
  <span class="org-builtin">:bind*</span> ((<span class="org-string">"M-/"</span> . hippie-expand)
          (<span class="org-string">"s-?"</span> . hippie-expand-line))
  <span class="org-builtin">:hook</span> ((emacs-lisp-mode ielm-mode) .
         (<span class="org-keyword">lambda</span> ()
           (<span class="org-keyword">setq-local</span>
            hippie-expand-try-functions-list
            (append '(try-complete-lisp-symbol-partially
                      try-complete-lisp-symbol)
             hippie-expand-try-functions-list)))))
</pre>
</div>
</div>
</li>

<li><a id="orgf92dbb2"></a>Magit<br />
<div class="outline-text-5" id="text-orgf92dbb2">
<p>
<a href="https://magit.vc">Website</a>
</p>

<p>
Magit is a Git porcelain for Emacs. All of the features from the Git command
line are available in an intuitive Emacs buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit
  <span class="org-builtin">:preface</span>
  (autoload 'magit-toplevel <span class="org-string">"magit"</span>)
  (autoload 'magit-read-string-ns <span class="org-string">"magit"</span>)
  (autoload 'magit-get <span class="org-string">"magit"</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(autoload 'magit-define-popup-action "magit")</span>
  (autoload 'magit-remote-arguments <span class="org-string">"magit"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">magit-dired-other-window</span> ()
    (<span class="org-keyword">interactive</span>)
    (dired-other-window (magit-toplevel)))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(defun magit-remote-github (username &amp;optional args)</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">(interactive (list (magit-read-string-ns "User name")</span>
  <span class="org-comment-delimiter">;;                      </span><span class="org-comment">(magit-remote-arguments)))</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">(let* ((url (magit-get "remote.origin.url"))</span>
  <span class="org-comment-delimiter">;;          </span><span class="org-comment">(match (string-match</span>
  <span class="org-comment-delimiter">;;                  </span><span class="org-comment">"^\\(?:https?://github\.com/\\|git@github.com:\\|ssh://git@github\.com/\\)[</span><span class="org-comment"><span class="org-negation-char">^</span></span><span class="org-comment">/]*/\\(.*\\)"</span>
  <span class="org-comment-delimiter">;;                  </span><span class="org-comment">url)))</span>
  <span class="org-comment-delimiter">;;     </span><span class="org-comment">(unless match</span>
  <span class="org-comment-delimiter">;;       </span><span class="org-comment">(error "Not a github remote"))</span>
  <span class="org-comment-delimiter">;;     </span><span class="org-comment">(let ((repo (match-string 1 url)))</span>
  <span class="org-comment-delimiter">;;       </span><span class="org-comment">(apply 'magit-remote-add username</span>
  <span class="org-comment-delimiter">;;              </span><span class="org-comment">(format "ssh://git@github.com/%s/%s"</span>
  <span class="org-comment-delimiter">;;                      </span><span class="org-comment">username repo) args))))</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:hook (magit-mode . (lambda ()</span>
  <span class="org-comment-delimiter">;;                       </span><span class="org-comment">(magit-define-popup-action</span>
  <span class="org-comment-delimiter">;;                         </span><span class="org-comment">'magit-remote-popup</span>
  <span class="org-comment-delimiter">;;                         </span><span class="org-comment">?g</span>
  <span class="org-comment-delimiter">;;                         </span><span class="org-comment">"Add remote from github user name"</span>
  <span class="org-comment-delimiter">;;                         </span><span class="org-comment">'magit-remote-github)))</span>

  <span class="org-builtin">:commands</span> (magit-clone magit-blame-addition magit-log-buffer-file)
  <span class="org-builtin">:if</span> (locate-file <span class="org-string">"git"</span> exec-path)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-x g"</span> . magit-status)
         (<span class="org-string">"C-x G"</span> . magit-dispatch)
         <span class="org-builtin">:package</span> magit
         <span class="org-builtin">:map</span> magit-mode-map
         (<span class="org-string">"C-o"</span> . magit-dired-other-window)))
</pre>
</div>

<p>
Magit forge.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package forge
  <span class="org-builtin">:after</span> magit)
</pre>
</div>

<p>
Magit todos
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-todos
  <span class="org-builtin">:commands</span> (magit-todos-list))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgdb2bf45"></a>git-commit<br />
<div class="outline-text-6" id="text-orgdb2bf45">
<pre class="example">
(use-package git-commit
  :hook ((git-commit-mode . flyspell-mode)
	 (git-commit-mode . git-commit-save-message)
	 (git-commit-mode . turn-on-auto-fill)))
</pre>
</div>
</li>
</ul>
</li>
<li><a id="org32cb3d4"></a>MMM Mode<br />
<div class="outline-text-5" id="text-org32cb3d4">
<p>
<a href="https://github.com/purcell/mmm-mode">GitHub</a>
</p>

<p>
MMM mode lets you edit multiple languages within one buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mmm-mode
  <span class="org-builtin">:commands</span> mmm-mode
  <span class="org-builtin">:config</span>
  (use-package mmm-auto
    <span class="org-builtin">:ensure</span> nil))
</pre>
</div>
</div>
</li>

<li><a id="orge516e56"></a>multiple-cursors<br />
<div class="outline-text-5" id="text-orge516e56">
<p>
<a href="https://github.com/magnars/multiple-cursors.el">GitHub</a>
</p>

<p>
Multiple cursors give you more cursors. It is bound to <code>C-&gt;</code> &amp; <code>C-&lt;</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package multiple-cursors
  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"&lt;C-S-down&gt;"</span> . mc/mark-next-like-this)
   (<span class="org-string">"&lt;C-S-up&gt;"</span> . mc/mark-previous-like-this)
   (<span class="org-string">"C-&gt;"</span> . mc/mark-next-like-this)
   (<span class="org-string">"C-&lt;"</span> . mc/mark-previous-like-this)
   (<span class="org-string">"M-&lt;mouse-1&gt;"</span> . mc/add-cursor-on-click)
   (<span class="org-string">"C-c C-&lt;"</span>     . mc/mark-all-like-this)
   (<span class="org-string">"C-!"</span>         . mc/mark-next-symbol-like-this)
   (<span class="org-string">"C-S-c C-S-c"</span> . mc/edit-lines)))
</pre>
</div>
</div>
</li>

<li><a id="org74f5863"></a>Org<br />
<div class="outline-text-5" id="text-org74f5863">
<p>
<a href="https://orgmode.org">Website</a>
</p>

<p>
Org mode is an impressive suite of text editing solutions. It gives you an
outliner but also much much more.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org
  <span class="org-builtin">:ensure</span> org-plus-contrib
  <span class="org-builtin">:hook</span> ((org-mode . (<span class="org-keyword">lambda</span> ()
           (add-hook 'completion-at-point-functions
                     'pcomplete-completions-at-point nil t)))
         (org-mode . auto-fill-mode)
         (org-mode . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">setq-local</span> scroll-margin 3)))
         (message-mode . turn-on-orgtbl)
         (org-mode . (<span class="org-keyword">lambda</span> ()
           (autoload 'org-eldoc-documentation-function <span class="org-string">"org-eldoc"</span>)
           (<span class="org-keyword">setq-local</span> eldoc-documentation-function
                       'org-eldoc-documentation-function))))
  <span class="org-builtin">:bind*</span> ((<span class="org-string">"C-c c"</span> . org-capture)
          (<span class="org-string">"C-c a"</span> . org-agenda)
          (<span class="org-string">"C-c l"</span> . org-store-link)
          (<span class="org-string">"C-c b"</span> . org-iswitchb))
  <span class="org-builtin">:config</span>
  (use-package ob-dot
    <span class="org-builtin">:ensure</span> nil
    <span class="org-builtin">:demand</span>)
  (use-package ox-latex
    <span class="org-builtin">:ensure</span> nil
    <span class="org-builtin">:demand</span>)
  (use-package ox-beamer
    <span class="org-builtin">:ensure</span> nil
    <span class="org-builtin">:demand</span>)
  (use-package ox-md
    <span class="org-builtin">:ensure</span> nil
    <span class="org-builtin">:demand</span>))
(use-package org-download
  <span class="org-builtin">:hook</span> (dired-mode . org-download-enable))
(use-package org-present
  <span class="org-builtin">:commands</span> org-present)
(use-package org-journal
  <span class="org-builtin">:commands</span> org-journal-new-entry)
</pre>
</div>
</div>
</li>
<li><a id="org7783a45"></a>Projectile<br />
<div class="outline-text-5" id="text-org7783a45">
<p>
<a href="https://github.com/bbatsov/projectile">GitHub</a>
</p>

<p>
Setup projectile &amp; link it with some other packages. This also adds an
easymenu to make the &ldquo;Projectile&rdquo; modeline clickable.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package projectile
  <span class="org-builtin">:commands</span> projectile-mode
  <span class="org-builtin">:bind-keymap*</span> ((<span class="org-string">"C-c p"</span> . projectile-command-map)
                 (<span class="org-string">"s-p"</span> . projectile-command-map))
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c C-f"</span> . projectile-find-file))
  <span class="org-builtin">:preface</span>
  (autoload 'projectile-project-vcs <span class="org-string">"projectile"</span>)
  (autoload 'projectile-project-root <span class="org-string">"projectile"</span>)
  (autoload 'easy-menu-define <span class="org-string">"easymenu"</span> <span class="org-doc">""</span> nil 'macro)
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:config</span>
  (projectile-mode))
</pre>
</div>
</div>
</li>

<li><a id="orgd88ecfc"></a>Recentf<br />
<div class="outline-text-5" id="text-orgd88ecfc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package recentf
  <span class="org-builtin">:disabled</span>
  <span class="org-builtin">:config</span> (recentf-mode 1))
</pre>
</div>
</div>
</li>
<li><a id="orgfe63a88"></a>smart-hungry-delete<br />
<div class="outline-text-5" id="text-orgfe63a88">
<p>
<a href="https://github.com/hrehfeld/emacs-smart-hungry-delete">GitHub</a>
</p>

<p>
Smart hungry delete automatically delete lots of whitespace in a row.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package smart-hungry-delete
  <span class="org-builtin">:if</span> (&gt;= emacs-major-version 25)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> prog-mode-map
         (<span class="org-string">"&lt;backspace&gt;"</span> .
          smart-hungry-delete-backward-char)
         (<span class="org-string">"C-d"</span> .
          smart-hungry-delete-forward-char))
  <span class="org-builtin">:hook</span> ((prog-mode .
          smart-hungry-delete-default-prog-mode-hook)
         (c-mode-common .
          smart-hungry-delete-default-c-mode-common-hook)
         (python-mode .
          smart-hungry-delete-default-c-mode-common-hook)
         (text-mode .
          smart-hungry-delete-default-text-mode-hook)))
</pre>
</div>
</div>
</li>

<li><a id="orgcb3d3c0"></a>Smartparens<br />
<div class="outline-text-5" id="text-orgcb3d3c0">
<p>
<a href="https://github.com/Fuco1/smartparens">Website</a>
</p>

<p>
Smartparens is helpful in closing parenthesis when editing Lisp code.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package smartparens
  <span class="org-builtin">:preface</span>
  (autoload 'sp-local-pair <span class="org-string">"smartparens"</span>)
  (autoload 'sp-local-tag  <span class="org-string">"smartparens"</span>)
  <span class="org-builtin">:hook</span> (((emacs-lisp-mode
           inferior-emacs-lisp-mode
           ielm-mode
           lisp-mode
           inferior-lisp-mode
           lisp-interaction-mode
           slime-repl-mode
           eval-expression-minibuffer-setup) <span class="org-warning">.</span>
          smartparens-strict-mode)
         ((emacs-lisp-mode
           inferior-emacs-lisp-mode
           ielm-mode
           lisp-mode
           inferior-lisp-mode
           lisp-interaction-mode
           slime-repl-mode
           org-mode) <span class="org-warning">. show-smartparens-mode)</span>
         ((web-mode
           html-mode) <span class="org-warning">. smartparens-mode))</span>
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> smartparens-mode-map
         (<span class="org-string">"C-M-f"</span> . sp-forward-sexp) <span class="org-comment-delimiter">;; </span><span class="org-comment">navigation</span>
         (<span class="org-string">"C-M-b"</span> . sp-backward-sexp)
         (<span class="org-string">"C-M-u"</span> . sp-backward-up-sexp)
         (<span class="org-string">"C-M-d"</span> . sp-down-sexp)
         (<span class="org-string">"C-M-p"</span> . sp-backward-down-sexp)
         (<span class="org-string">"C-M-n"</span> . sp-up-sexp)
         (<span class="org-string">"M-s"</span> . sp-splice-sexp) <span class="org-comment-delimiter">;; </span><span class="org-comment">depth-changing commands</span>
         (<span class="org-string">"M-&lt;up&gt;"</span> . sp-splice-sexp-killing-backward)
         (<span class="org-string">"M-&lt;down&gt;"</span> . sp-splice-sexp-killing-forward)
         (<span class="org-string">"M-r"</span> . sp-splice-sexp-killing-around)
         (<span class="org-string">"M-("</span> . sp-wrap-round)
         (<span class="org-string">"C-)"</span> . sp-forward-slurp-sexp) <span class="org-comment-delimiter">;; </span><span class="org-comment">barf/slurp</span>
         (<span class="org-string">"C-&lt;right&gt;"</span> . sp-forward-slurp-sexp)
         (<span class="org-string">"C-}"</span> . sp-forward-barf-sexp)
         (<span class="org-string">"C-&lt;left&gt;"</span> . sp-forward-barf-sexp)
         (<span class="org-string">"C-("</span> . sp-backward-slurp-sexp)
         (<span class="org-string">"C-M-&lt;left&gt;"</span> . sp-backward-slurp-sexp)
         (<span class="org-string">"C-{"</span> . sp-backward-barf-sexp)
         (<span class="org-string">"C-M-&lt;right&gt;"</span> . sp-backward-barf-sexp)
         (<span class="org-string">"M-S"</span> . sp-split-sexp) <span class="org-comment-delimiter">;; </span><span class="org-comment">misc</span>
         (<span class="org-string">"M-j"</span> . sp-join-sexp))
  <span class="org-builtin">:config</span>
  (autoload 'sp-with-modes <span class="org-string">"smartparens"</span> <span class="org-doc">""</span> nil 'macro)
  (use-package smartparens-config
    <span class="org-builtin">:ensure</span> nil
    <span class="org-builtin">:demand</span>)

  (sp-with-modes 'org-mode
    (sp-local-pair <span class="org-string">"*"</span> <span class="org-string">"*"</span>
      <span class="org-builtin">:actions</span> '(insert wrap)
      <span class="org-builtin">:unless</span> '(sp-point-after-word-p sp-point-at-bol-p)
      <span class="org-builtin">:wrap</span> <span class="org-string">"C-*"</span> <span class="org-builtin">:skip-match</span> 'sp--org-skip-asterisk)
    (sp-local-pair <span class="org-string">"_"</span> <span class="org-string">"_"</span> <span class="org-builtin">:unless</span> '(sp-point-after-word-p)
                           <span class="org-builtin">:wrap</span> <span class="org-string">"C-_"</span>)
    (sp-local-pair <span class="org-string">"/"</span> <span class="org-string">"/"</span> <span class="org-builtin">:unless</span> '(sp-point-after-word-p)
                   <span class="org-builtin">:post-handlers</span> '((<span class="org-string">"[d1]"</span> <span class="org-string">"SPC"</span>)))
    (sp-local-pair <span class="org-string">"~"</span> <span class="org-string">"~"</span> <span class="org-builtin">:unless</span> '(sp-point-after-word-p)
                   <span class="org-builtin">:post-handlers</span> '((<span class="org-string">"[d1]"</span> <span class="org-string">"SPC"</span>)))
    (sp-local-pair <span class="org-string">"="</span> <span class="org-string">"="</span> <span class="org-builtin">:unless</span> '(sp-point-after-word-p)
                   <span class="org-builtin">:post-handlers</span> '((<span class="org-string">"[d1]"</span> <span class="org-string">"SPC"</span>)))
    (sp-local-pair <span class="org-string">"&#171;"</span> <span class="org-string">"&#187;"</span>))

  (sp-with-modes '(java-mode c++-mode)
    (sp-local-pair <span class="org-string">"{"</span> nil
                   <span class="org-builtin">:post-handlers</span> '((<span class="org-string">"||\n[i]"</span> <span class="org-string">"RET"</span>)))
    (sp-local-pair <span class="org-string">"/*"</span> <span class="org-string">"*/"</span>
                   <span class="org-builtin">:post-handlers</span> '((<span class="org-string">" | "</span> <span class="org-string">"SPC"</span>)
                                    (<span class="org-string">"* ||\n[i]"</span> <span class="org-string">"RET"</span>))))

  (sp-with-modes '(markdown-mode gfm-mode rst-mode)
    (sp-local-pair <span class="org-string">"*"</span> <span class="org-string">"*"</span> <span class="org-builtin">:bind</span> <span class="org-string">"C-*"</span>)
    (sp-local-tag <span class="org-string">"2"</span> <span class="org-string">"**"</span> <span class="org-string">"**"</span>)
    (sp-local-tag <span class="org-string">"s"</span> <span class="org-string">"```scheme"</span> <span class="org-string">"```"</span>)
    (sp-local-tag <span class="org-string">"&lt;"</span>  <span class="org-string">"&lt;_&gt;"</span> <span class="org-string">"&lt;/_&gt;"</span>
                  <span class="org-builtin">:transform</span> 'sp-match-sgml-tags))

  (sp-local-pair 'emacs-lisp-mode <span class="org-string">"`"</span> nil
                 <span class="org-builtin">:when</span> '(sp-in-string-p))
  (sp-local-pair 'clojure-mode <span class="org-string">"`"</span> <span class="org-string">"`"</span>
                 <span class="org-builtin">:when</span> '(sp-in-string-p))
  (sp-local-pair 'minibuffer-inactive-mode <span class="org-string">"'"</span> nil
                 <span class="org-builtin">:actions</span> nil)

  (sp-with-modes 'nix-mode
    (sp-local-pair <span class="org-string">"'"</span> <span class="org-string">"'"</span>
                   <span class="org-builtin">:unless</span> '(sp-in-comment-p
                             sp-in-string-quotes-p))
    (sp-local-pair <span class="org-string">"\""</span> <span class="org-string">"\""</span>)
    (sp-local-pair <span class="org-string">"''"</span> <span class="org-string">"''"</span>
                   <span class="org-builtin">:unless</span> '(sp-in-comment-p
                             sp-in-string-quotes-p))))
</pre>
</div>
</div>
</li>

<li><a id="org7c61ea8"></a>sudo-edit<br />
<div class="outline-text-5" id="text-org7c61ea8">
<p>
<a href="https://github.com/nflath/sudo-edit">GitHub</a>
</p>

<p>
Sudo-edit lets you open a file using sudo (it actually goes through TRAMP to
achieve this).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sudo-edit
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c C-r"</span> . sudo-edit)))
</pre>
</div>
</div>
</li>

<li><a id="org57b2718"></a>Theme<br />
<div class="outline-text-5" id="text-org57b2718">
<p>
<a href="https://github.com/waymondo/apropospriate-theme">GitHub</a>
</p>

<p>
This is the theme I use &amp; it works well for this configuration. It is dark
with high contrast. We will only enable it when we are running with GUI Emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package apropospriate-theme
  <span class="org-builtin">:if</span> window-system
  <span class="org-builtin">:init</span>
  (add-to-list 'custom-theme-load-path
               (file-name-directory
                 (locate-library <span class="org-string">"apropospriate-theme"</span>)))
  (load-theme 'apropospriate-dark t))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">unless</span> (display-graphic-p)
  (set-background-color <span class="org-string">"black"</span>)
  (set-foreground-color <span class="org-string">"white"</span>))
</pre>
</div>

<p>
While apropospriate is the default, other themes can be used as well! For
instance spacemacs-theme can be enabled:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package spacemacs-common
  <span class="org-builtin">:ensure</span> spacemacs-theme
  <span class="org-builtin">:if</span> window-system
  <span class="org-builtin">:init</span>
  (add-to-list 'custom-theme-load-path
               (file-name-directory
                 (locate-library <span class="org-string">"spacemacs-theme-pkg"</span>)))
  (load-theme 'spacemacs-dark t))
</pre>
</div>
</div>
</li>

<li><a id="org8e11c38"></a>try<br />
<div class="outline-text-5" id="text-org8e11c38">
<p>
<a href="https://github.com/larstvei/Try">GitHub</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package try
  <span class="org-builtin">:commands</span> try)
</pre>
</div>
</div>
</li>

<li><a id="orga42aa20"></a>which-key<br />
<div class="outline-text-5" id="text-orga42aa20">
<p>
Which-key will tell you what key bindings are available give a prefix. Test it
out by pressing <code>C-x</code> &amp; waiting a few seconds. Each key listed is bound to a
function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package which-key
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:commands</span> which-key-mode
  <span class="org-builtin">:config</span> (which-key-mode 1))
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org1bebd76" class="outline-4">
<h4 id="org1bebd76">Built-ins</h4>
<div class="outline-text-4" id="text-org1bebd76">
<p>
These are available automatically, so these <code>use-package</code> blocks just
configure them.
</p>
</div>

<ul class="org-ul">
<li><a id="orgcf62f23"></a>ansi-color<br />
<div class="outline-text-5" id="text-orgcf62f23">
<p>
Get color/ansi codes in compilation mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ansi-color
  <span class="org-builtin">:hook</span> (compilation-filter . colorize-compilation-buffer)
  <span class="org-builtin">:preface</span>
  (autoload 'ansi-color-apply-on-region <span class="org-string">"ansi-color"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">colorize-compilation-buffer</span> ()
    (<span class="org-keyword">let</span> ((inhibit-read-only t))
      (ansi-color-apply-on-region (point-min) (point-max)))))
</pre>
</div>
</div>
</li>

<li><a id="org889cad6"></a>autorevert<br />
<div class="outline-text-5" id="text-org889cad6">
<p>
Autorevert mode makes files update when they have changed on disk. Unfortunately
this can have some issues in cases where Emacs uses the wrong file. Need to
investigate how to fix this.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package autorevert
  <span class="org-builtin">:commands</span> global-auto-revert-mode
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:config</span> (global-auto-revert-mode t))

(<span class="org-keyword">require</span> '<span class="org-constant">vc-git</span>)
(advice-add 'vc-git-find-file-hook <span class="org-builtin">:override</span>
  (<span class="org-keyword">lambda</span> ()
    <span class="org-doc">"Activate `</span><span class="org-doc"><span class="org-constant">smerge-mode</span></span><span class="org-doc">' if there is a conflict."</span>
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> buffer-file-name
               (eq (vc-state buffer-file-name 'Git) 'conflict)
               (<span class="org-keyword">save-excursion</span>
                 (goto-char (point-min))
                 (re-search-forward <span class="org-string">"^&lt;&lt;&lt;&lt;&lt;&lt;&lt; "</span> nil 'noerror)))
      (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (boundp 'smerge-mode) smerge-mode)
        (smerge-start-session))
      (<span class="org-keyword">when</span> vc-git-resolve-conflicts
        (add-hook 'after-save-hook 'vc-git-resolve-when-done nil 'local))
      (vc-message-unresolved-conflicts buffer-file-name))))
</pre>
</div>
</div>
</li>

<li><a id="org58ad8f3"></a>bug-reference<br />
<div class="outline-text-5" id="text-org58ad8f3">
<p>
Provides links to bugs listed in source code.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package bug-reference
  <span class="org-builtin">:hook</span> ((prog-mode . bug-reference-prog-mode)
         (text-mode . bug-reference-mode)))
</pre>
</div>
</div>
</li>

<li><a id="orgd1bbbfd"></a>comint<br />
<div class="outline-text-5" id="text-orgd1bbbfd">
<p>
Base mode used for shell and terminal modes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  (<span class="org-keyword">defvar</span> <span class="org-variable-name">comint-input-ring-prefix</span> <span class="org-string">": [[:digit:]]+:[[:digit:]]+;"</span>
    <span class="org-doc">"Possible prefix that may come before history elements. In</span>
<span class="org-doc">    Zshell with extended_history, this is useful."</span>)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">ffap-url-at-point</span>)
  (use-package comint
    <span class="org-builtin">:ensure</span> nil
    <span class="org-builtin">:hook</span> (comint-mode . (<span class="org-keyword">lambda</span> () (<span class="org-keyword">setq-local</span> ffap-url-at-point <span class="org-string">"/ssh:"</span>)))
    <span class="org-builtin">:preface</span>
    (autoload 'comint-write-input-ring <span class="org-string">"comint"</span>)
    (autoload 'comint-read-input-ring <span class="org-string">"comint"</span>)
    (autoload 'comint-send-invisible <span class="org-string">"comint"</span>)
    (<span class="org-keyword">defun</span> <span class="org-function-name">turn-on-comint-history</span> (history-file)
      (<span class="org-keyword">setq</span> comint-input-ring-file-name history-file)
      (comint-read-input-ring 'silent))
    (<span class="org-keyword">defun</span> <span class="org-function-name">save-history</span> ()
      (<span class="org-keyword">dolist</span> (buffer (buffer-list))
        (<span class="org-keyword">with-current-buffer</span> buffer
          (comint-write-input-ring))))
    <span class="org-builtin">:config</span>
    (advice-add 'comint-read-input-ring
                <span class="org-builtin">:override</span> (<span class="org-keyword">lambda</span> (<span class="org-type">&amp;optional</span> silent)
                            (<span class="org-keyword">cond</span> ((<span class="org-keyword">or</span> (null comint-input-ring-file-name)
                                       (equal comint-input-ring-file-name <span class="org-string">""</span>))
                                   nil)
                                  ((not (file-readable-p comint-input-ring-file-name))
                                   (<span class="org-keyword">or</span> silent
                                       (message <span class="org-string">"Cannot read history file %s"</span>
                                                comint-input-ring-file-name)))
                                  (t
                                   (<span class="org-keyword">let*</span> ((file comint-input-ring-file-name)
                                          (count 0)
                                          <span class="org-comment-delimiter">;; </span><span class="org-comment">Some users set HISTSIZE or `</span><span class="org-comment"><span class="org-constant">comint-input-ring-size</span></span><span class="org-comment">'</span>
                                          <span class="org-comment-delimiter">;; </span><span class="org-comment">to huge numbers.  Don't allocate a huge ring right</span>
                                          <span class="org-comment-delimiter">;; </span><span class="org-comment">away; there might not be that much history.</span>
                                          (ring-size (min 1500 comint-input-ring-size))
                                          (ring (make-ring ring-size)))
                                     (<span class="org-keyword">with-temp-buffer</span>
                                       (insert-file-contents file)
                                       <span class="org-comment-delimiter">;; </span><span class="org-comment">Save restriction in case file is already visited...</span>
                                       <span class="org-comment-delimiter">;; </span><span class="org-comment">Watch for those date stamps in history files!</span>
                                       (goto-char (point-max))
                                       (<span class="org-keyword">let</span> (start end history)
                                         (<span class="org-keyword">while</span> (<span class="org-keyword">and</span> (&lt; count comint-input-ring-size)
                                                     (re-search-backward comint-input-ring-separator
                                                                         nil t)
                                                     (<span class="org-keyword">setq</span> end (match-beginning 0)))
                                           (<span class="org-keyword">setq</span> start
                                                 (<span class="org-keyword">if</span> (re-search-backward comint-input-ring-separator
                                                                         nil t)
                                                     (<span class="org-keyword">progn</span>
                                                       (<span class="org-keyword">when</span> (looking-at (concat comint-input-ring-separator
                                                                                 comint-input-ring-prefix))
                                                         <span class="org-comment-delimiter">;; </span><span class="org-comment">Skip zsh extended_history stamps</span>
                                                         (re-search-forward comint-input-ring-prefix
                                                                            nil t))
                                                       (match-end 0))
                                                   (<span class="org-keyword">progn</span>
                                                     (goto-char (point-min))
                                                     (<span class="org-keyword">if</span> (looking-at comint-input-ring-prefix)
                                                         (<span class="org-keyword">progn</span>
                                                           (re-search-forward comint-input-ring-prefix
                                                                              nil t)
                                                           (match-end 0))
                                                       (point-min)))))
                                           (<span class="org-keyword">setq</span> history (buffer-substring start end))
                                           (goto-char start)
                                           (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (not (string-match comint-input-history-ignore
                                                                         history))
                                                      (<span class="org-keyword">or</span> (null comint-input-ignoredups)
                                                          (ring-empty-p ring)
                                                          (not (string-equal (ring-ref ring 0)
                                                                             history))))
                                             (<span class="org-keyword">when</span> (= count ring-size)
                                               (ring-extend ring (min (- comint-input-ring-size ring-size)
                                                                      ring-size))
                                               (<span class="org-keyword">setq</span> ring-size (ring-size ring)))
                                             (ring-insert-at-beginning ring history)
                                             (<span class="org-keyword">setq</span> count (1+ count))))))
                                     (<span class="org-keyword">setq</span> comint-input-ring ring
                                           comint-input-ring-index nil)))))))

(use-package comint-hyperlink
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:commands</span> (comint-hyperlink-process-output)
  <span class="org-builtin">:init</span> (add-to-list 'comint-output-filter-functions 'comint-hyperlink-process-output))
</pre>
</div>
</div>
</li>

<li><a id="orgc373da8"></a>compile<br />
<div class="outline-text-5" id="text-orgc373da8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package compile
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c C-c"</span> . compile)
         <span class="org-builtin">:map</span> compilation-mode-map
         (<span class="org-string">"o"</span> . compile-goto-error))
  <span class="org-builtin">:preface</span>
  (autoload 'ansi-color-process-output <span class="org-string">"ansi-color"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">show-compilation</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((compile-buf
           (<span class="org-keyword">catch</span> '<span class="org-constant">found</span>
             (<span class="org-keyword">dolist</span> (buf (buffer-list))
               (<span class="org-keyword">if</span> (string-match <span class="org-string">"\\*compilation\\*"</span>
                                 (buffer-name buf))
                   (<span class="org-keyword">throw</span> '<span class="org-constant">found</span> buf))))))
      (<span class="org-keyword">if</span> compile-buf
          (switch-to-buffer-other-window compile-buf)
        (call-interactively 'compile))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">compilation-ansi-color-process-output</span> ()
    (ansi-color-process-output nil)
    (set (make-local-variable 'comint-last-output-start)
         (point-marker)))
  <span class="org-builtin">:hook</span> (compilation-filter .
         compilation-ansi-color-process-output))
</pre>
</div>
</div>
</li>

<li><a id="org638d22c"></a>conf-mode<br />
<div class="outline-text-5" id="text-org638d22c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package conf-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"/\\.merlin\\'"</span> . conf-mode)
         (<span class="org-string">"_oasis\\'"</span> . conf-mode)
         (<span class="org-string">"_tags\\'"</span> . conf-mode)
         (<span class="org-string">"_log\\'"</span> . conf-mode)))
</pre>
</div>
</div>
</li>
<li><a id="org93b899e"></a>delsel<br />
<div class="outline-text-5" id="text-org93b899e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package delsel
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:commands</span> delete-selection-mode
  <span class="org-builtin">:config</span> (delete-selection-mode t))
</pre>
</div>
</div>
</li>

<li><a id="orgfb58bbb"></a>desktop<br />
<div class="outline-text-5" id="text-orgfb58bbb">
<p>
You may want to enable this to persist info across Emacs sessions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package desktop
  <span class="org-builtin">:disabled</span>
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:commands</span> delete-save-mode
  <span class="org-builtin">:config</span>
    (<span class="org-keyword">setq</span> desktop-dirname user-emacs-directory)
    (desktop-save-mode t))
</pre>
</div>
</div>
</li>

<li><a id="org2f2efa8"></a>dired<br />
<div class="outline-text-5" id="text-org2f2efa8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:preface</span>
  (autoload 'dired-get-filename <span class="org-string">"dired"</span>)
  (autoload 'term-set-escape-char <span class="org-string">"term"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">dired-run-command</span> (<span class="org-type">&amp;optional</span> filename)
    <span class="org-doc">"Run file at point in a new buffer."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">unless</span> filename
      (<span class="org-keyword">setq</span> filename (expand-file-name
                      (dired-get-filename t t)
                      default-directory)))
    (<span class="org-keyword">let</span> ((buffer (make-term
                    (file-name-nondirectory filename)
                    filename))
          (buffer-read-only nil))
      (<span class="org-keyword">with-current-buffer</span> buffer
        <span class="org-comment-delimiter">;; </span><span class="org-comment">(term-mode)</span>
        (term-char-mode)
        (term-set-escape-char ?\C-x))
      (set-process-sentinel
        (get-buffer-process buffer)
        (<span class="org-keyword">lambda</span> (proc event)
           (<span class="org-keyword">when</span> (not (process-live-p proc))
             (kill-buffer (process-buffer proc)))))
      (switch-to-buffer buffer)))
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c J"</span> . dired-double-jump)
         <span class="org-builtin">:package</span> dired
         <span class="org-builtin">:map</span> dired-mode-map
         (<span class="org-string">"C-c C-c"</span> . compile)
         (<span class="org-string">"r"</span> . term)
         (<span class="org-string">"M-@"</span> . shell)
         (<span class="org-string">"M-*"</span> . eshell)
         (<span class="org-string">"W"</span> . browse-url-of-dired-file)
         (<span class="org-string">"@"</span> . dired-run-command)))
(use-package dired-du
  <span class="org-builtin">:commands</span> dired-du-mode)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org3d46ad1"></a>dired-column<br />
<div class="outline-text-6" id="text-org3d46ad1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-column
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:package</span> dired
                  <span class="org-builtin">:map</span> dired-mode-map
                  (<span class="org-string">"o"</span> . dired-column-find-file)))
</pre>
</div>
</div>
</li>

<li><a id="org488a562"></a>dired-subtree<br />
<div class="outline-text-6" id="text-org488a562">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-subtree
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:package</span> dired
                  <span class="org-builtin">:map</span> dired-mode-map
                  (<span class="org-string">"&lt;tab&gt;"</span> . dired-subtree-toggle)
                  (<span class="org-string">"TAB"</span> . dired-subtree-toggle)
                  (<span class="org-string">"&lt;backtab&gt;"</span> . dired-subtree-cycle)))
</pre>
</div>
</div>
</li>

<li><a id="org7800287"></a>dired-x<br />
<div class="outline-text-6" id="text-org7800287">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-x
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:hook</span> ((dired-mode . dired-omit-mode))
  <span class="org-builtin">:bind</span> ((<span class="org-string">"s-\\"</span> . dired-jump-other-window)
         <span class="org-builtin">:package</span> dired
         <span class="org-builtin">:map</span> dired-mode-map
         (<span class="org-string">")"</span> . dired-omit-mode)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org45d92c1"></a>display-line-numbers<br />
<div class="outline-text-5" id="text-org45d92c1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package display-line-numbers
  <span class="org-builtin">:commands</span> (display-line-numbers-mode)
  <span class="org-builtin">:hook</span> ((prog-mode . display-line-numbers-mode)
         (conf-mode . display-line-numbers-mode)))
</pre>
</div>
</div>
</li>
<li><a id="org22b7b55"></a>eldoc<br />
<div class="outline-text-5" id="text-org22b7b55">
<p>
Provides some info for the thing at the point.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eldoc
  <span class="org-builtin">:hook</span> ((emacs-lisp-mode . eldoc-mode)
         (eval-expression-minibuffer-setup . eldoc-mode)
         (lisp-mode-interactive-mode . eldoc-mode)
         (typescript-mode . eldoc-mode)
         (haskell-mode . eldoc-mode)
         (python-mode . eldoc-mode)
         (eshell-mode . eldoc-mode)
         (org-mode . eldoc-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org38ddda8"></a>electric<br />
<div class="outline-text-5" id="text-org38ddda8">
<p>
Setup these modes:
</p>

<ul class="org-ul">
<li>electric-quote</li>
<li>electric-indent</li>
<li>electric-layout</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package electric
  <span class="org-builtin">:if</span> (&gt;= emacs-major-version 25)
  <span class="org-builtin">:hook</span> ((prog-mode . electric-quote-local-mode)
         (text-mode . electric-quote-local-mode)
         (org-mode . electric-quote-local-mode)
         (message-mode . electric-quote-local-mode)
         (prog-mode . electric-indent-local-mode)
         (prog-mode . electric-layout-mode)
         (haskell-mode . (<span class="org-keyword">lambda</span> () (electric-indent-local-mode -1)))
         (nix-mode . (<span class="org-keyword">lambda</span> () (electric-indent-local-mode -1)))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org67706f3"></a>elec-pair<br />
<div class="outline-text-6" id="text-org67706f3">
<p>
Setup electric-pair-mode for prog-modes. Also disable it when smartparens is
setup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elec-pair
  <span class="org-builtin">:if</span> (&gt;= emacs-major-version 25)
  <span class="org-builtin">:hook</span>
   ((prog-mode . electric-pair-local-mode)
    (smartparens-mode . (<span class="org-keyword">lambda</span> ()
      (electric-pair-local-mode -1)))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org771843c"></a>eww<br />
<div class="outline-text-5" id="text-org771843c">
<p>
eww is enabled so we can open files in non-graphical environments.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eww
  <span class="org-builtin">:if</span> (<span class="org-keyword">and</span> (not window-system)
           (not (string-equal
                  (getenv <span class="org-string">"TERM_PROGRAM"</span>)
                  <span class="org-string">"Apple_Terminal"</span>)))
  <span class="org-builtin">:commands</span> (eww-browse-url eww-reload)
  <span class="org-builtin">:config</span>
  (add-hook 'eww-mode-hook (<span class="org-keyword">lambda</span> ()
    (add-hook 'text-scale-mode-hook (<span class="org-keyword">lambda</span> (<span class="org-type">&amp;rest</span> _) (eww-reload t)) nil t)
    (add-hook 'window-size-change-functions (<span class="org-keyword">lambda</span> (<span class="org-type">&amp;rest</span> _) (eww-reload t)) nil t)))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> browse-url-browser-function 'eww-browse-url))
</pre>
</div>
</div>
</li>
<li><a id="org9b28479"></a>executable<br />
<div class="outline-text-5" id="text-org9b28479">
<p>
Make scripts executable automatically.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package executable
  <span class="org-builtin">:hook</span>
  ((after-save .
    executable-make-buffer-file-executable-if-script-p)))
</pre>
</div>
</div>
</li>

<li><a id="orgad651eb"></a>ffap<br />
<div class="outline-text-5" id="text-orgad651eb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ffap
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-x C-f"</span> . find-file-at-point)
         (<span class="org-string">"C-x 4 C-f"</span> . ffap-other-window)
         (<span class="org-string">"C-x C-r"</span> . ffap-read-only)
         (<span class="org-string">"C-x C-v"</span> . ffap-alternate-file)
         (<span class="org-string">"C-x 4 f"</span> . ffap-other-window)
         (<span class="org-string">"C-x 5 f"</span> . ffap-other-frame)
         (<span class="org-string">"C-x 4 r"</span> . ffap-read-only-other-window)
         (<span class="org-string">"C-x 5 r"</span> . ffap-read-only-other-frame)
         (<span class="org-string">"C-x d"</span>  . dired-at-point)
         (<span class="org-string">"C-x 4 d"</span> . ffap-dired-other-window)
         (<span class="org-string">"C-x 5 d"</span> . ffap-dired-other-frame)
         (<span class="org-string">"C-x C-d"</span> . ffap-list-directory))
  <span class="org-builtin">:hook</span> ((gnus-summary-mode . ffap-gnus-hook)
         (gnus-article-mode . ffap-gnus-hook)
         (vm-mode . ffap-ro-mode-hook)
         (rmail-mode . ffap-ro-mode-hook)))
</pre>
</div>
</div>
</li>
<li><a id="orgd96ce03"></a>files<br />
<div class="outline-text-5" id="text-orgd96ce03">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package files
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">find-file--line-number</span> (orig-fun filename
                                 <span class="org-type">&amp;optional</span> wildcards)
    <span class="org-doc">"Turn files like file.js:14:10 into file.js and going to line 14, col 10."</span>
    (<span class="org-keyword">save-match-data</span>
      (<span class="org-keyword">let*</span> ((matched (string-match
                        <span class="org-string">"^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span>
                        filename))
             (line-number (<span class="org-keyword">and</span> matched
                            (match-string 2 filename)
                            (string-to-number
                              (match-string 2 filename))))
             (col-number (<span class="org-keyword">and</span> matched
                            (match-string 3 filename)
                            (string-to-number (match-string 3 filename))))
             (filename (<span class="org-keyword">if</span> matched
                           (match-string 1 filename)
                           filename)))
        (apply orig-fun (list filename wildcards))
        (<span class="org-keyword">when</span> line-number
          <span class="org-comment-delimiter">;; </span><span class="org-comment">goto-line is for interactive use</span>
          (goto-char (point-min))
          (forward-line (1- line-number))
          (<span class="org-keyword">when</span> (&gt; col-number 0)
            (forward-char (1- col-number)))))))
  <span class="org-builtin">:config</span>
  (advice-add 'find-file
              <span class="org-builtin">:around</span> #'find-file--line-number))
</pre>
</div>
</div>
</li>

<li><a id="org0d5dddb"></a>flyspell<br />
<div class="outline-text-5" id="text-org0d5dddb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flyspell
  <span class="org-builtin">:if</span> (locate-file
       (<span class="org-keyword">if</span> (boundp 'ispell-program-name)
           ispell-program-name <span class="org-string">"aspell"</span>)
       exec-path)
  <span class="org-builtin">:hook</span> ((text-mode . flyspell-mode)
         (prog-mode . flyspell-prog-mode))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> flyspell-mode-map
              (<span class="org-string">"C-M-i"</span> . nil)))
</pre>
</div>
</div>
</li>

<li><a id="org9172289"></a>goto-addr<br />
<div class="outline-text-5" id="text-org9172289">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package goto-addr
  <span class="org-builtin">:hook</span> (((prog-mode conf-mode) . goto-address-prog-mode)
         ((help-mode org-mode text-mode) . goto-address-mode)
         (git-commit-mode . goto-address-mode)
         (shell-mode . goto-address-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org41a7410"></a>hl-line<br />
<div class="outline-text-5" id="text-org41a7410">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hl-line
  <span class="org-builtin">:hook</span> ((prog-mode . hl-line-mode)
         (org-mode . hl-line-mode)
         (dired-mode . hl-line-mode)))
</pre>
</div>
</div>
</li>
<li><a id="orgf18c3de"></a>make-mode<br />
<div class="outline-text-5" id="text-orgf18c3de">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package make-mode
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:mode</span> ((<span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\`</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[Mm]akefile"</span> . makefile-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org96a5f74"></a>paren<br />
<div class="outline-text-5" id="text-org96a5f74">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package paren
  <span class="org-builtin">:hook</span> ((prog-mode . show-paren-mode)
         (smartparens-mode . (<span class="org-keyword">lambda</span> () (show-paren-mode -1)))))
</pre>
</div>
</div>
</li>

<li><a id="orgfbad720"></a>pp<br />
<div class="outline-text-5" id="text-orgfbad720">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pp
  <span class="org-builtin">:commands</span> pp-eval-last-sexp
  <span class="org-builtin">:bind</span> (([remap eval-expression] . pp-eval-expression))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:init</span>
  <span class="org-comment-delimiter">;;</span><span class="org-comment">(global-unset-key (kbd "C-x C-e"))</span>
  <span class="org-builtin">:hook</span> ((lisp-mode emacs-lisp-mode) . always-eval-sexp)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">always-eval-sexp</span> ()
    (define-key (current-local-map)
                (kbd <span class="org-string">"C-x C-e"</span>)
                'pp-eval-last-sexp)))
</pre>
</div>
</div>
</li>

<li><a id="orgc162e9b"></a>prog-mode<br />
<div class="outline-text-5" id="text-orgc162e9b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package prog-mode
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:hook</span> (<span class="org-comment-delimiter">;; </span><span class="org-comment">(prog-mode . prettify-symbols-mode)</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(lisp-mode . prettify-symbols-lisp)</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(c-mode . prettify-symbols-c)</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(c++-mode . prettify-symbols-c++)</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">((js-mode js2-mode) . prettify-symbols-js)</span>
         (prog-mode . (<span class="org-keyword">lambda</span> ()
           (<span class="org-keyword">setq-local</span> scroll-margin 3))))
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">prettify-symbols-prog</span> ()
    (<span class="org-keyword">push</span> '(<span class="org-string">"&lt;="</span> . ?&#8804;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&gt;="</span> . ?&#8805;) prettify-symbols-alist))
  (<span class="org-keyword">defun</span> <span class="org-function-name">prettify-symbols-lisp</span> ()
    (<span class="org-keyword">push</span> '(<span class="org-string">"/="</span> . ?&#8800;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"sqrt"</span> . ?&#8730;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"not"</span> . ?&#172;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"and"</span> . ?&#8743;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"or"</span> . ?&#8744;) prettify-symbols-alist))
  (<span class="org-keyword">defun</span> <span class="org-function-name">prettify-symbols-c</span> ()
    (<span class="org-keyword">push</span> '(<span class="org-string">"&lt;="</span> . ?&#8804;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&gt;="</span> . ?&#8805;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"!="</span> . ?&#8800;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&amp;&amp;"</span> . ?&#8743;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"||"</span> . ?&#8744;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&gt;&gt;"</span> . ?&#187;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&lt;&lt;"</span> . ?&#171;) prettify-symbols-alist))
  (<span class="org-keyword">defun</span> <span class="org-function-name">prettify-symbols-c++</span> ()
    (<span class="org-keyword">push</span> '(<span class="org-string">"&lt;="</span> . ?&#8804;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&gt;="</span> . ?&#8805;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"!="</span> . ?&#8800;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&amp;&amp;"</span> . ?&#8743;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"||"</span> . ?&#8744;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&gt;&gt;"</span> . ?&#187;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"&lt;&lt;"</span> . ?&#171;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"-&gt;"</span> . ?&#8594;) prettify-symbols-alist))
  (<span class="org-keyword">defun</span> <span class="org-function-name">prettify-symbols-js</span> ()
    (<span class="org-keyword">push</span> '(<span class="org-string">"function"</span> . ?&#955;) prettify-symbols-alist)
    (<span class="org-keyword">push</span> '(<span class="org-string">"=&gt;"</span> . ?&#8658;) prettify-symbols-alist)))
</pre>
</div>
</div>
</li>

<li><a id="org4e7fce7"></a>savehist-mode<br />
<div class="outline-text-5" id="text-org4e7fce7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package savehist
  <span class="org-builtin">:hook</span> (after-init . savehist-mode))
</pre>
</div>
</div>
</li>

<li><a id="org70ece2b"></a>saveplace-mode<br />
<div class="outline-text-5" id="text-org70ece2b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package saveplace
  <span class="org-builtin">:if</span> (&gt;= emacs-major-version 25)
  <span class="org-builtin">:hook</span> (after-init . save-place-mode))
</pre>
</div>
</div>
</li>

<li><a id="org617ab2d"></a>Shell<br />
<div class="outline-text-5" id="text-org617ab2d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package shell
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c C-s"</span> . shell)
         (<span class="org-string">"H-s"</span> . shell)
         (<span class="org-string">"M-@"</span> . shell))
  <span class="org-builtin">:hook</span> ((shell-mode . ansi-color-for-comint-mode-on)
         (shell-mode . dirtrack-mode)
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(shell-mode . (lambda ()</span>
         <span class="org-comment-delimiter">;;            </span><span class="org-comment">(turn-on-comint-history (expand-file-name "sh-history"</span>
         <span class="org-comment-delimiter">;;            </span><span class="org-comment">user-emacs-directory))))</span>
         ))
</pre>
</div>
</div>
</li>

<li><a id="org1123c13"></a>simple<br />
<div class="outline-text-5" id="text-org1123c13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package simple
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:commands</span> (column-number-mode auto-fill-mode)
  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"C-`"</span> . list-processes)
   <span class="org-builtin">:map</span> minibuffer-local-map
   (<span class="org-string">"&lt;escape&gt;"</span>         . abort-recursive-edit)
   (<span class="org-string">"M-TAB"</span>    . previous-complete-history-element)
   (<span class="org-string">"&lt;M-S-tab&gt;"</span> . next-complete-history-element))
  <span class="org-builtin">:hook</span> ((text-mode . visual-line-mode)
         (text-mode . auto-fill-mode))
  <span class="org-builtin">:config</span> (column-number-mode))
</pre>
</div>
</div>
</li>
<li><a id="orge43f04e"></a>subword<br />
<div class="outline-text-5" id="text-orge43f04e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package subword
  <span class="org-builtin">:hook</span> ((java-mode . subword-mode)))
</pre>
</div>
</div>
</li>

<li><a id="orgd9d675f"></a>term<br />
<div class="outline-text-5" id="text-orgd9d675f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package term
  <span class="org-builtin">:commands</span> (term-mode term-char-mode)
  <span class="org-builtin">:hook</span> ((term-mode .
           (<span class="org-keyword">lambda</span> ()
             (<span class="org-keyword">setq</span> term-prompt-regexp
                   <span class="org-string">"^[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">#$%&gt;\n]*[#$%&gt;] *"</span>)
             (<span class="org-keyword">setq-local</span> transient-mark-mode nil)
             (auto-fill-mode -1))))
  <span class="org-builtin">:preface</span>
  (autoload 'tramp-tramp-file-p <span class="org-string">"tramp"</span>)
  (autoload 'tramp-dissect-file-name <span class="org-string">"tramp"</span>))

(use-package tramp-term
  <span class="org-builtin">:commands</span> tramp-term
  <span class="org-builtin">:functions</span> term-send-raw-string
  <span class="org-builtin">:hook</span> (tramp-term-after-initialized . (<span class="org-keyword">lambda</span> (host)
    (term-send-raw-string (concat <span class="org-string">"cd "</span> default-directory (kbd <span class="org-string">"RET"</span>))))))
</pre>
</div>
</div>
</li>

<li><a id="orge765d74"></a>text-mode<br />
<div class="outline-text-5" id="text-orge765d74">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package text-mode
  <span class="org-builtin">:no-require</span>
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:hook</span> ((text-mode . turn-on-auto-fill)))
</pre>
</div>
</div>
</li>

<li><a id="org435929c"></a>time<br />
<div class="outline-text-5" id="text-org435929c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package time
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:config</span> (display-time-mode))
</pre>
</div>
</div>
</li>

<li><a id="org612f8de"></a>url-handlers<br />
<div class="outline-text-5" id="text-org612f8de">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package url-handlers
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:commands</span> url-handler-mode
  <span class="org-builtin">:config</span> (url-handler-mode))
</pre>
</div>
</div>
</li>

<li><a id="org9f61331"></a>which-func<br />
<div class="outline-text-5" id="text-org9f61331">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package which-func
  <span class="org-builtin">:commands</span> which-function-mode
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:config</span> (which-function-mode))
</pre>
</div>
</div>
</li>
<li><a id="org3b9c6b8"></a>whitespace<br />
<div class="outline-text-5" id="text-org3b9c6b8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package whitespace
  <span class="org-builtin">:hook</span> (prog-mode . whitespace-mode))
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-org747d5b6" class="outline-4">
<h4 id="org747d5b6">Programming languages</h4>
<div class="outline-text-4" id="text-org747d5b6">
<p>
Each <code>use-package</code> declaration corresponds to <code>major modes</code> in Emacs lingo.
Each language will at least one of these major modes as well as associated
packages (for completion, syntax checking, etc.)
</p>
</div>

<ul class="org-ul">
<li><a id="org1df8c68"></a>C/C++<br />
<div class="outline-text-5" id="text-org1df8c68">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cc-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.h</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">h?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">xx</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">pp</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span> . c++-mode)
         (<span class="org-string">"\\.m\\'"</span> . c-mode)
         (<span class="org-string">"\\.c\\'"</span> . c-mode)
         (<span class="org-string">"\\.cpp\\'"</span> . c++-mode)
         (<span class="org-string">"\\.c++\\'"</span> . c++-mode)
         (<span class="org-string">"\\.mm\\'"</span> . c++-mode)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org91c21cc"></a>Irony<br />
<div class="outline-text-6" id="text-org91c21cc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package irony
  <span class="org-builtin">:preface</span>
  (autoload 'file-remote-p <span class="org-string">"files"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">irony-mode-disable-remote</span> ()
    <span class="org-doc">"Disabled irony in remote buffers."</span>
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> buffer-file-name
               (file-remote-p buffer-file-name))
      (irony-mode -1)))
  <span class="org-builtin">:hook</span> (((c++-mode c-mode objc-mode) .
          irony-mode-disable-remote)
         ((c++-mode c-mode objc-mode) . irony-mode)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package irony-cdb
    <span class="org-builtin">:ensure</span> nil
    <span class="org-builtin">:hook</span> (irony-mode . irony-cdb-autosetup-compile-options))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org236af22"></a>flycheck-irony<br />
<div class="outline-text-7" id="text-org236af22">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flycheck-irony
  <span class="org-builtin">:hook</span> (flycheck-mode . flycheck-irony-setup))
</pre>
</div>
</div>
</li>

<li><a id="org983ed2a"></a>irony-eldoc<br />
<div class="outline-text-7" id="text-org983ed2a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package irony-eldoc
  <span class="org-builtin">:hook</span> (irony-mode . irony-eldoc))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgd2dbca3"></a>CMake<br />
<div class="outline-text-5" id="text-orgd2dbca3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cmake-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.cmake\\'"</span> . cmake-mode)
         (<span class="org-string">"\\CMakeLists.txt$"</span> . cmake-mode)))
</pre>
</div>
</div>
</li>


<li><a id="org9fa2e91"></a>CoffeeScript<br />
<div class="outline-text-5" id="text-org9fa2e91">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package coffee-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.coffee\\'"</span> . coffee-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org41807d6"></a>CSS<br />
<div class="outline-text-5" id="text-org41807d6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package css-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.css\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org1e5efc4"></a>CSV<br />
<div class="outline-text-5" id="text-org1e5efc4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package csv-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.csv\\'"</span>
  <span class="org-builtin">:hook</span> ((csv-mode . (<span class="org-keyword">lambda</span> () (visual-line-mode -1)))
         (csv-mode . (<span class="org-keyword">lambda</span> () (auto-fill-mode -1)))
         (csv-mode . (<span class="org-keyword">lambda</span> () (toggle-truncate-lines 1)))))
</pre>
</div>
</div>
</li>

<li><a id="orga39b1da"></a>ELF<br />
<div class="outline-text-5" id="text-orga39b1da">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elf-mode
  <span class="org-builtin">:magic</span> (<span class="org-string">"&#127;ELF"</span> . elf-mode))
</pre>
</div>
</div>
</li>

<li><a id="org83d2800"></a>Emacs speaks statistics<br />
<div class="outline-text-5" id="text-org83d2800">
<p>
<a href="https://ess.r-project.org">Website</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ess-site
  <span class="org-builtin">:ensure</span> ess
  <span class="org-builtin">:no-require</span>
  <span class="org-builtin">:interpreter</span> ((<span class="org-string">"Rscript"</span> . r-mode)
                (<span class="org-string">"r"</span> . r-mode))
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.sp\\'"</span>          . S-mode)
         (<span class="org-string">"/R/.*\\.q\\'"</span>      . R-mode)
         (<span class="org-string">"\\.[qsS]\\'"</span>       . S-mode)
         (<span class="org-string">"\\.ssc\\'"</span>         . S-mode)
         (<span class="org-string">"\\.SSC\\'"</span>         . S-mode)
         (<span class="org-string">"\\.[rR]\\'"</span>        . R-mode)
         (<span class="org-string">"\\.[rR]nw\\'"</span>      . Rnw-mode)
         (<span class="org-string">"\\.[sS]nw\\'"</span>      . Snw-mode)
         (<span class="org-string">"\\.[rR]profile\\'"</span> . R-mode)
         (<span class="org-string">"NAMESPACE\\'"</span>      . R-mode)
         (<span class="org-string">"CITATION\\'"</span>       . R-mode)
         (<span class="org-string">"\\.omg\\'"</span>         . omegahat-mode)
         (<span class="org-string">"\\.hat\\'"</span>         . omegahat-mode)
         (<span class="org-string">"\\.lsp\\'"</span>         . XLS-mode)
         (<span class="org-string">"\\.do\\'"</span>          . STA-mode)
         (<span class="org-string">"\\.ado\\'"</span>         . STA-mode)
         (<span class="org-string">"\\.[Ss][Aa][Ss]\\'"</span>        . SAS-mode)
         (<span class="org-string">"\\.[Ss]t\\'"</span>       . S-transcript-mode)
         (<span class="org-string">"\\.Sout"</span>           . S-transcript-mode)
         (<span class="org-string">"\\.[Rr]out"</span>        . R-transcript-mode)
         (<span class="org-string">"\\.Rd\\'"</span>          . Rd-mode)
         (<span class="org-string">"\\.[Bb][Uu][Gg]\\'"</span>         . ess-bugs-mode)
         (<span class="org-string">"\\.[Bb][Oo][Gg]\\'"</span>         . ess-bugs-mode)
         (<span class="org-string">"\\.[Bb][Mm][Dd]\\'"</span>         . ess-bugs-mode)
         (<span class="org-string">"\\.[Jj][Aa][Gg]\\'"</span>         . ess-jags-mode)
         (<span class="org-string">"\\.[Jj][Oo][Gg]\\'"</span>         . ess-jags-mode)
         (<span class="org-string">"\\.[Jj][Mm][Dd]\\'"</span>         . ess-jags-mode)
         ))
</pre>
</div>
</div>
</li>

<li><a id="org9733803"></a>git-modes<br />
<ul class="org-ul">
<li><a id="org3c78e36"></a>gitattributes<br />
<div class="outline-text-6" id="text-org3c78e36">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gitattributes-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"/\\.gitattributes\\'"</span>  . gitattributes-mode)
         (<span class="org-string">"/info/attributes\\'"</span>   . gitattributes-mode)
         (<span class="org-string">"/git/attributes\\'"</span>    . gitattributes-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org49d9a96"></a>gitconfig<br />
<div class="outline-text-6" id="text-org49d9a96">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gitconfig-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"/\\.gitconfig\\'"</span>      . gitconfig-mode)
         (<span class="org-string">"/\\.git/config\\'"</span>     . gitconfig-mode)
         (<span class="org-string">"/modules/.*/config\\'"</span> . gitconfig-mode)
         (<span class="org-string">"/git/config\\'"</span>        . gitconfig-mode)
         (<span class="org-string">"/\\.gitmodules\\'"</span>     . gitconfig-mode)
         (<span class="org-string">"/etc/gitconfig\\'"</span>     . gitconfig-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org0186b5c"></a>gitignore<br />
<div class="outline-text-6" id="text-org0186b5c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gitignore-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"/\\.gitignore\\'"</span>      . gitignore-mode)
         (<span class="org-string">"/info/exclude\\'"</span>      . gitignore-mode)
         (<span class="org-string">"/git/ignore\\'"</span>        . gitignore-mode)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgdc6385c"></a>Go<br />
<div class="outline-text-5" id="text-orgdc6385c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package go-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.go\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org7c19e36"></a>HAML<br />
<div class="outline-text-5" id="text-org7c19e36">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package haml-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.haml\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgd0959e6"></a>Haskell<br />
<ul class="org-ul">
<li><a id="org24eb402"></a>haskell-mode<br />
<div class="outline-text-6" id="text-org24eb402">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package haskell
  <span class="org-builtin">:preface</span>
  (load <span class="org-string">"haskell-mode-autoloads"</span> t t)
  <span class="org-builtin">:ensure</span> haskell-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.hs</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">c</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">-boot</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?\\'"</span> . haskell-mode)
         (<span class="org-string">"\\.lhs\\'"</span> . literate-haskell-mode)
         (<span class="org-string">"\\.cabal\\'"</span> . haskell-cabal-mode))
  <span class="org-builtin">:hook</span> ((haskell-mode . subword-mode)
         (haskell-mode . flyspell-prog-mode)
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(haskell-mode . haskell-indentation-mode)</span>
         (haskell-mode . haskell-auto-insert-module-template)
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(haskell-mode . haskell-decl-scan-mode)</span>
         (haskell-mode . haskell-indent-mode)
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(haskell-mode . imenu-add-menubar-index)</span>
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(haskell-mode .</span>
         <span class="org-comment-delimiter">;;          </span><span class="org-comment">(lambda ()</span>
         <span class="org-comment-delimiter">;;            </span><span class="org-comment">(autoload 'haskell-doc-current-info</span>
         <span class="org-comment-delimiter">;;              </span><span class="org-comment">"haskell-doc")</span>
         <span class="org-comment-delimiter">;;            </span><span class="org-comment">(setq-local eldoc-documentation-function</span>
         <span class="org-comment-delimiter">;;                        </span><span class="org-comment">'haskell-doc-current-info)))</span>
         )
  <span class="org-builtin">:functions</span> xref-push-marker-stack
  <span class="org-builtin">:commands</span> (haskell-session-maybe haskell-mode-find-def haskell-ident-at-point
              haskell-mode-handle-generic-loc)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> haskell-mode-map
         (<span class="org-string">"C-c h"</span> . haskell-hoogle)
         (<span class="org-string">"C-c C-."</span> . haskell-navigate-imports)
         (<span class="org-string">"C-`"</span> . haskell-interactive-bring)
         (<span class="org-string">"C-c `"</span> . haskell-interactive-bring)
         (<span class="org-string">"C-c C-t"</span> . haskell-process-do-type)
         (<span class="org-string">"C-c C-i"</span> . haskell-process-do-info)
         (<span class="org-string">"C-c C-c"</span> . haskell-process-cabal-build)
         (<span class="org-string">"C-c C-k"</span> . haskell-interactive-mode-clear)
         (<span class="org-string">"C-c c"</span> . haskell-process-cabal)
         <span class="org-comment-delimiter">;; </span><span class="org-comment">("M-." . haskell-mode-jump-to-def)</span>
         <span class="org-builtin">:map</span> haskell-cabal-mode-map
         (<span class="org-string">"C-`"</span> . haskell-interactive-bring)
         (<span class="org-string">"C-c C-k"</span> . haskell-interactive-mode-clear)
         (<span class="org-string">"C-c C-c"</span> . haskell-process-cabal-build)
         (<span class="org-string">"C-c c"</span> . haskell-process-cabal)
         <span class="org-builtin">:map</span> interactive-haskell-mode-map
         (<span class="org-string">"M-."</span> . (<span class="org-keyword">lambda</span> (<span class="org-type">&amp;optional</span> _next-p)
                    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
                    (<span class="org-keyword">if</span> (haskell-session-maybe)
                        (<span class="org-keyword">let</span> ((initial-loc (point-marker))
                              (loc (haskell-mode-find-def (haskell-ident-at-point))))
                          (<span class="org-keyword">if</span> loc
                              (<span class="org-keyword">progn</span>
                                (haskell-mode-handle-generic-loc loc)
                                (<span class="org-keyword">unless</span> (equal initial-loc (point-marker))
                                  (xref-push-marker-stack initial-loc)))
                            (call-interactively 'haskell-mode-tag-find)))
                      (call-interactively 'haskell-mode-tag-find))))
         (<span class="org-string">"C-c C-t"</span> . haskell-mode-show-type-at))
  <span class="org-builtin">:init</span>
  (add-to-list 'completion-ignored-extensions <span class="org-string">".hi"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org9c0a63c"></a>haskell-interactive-mode<br />
<div class="outline-text-6" id="text-org9c0a63c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package haskell-interactive-mode
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:commands</span> interactive-haskell-mode
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:hook (haskell-mode . interactive-haskell-mode)</span>
  )
</pre>
</div>
</div>
</li>

<li><a id="org8c09339"></a>nix-haskell<br />
<div class="outline-text-6" id="text-org8c09339">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nix-haskell-mode
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:disabled</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:hook (haskell-mode . nix-haskell-mode)</span>
  )
</pre>
</div>
</div>
</li>
</ul>
</li>


<li><a id="orgb8771e0"></a>Java<br />
<ul class="org-ul">
<li><a id="orgf5b326b"></a>jdee<br />
<div class="outline-text-6" id="text-orgf5b326b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package jdee
  <span class="org-builtin">:disabled</span>
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.java\\'"</span> . jdee-mode)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:package</span> jdee
         <span class="org-builtin">:map</span> jdee-mode-map
         (<span class="org-string">"&lt;s-mouse-1&gt;"</span> . jdee-open-class-at-event)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orge846608"></a>JavaScript<br />
<ul class="org-ul">
<li><a id="orgc8f2628"></a>indium<br />
<div class="outline-text-6" id="text-orgc8f2628">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package indium
  <span class="org-builtin">:if</span> (&gt;= emacs-major-version 25)
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.js\\'"</span> . indium-mode))
</pre>
</div>
</div>
</li>

<li><a id="org75fc895"></a>js2-mode<br />
<div class="outline-text-6" id="text-org75fc895">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package js2-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.js\\'"</span> . js2-mode)
         (<span class="org-string">"\\.es6\\'"</span> . js2-mode)
         (<span class="org-string">"\\.ejs\\'"</span> . js2-mode))
  <span class="org-builtin">:interpreter</span> <span class="org-string">"node"</span>)
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org049d684"></a>js2-imenu-extras<br />
<div class="outline-text-7" id="text-org049d684">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package js2-imenu-extras
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:hook</span> (js2-mode . js2-imenu-extras-mode))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org6944d90"></a>tern<br />
<div class="outline-text-6" id="text-org6944d90">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tern
  <span class="org-builtin">:if</span> (locate-file <span class="org-string">"tern"</span> exec-path)
  <span class="org-builtin">:hook</span> (js2-mode . tern-mode))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org6d3a7ea"></a>JSON<br />
<div class="outline-text-5" id="text-org6d3a7ea">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package json-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.bowerrc$"</span>     . json-mode)
         (<span class="org-string">"\\.jshintrc$"</span>    . json-mode)
         (<span class="org-string">"\\.json_schema$"</span> . json-mode)
         (<span class="org-string">"\\.json\\'"</span> . json-mode))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:package</span> json-mode-map
         <span class="org-builtin">:map</span> json-mode-map
         (<span class="org-string">"C-c &lt;tab&gt;"</span> . json-mode-beautify))
  <span class="org-builtin">:config</span>
  (make-local-variable 'js-indent-level))
</pre>
</div>
</div>
</li>

<li><a id="orgfe2d9e7"></a>LaTeX<br />
<ul class="org-ul">
<li><a id="orgd993c6e"></a>auctex<br />
<div class="outline-text-6" id="text-orgd993c6e">
<p>
Auctex provides some helpful tools for working with LaTeX.
</p>
</div>

<ul class="org-ul">
<li><a id="org04d7608"></a>tex-site<br />
<div class="outline-text-7" id="text-org04d7608">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tex-site
  <span class="org-builtin">:ensure</span> auctex
  <span class="org-builtin">:no-require</span>
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.tex\\'"</span> . TeX-latex-mode))
</pre>
</div>
</div>
</li>
<li><a id="orga7564b1"></a>tex-mode<br />
<div class="outline-text-7" id="text-orga7564b1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tex-mode
  <span class="org-builtin">:hook</span> (TeX-mode . latex-electric-env-pair-mode))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><a id="org44c7e00"></a>Lisp<br />
<div class="outline-text-5" id="text-org44c7e00">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elisp-mode
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:interpreter</span> ((<span class="org-string">"emacs"</span> . emacs-lisp-mode)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgf937b4e"></a>ielm<br />
<div class="outline-text-6" id="text-orgf937b4e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ielm
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-c :"</span> . ielm))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1a746b6"></a>Mach-O<br />
<div class="outline-text-5" id="text-org1a746b6">
<p>
View macho binaries read-only. To view in Hexl-mode raw binaries, run M-x
macho-mode to toggle then M-x hexl-mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package macho-mode
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:magic</span> ((<span class="org-string">"\xFE\xED\xFA\xCE"</span> . macho-mode)
          (<span class="org-string">"\xFE\xED\xFA\xCF"</span> . macho-mode)
          (<span class="org-string">"\xCE\xFA\xED\xFE"</span> . macho-mode)
          (<span class="org-string">"\xCF\xFA\xED\xFE"</span> . macho-mode)))
</pre>
</div>
</div>
</li>

<li><a id="orgdcbe616"></a>Markdown<br />
<ul class="org-ul">
<li><a id="org0da8495"></a>markdown-mode<br />
<div class="outline-text-6" id="text-org0da8495">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package markdown-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"README\\.md\\'"</span> . gfm-mode)
         (<span class="org-string">"\\.md\\'"</span>       . markdown-mode)
         (<span class="org-string">"\\.markdown\\'"</span> . gfm-mode)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc03284e"></a>Nix<br />
<ul class="org-ul">
<li><a id="org8d725c4"></a>nix-mode<br />
<div class="outline-text-6" id="text-org8d725c4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nix-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.nix\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org79c4372"></a>nix-shell<br />
<div class="outline-text-6" id="text-org79c4372">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nix-shell
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:commands</span> (nix-shell nix-unpack))
</pre>
</div>
</div>
</li>
<li><a id="orgdb02958"></a>nix-drv-mode<br />
<div class="outline-text-6" id="text-orgdb02958">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nix-drv-mode
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.drv\\'"</span>)
</pre>
</div>
</div>
</li>
<li><a id="org35a675b"></a>nix-buffer<br />
<div class="outline-text-6" id="text-org35a675b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nix-buffer
  <span class="org-builtin">:commands</span> nix-buffer
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:preface</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(defun turn-on-nix-buffer ()</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">(when (and (not noninteractive)</span>
  <span class="org-comment-delimiter">;;         </span><span class="org-comment">(not (eq (aref (buffer-name) 0) ?\s))</span>
  <span class="org-comment-delimiter">;;         </span><span class="org-comment">(not (file-remote-p default-directory)))</span>
  <span class="org-comment-delimiter">;;     </span><span class="org-comment">(nix-buffer)))</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:hook (after-change-major-mode . turn-on-nix-buffer)</span>
  )
</pre>
</div>
</div>
</li>
<li><a id="org4c8502c"></a>nix-update<br />
<div class="outline-text-6" id="text-org4c8502c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nix-update
  <span class="org-builtin">:commands</span> nix-update-fetch
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-. u"</span> . nix-update-fetch)))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org6e60011"></a>OCaml<br />
<div class="outline-text-5" id="text-org6e60011">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tuareg
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.mli?\\'"</span> . tuareg-mode))
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Use Merlin if available</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">require</span> '<span class="org-constant">merlin</span> nil t)
    (<span class="org-keyword">defvar</span> <span class="org-variable-name">merlin-command</span>)
    (<span class="org-keyword">setq</span> merlin-command 'opam)

    (<span class="org-keyword">declare-function</span> merlin-mode <span class="org-string">"merlin.el"</span>)

    (<span class="org-keyword">when</span> (functionp 'merlin-document)
      (define-key tuareg-mode-map (kbd <span class="org-string">"\C-c\C-h"</span>) 'merlin-document))

    <span class="org-comment-delimiter">;; </span><span class="org-comment">Run Merlin if a .merlin file in the parent dirs is detected</span>
    (add-hook 'tuareg-mode-hook
              (<span class="org-keyword">lambda</span>()
                (<span class="org-keyword">let</span> ((fn (buffer-file-name)))
                  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> fn (locate-dominating-file fn <span class="org-string">".merlin"</span>))
                      (merlin-mode)))))))
</pre>
</div>
</div>
</li>


<li><a id="org3ba5d50"></a>PHP<br />
<div class="outline-text-5" id="text-org3ba5d50">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package php-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.php\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org9d599e9"></a>Proof General<br />
<div class="outline-text-5" id="text-org9d599e9">
<p>
<a href="https://proofgeneral.github.io">Website</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package proof-site
  <span class="org-builtin">:ensure</span> proofgeneral
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:if</span> (not needs-package-init))
</pre>
</div>
</div>
</li>

<li><a id="org7cea582"></a>Python<br />
<ul class="org-ul">
<li><a id="org58b420d"></a>Anaconda<br />
<div class="outline-text-6" id="text-org58b420d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package anaconda-mode
  <span class="org-builtin">:hook</span> ((python-mode . anaconda-mode)
         (python-mode . anaconda-eldoc-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org91e5834"></a>python-mode<br />
<div class="outline-text-6" id="text-org91e5834">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package python
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.py\\'"</span> . python-mode)
  <span class="org-builtin">:interpreter</span> (<span class="org-string">"python"</span> . python-mode))
</pre>
</div>
</div>
</li>
</ul>
</li>


<li><a id="org444e71c"></a>restclient<br />
<div class="outline-text-5" id="text-org444e71c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package restclient
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.rest\\'"</span> . restclient-mode)
         (<span class="org-string">"\\.restclient\\'"</span> . restclient-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org7e1f4fd"></a>Ruby<br />
<div class="outline-text-5" id="text-org7e1f4fd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ruby-mode
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.rb\\'"</span> . ruby-mode)
  <span class="org-builtin">:interpreter</span> (<span class="org-string">"ruby"</span> . ruby-mode))
</pre>
</div>
</div>
</li>

<li><a id="orga413382"></a>Rust<br />
<div class="outline-text-5" id="text-orga413382">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rust-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.rs\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org5b76beb"></a>SASS<br />
<div class="outline-text-5" id="text-org5b76beb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sass-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.sass\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org33ac7a0"></a>Scala<br />
<div class="outline-text-5" id="text-org33ac7a0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package scala-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.scala\\'"</span>
  <span class="org-builtin">:interpreter</span> (<span class="org-string">"scala"</span> . scala-mode))
</pre>
</div>
</div>
</li>

<li><a id="org9f1008a"></a>SCSS<br />
<div class="outline-text-5" id="text-org9f1008a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package scss-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.scss\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgad36c48"></a>Shell<br />
<div class="outline-text-5" id="text-orgad36c48">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sh-script
  <span class="org-builtin">:commands</span> shell-command
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.*shellrc$"</span> . sh-mode)
         (<span class="org-string">"\\.*shell_profile"</span> . sh-mode)
         (<span class="org-string">"\\.zsh\\'"</span> . sh-mode)))
</pre>
</div>
</div>
</li>

<li><a id="orgf25db80"></a>texinfo<br />
<div class="outline-text-5" id="text-orgf25db80">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package texinfo
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.texi\\'"</span> . texinfo-mode))
</pre>
</div>
</div>
</li>

<li><a id="orgb60ed38"></a>TypeScript<br />
<div class="outline-text-5" id="text-orgb60ed38">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package typescript-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.ts\\'"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orge57a666"></a>Web<br />
<div class="outline-text-5" id="text-orge57a666">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package web-mode
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.erb\\'"</span> . web-mode)
         (<span class="org-string">"\\.mustache\\'"</span> . web-mode)
         (<span class="org-string">"\\.html?\\'"</span> . web-mode)
         (<span class="org-string">"\\.php\\'"</span> . web-mode)
         (<span class="org-string">"\\.jsp\\'"</span> . web-mode)
         <span class="org-comment-delimiter">;; </span><span class="org-comment">("\\.jsx?$" . web-mode)</span>
         (<span class="org-string">"\\.es6\\'"</span> . web-mode)
         (<span class="org-string">"\\.ejs\\'"</span> . web-mode)
         (<span class="org-string">"\\.phtml\\'"</span> . web-mode)
         (<span class="org-string">"\\.tpl\\.php\\'"</span> . web-mode)
         (<span class="org-string">"\\.[agj]sp\\'"</span> . web-mode)
         (<span class="org-string">"\\.as[cp]x\\'"</span> . web-mode)
         (<span class="org-string">"\\.djhtml\\'"</span> . web-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org4ec15e9"></a>YAML<br />
<div class="outline-text-5" id="text-org4ec15e9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yaml-mode
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.ya?ml\\'"</span>)
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgfba9702" class="outline-4">
<h4 id="orgfba9702">Custom</h4>
<div class="outline-text-4" id="text-orgfba9702">
<p>
These are all available in <a href="./site-lisp">./site-lisp</a>. Eventually they should go into separate
repositories.
</p>
</div>

<ul class="org-ul">
<li><a id="orgb5681d9"></a>dired-column<br /></li>
<li><a id="orgcae8850"></a>em-dired<br /></li>
<li><a id="orgfd00b29"></a>installer<br /></li>
<li><a id="org03329fc"></a>macho-mode<br /></li>
<li><a id="org2931de1"></a>nethack<br />
<div class="outline-text-5" id="text-org2931de1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nethack
  <span class="org-builtin">:commands</span> nethack
  <span class="org-builtin">:ensure</span> nil)
</pre>
</div>
</div>
</li>

<li><a id="org7207e72"></a>nix-fontify<br /></li>
<li><a id="org2522610"></a>set-defaults<br /></li>
<li><a id="org6ccfa21"></a>use-package-list<br /></li>
</ul>
</div>
<div id="outline-container-org482c2b0" class="outline-4">
<h4 id="org482c2b0">Other</h4>
<div class="outline-text-4" id="text-org482c2b0">
<p>
These should correspond to minor modes or helper functions. Some of them are
more helpful than others but none are <i>essential</i>.
</p>

<p>
Most of these are available in MELPA.
</p>
</div>

<ul class="org-ul">
<li><a id="org6f18289"></a>browse-at-remote<br />
<div class="outline-text-5" id="text-org6f18289">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package browse-at-remote
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-c g g"</span> . browse-at-remote))
</pre>
</div>
</div>
</li>
<li><a id="orgc682445"></a>browse-kill-ring<br />
<div class="outline-text-5" id="text-orgc682445">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package browse-kill-ring
  <span class="org-builtin">:commands</span> browse-kill-ring)
</pre>
</div>
</div>
</li>

<li><a id="org77bef67"></a>buffer-move<br />
<div class="outline-text-5" id="text-org77bef67">
<p>
<a href="https://github.com/lukhas/buffer-move">GitHub</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package buffer-move
  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"&lt;M-S-up&gt;"</span> . buf-move-up)
   (<span class="org-string">"&lt;M-S-down&gt;"</span> . buf-move-down)
   (<span class="org-string">"&lt;M-S-left&gt;"</span> . buf-move-left)
   (<span class="org-string">"&lt;M-S-right&gt;"</span> . buf-move-right)))
</pre>
</div>
</div>
</li>

<li><a id="org4731bfa"></a>copy-as-format<br />
<div class="outline-text-5" id="text-org4731bfa">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package copy-as-format
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c w s"</span> . copy-as-format-slack)
         (<span class="org-string">"C-c w g"</span> . copy-as-format-github)))
</pre>
</div>
</div>
</li>

<li><a id="org94fe605"></a>crux<br />
<div class="outline-text-5" id="text-org94fe605">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package crux
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c D"</span> . crux-delete-file-and-buffer)
         (<span class="org-string">"C-c C-e"</span> . crux-eval-and-replace)
         (<span class="org-string">"C-c d"</span> . crux-duplicate-current-line-or-region)
         ([shift return] . crux-smart-open-line)))
</pre>
</div>
</div>
</li>

<li><a id="orgae22520"></a>daemons<br />
<div class="outline-text-5" id="text-orgae22520">
<p>
<a href="https://github.com/cbowdon/daemons.el">https://github.com/cbowdon/daemons.el</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package daemons)
</pre>
</div>
</div>
</li>
<li><a id="orgb498dbc"></a>deadgrep<br />
<div class="outline-text-5" id="text-orgb498dbc">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package ripgrep :commands ripgrep-regexp)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package rg :commands rg-dwim)</span>
(use-package deadgrep
  <span class="org-builtin">:commands</span> deadgrep
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> projectile-command-map
         (<span class="org-string">"s g"</span> . deadgrep)))
</pre>
</div>
</div>
</li>
<li><a id="org3e48612"></a>delight<br />
<div class="outline-text-5" id="text-org3e48612">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package delight)
</pre>
</div>
</div>
</li>
<li><a id="orgdf3d660"></a>dired-rsync<br />
<div class="outline-text-5" id="text-orgdf3d660">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-rsync
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> dired-mode-map (<span class="org-string">"C-c C-r"</span> . dired-rsync)))
</pre>
</div>
</div>
</li>
<li><a id="orgb543847"></a>emacs-gif-screencast<br />
<div class="outline-text-5" id="text-orgb543847">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gif-screencast
  <span class="org-builtin">:commands</span> gif-screencast)
</pre>
</div>
</div>
</li>
<li><a id="orgcd87adc"></a>fic-mode<br />
<div class="outline-text-5" id="text-orgcd87adc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package fic-mode
  <span class="org-builtin">:hook</span> (prog-mode . fic-mode))
</pre>
</div>
</div>
</li>
<li><a id="org6afc79e"></a>git-attr<br />
<div class="outline-text-5" id="text-org6afc79e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-attr-linguist
  <span class="org-builtin">:ensure</span> git-attr
  <span class="org-builtin">:commands</span> git-attr-linguist
  <span class="org-builtin">:hook</span> (find-file . git-attr-linguist))
</pre>
</div>
</div>
</li>
<li><a id="org85f3e9d"></a>git-timemachine<br />
<div class="outline-text-5" id="text-org85f3e9d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-timemachine
  <span class="org-builtin">:commands</span> git-timemachine)
</pre>
</div>
</div>
</li>
<li><a id="org5aae390"></a>htmlize<br />
<div class="outline-text-5" id="text-org5aae390">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package htmlize <span class="org-builtin">:no-require</span>)
</pre>
</div>
</div>
</li>

<li><a id="org8445bb3"></a>idle-highlight-mode<br />
<div class="outline-text-5" id="text-org8445bb3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package idle-highlight-mode
  <span class="org-builtin">:hook</span> (prog-mode . idle-highlight-mode))
</pre>
</div>
</div>
</li>
<li><a id="org46c8653"></a>iedit<br />
<div class="outline-text-5" id="text-org46c8653">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package iedit
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-;"</span> . iedit-mode)))
</pre>
</div>
</div>
</li>
<li><a id="org72987fb"></a>ledger-mode<br />
<div class="outline-text-5" id="text-org72987fb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ledger-mode)
</pre>
</div>
</div>
</li>
<li><a id="org4cc8546"></a>mwim<br />
<div class="outline-text-5" id="text-org4cc8546">
<p>
<a href="https://github.com/alezost/mwim.el">GitHub</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mwim
  <span class="org-builtin">:bind</span> (([remap move-beginning-of-line]
          . mwim-beginning-of-code-or-line)
         ([remap move-end-of-line]
          . mwim-end-of-code-or-line)))
</pre>
</div>
</div>
</li>

<li><a id="org9ffe99e"></a>org-static-blog<br />
<div class="outline-text-5" id="text-org9ffe99e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-static-blog <span class="org-builtin">:commands</span> org-static-blog-publish)
</pre>
</div>
</div>
</li>
<li><a id="org11df1bb"></a>page-break-lines<br />
<div class="outline-text-5" id="text-org11df1bb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package page-break-lines
  <span class="org-builtin">:delight</span>
  <span class="org-builtin">:hook</span> ((doc-mode
          emacs-lisp-mode
          compilation-mode
          outline-mode
          prog-mode
          haskell-mode
          help-mode
          magit-mode) <span class="org-warning">. page-break-lines-mode))</span>
</pre>
</div>
</div>
</li>

<li><a id="org0faa73a"></a>pandoc-mode<br />
<div class="outline-text-5" id="text-org0faa73a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pandoc-mode
  <span class="org-builtin">:hook</span> ((markdown-mode . pandoc-mode)
         (pandoc-mode . pandoc-load-default-settings)))
</pre>
</div>
</div>
</li>

<li><a id="org4e57e8e"></a>pcomplette<br />
<div class="outline-text-5" id="text-org4e57e8e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pcomplete
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:commands</span> pcomplete-here
  <span class="org-builtin">:preface</span>
  (autoload 'pcomplete-comint-setup <span class="org-string">"pcomplete"</span>)
  <span class="org-builtin">:hook</span> ((shell-mode . (<span class="org-keyword">lambda</span> () (pcomplete-comint-setup 'shell-dynamic-complete-functions)))
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(term-mode . (lambda () (pcomplete-comint-setup 'term-dynamic-complete-functions)))</span>
         (comint-mode . (<span class="org-keyword">lambda</span> () (pcomplete-comint-setup 'comint-dynamic-complete-functions)))
         <span class="org-comment-delimiter">;; </span><span class="org-comment">(eshell-mode . (lambda () (add-hook 'completion-at-point-functions</span>
         <span class="org-comment-delimiter">;;                                </span><span class="org-comment">'pcomplete-completions-at-point</span>
         <span class="org-comment-delimiter">;;                                </span><span class="org-comment">nil t)))</span>
         ))
(use-package pcmpl-args
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">declare-function</span> pcmpl-args-process-file <span class="org-string">"pcmpl-args.el"</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">see https://github.com/JonWaltman/pcmpl-args.el/pull/4</span>
  (<span class="org-keyword">setq</span> pcmpl-args-man-function
        (<span class="org-keyword">lambda</span> (name)
          (<span class="org-keyword">let</span> ((process-environment process-environment))
            <span class="org-comment-delimiter">;; </span><span class="org-comment">Setting MANWIDTH to a high number makes most paragraphs fit on a single</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">line, reducing the number of false positives that result from lines</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">starting with `-' that aren't really options.</span>
            (<span class="org-keyword">push</span> <span class="org-string">"MANWIDTH=10000"</span> process-environment)
            (pcmpl-args-process-file
             shell-file-name shell-command-switch (format <span class="org-string">"man %s | col -b"</span> name))))))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package pcmpl-git)</span>
</pre>
</div>
</div>
</li>
<li><a id="org91e4c1f"></a>rainbow-delimiters<br />
<div class="outline-text-5" id="text-org91e4c1f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rainbow-delimiters
  <span class="org-builtin">:hook</span> ((emacs-lisp-mode
          inferior-emacs-lisp-mode
          ielm-mode
          lisp-mode
          inferior-lisp-mode
          lisp-interaction-mode
          slime-repl-mode) <span class="org-warning">. rainbow-delimiters-mode))</span>
</pre>
</div>
</div>
</li>

<li><a id="org214c242"></a>rainbow-mode<br />
<div class="outline-text-5" id="text-org214c242">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rainbow-mode
  <span class="org-builtin">:hook</span> ((emacs-lisp-mode
          inferior-emacs-lisp-mode
          ielm-mode
          lisp-mode
          inferior-lisp-mode
          lisp-interaction-mode
          slime-repl-mode
          web-mode
          less-css-mode
          html-mode
          css-mode) <span class="org-warning">. rainbow-mode))</span>
</pre>
</div>
</div>
</li>

<li><a id="org16478c5"></a>shrink-whitespace<br />
<div class="outline-text-5" id="text-org16478c5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package shrink-whitespace
  <span class="org-builtin">:bind</span> (<span class="org-string">"H-SPC"</span> . shrink-whitespace))
</pre>
</div>
</div>
</li>

<li><a id="org598b0a2"></a>string-inflection<br />
<div class="outline-text-5" id="text-org598b0a2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package string-inflection
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c r r"</span> . string-inflection-all-cycle)
         (<span class="org-string">"C-c r c"</span> . string-inflection-camelcase)
         (<span class="org-string">"C-c r l"</span> . string-inflection-lower-camelcase)
         (<span class="org-string">"C-c r u"</span> . string-inflection-underscore)
         (<span class="org-string">"C-c r k"</span> . string-inflection-kebab-case)
         (<span class="org-string">"C-c r J"</span> . string-inflection-java-style-cycle)))
</pre>
</div>
</div>
</li>

<li><a id="org765ff7d"></a>undo-tree<br />
<div class="outline-text-5" id="text-org765ff7d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package undo-tree
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:commands</span> global-undo-tree-mode
  <span class="org-builtin">:config</span> (global-undo-tree-mode 1)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(global-set-key (kbd "C-z") 'undo)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(defalias 'redo 'undo-tree-redo)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(global-set-key (kbd "C-S-z") 'redo)</span>
  )
</pre>
</div>
</div>
</li>
<li><a id="org495fb76"></a>unfill<br />
<div class="outline-text-5" id="text-org495fb76">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package unfill
  <span class="org-builtin">:bind</span> ([remap fill-paragraph] . unfill-toggle))
</pre>
</div>
</div>
</li>
<li><a id="org996b334"></a>url-util<br />
<div class="outline-text-5" id="text-org996b334">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package url-util
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:functions</span> (url-hexify-string url-unhex-string region-active-p)
  <span class="org-builtin">:preface</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">func-region</span> (start end func)
    <span class="org-doc">"Run a function over the region between START and END in current buffer."</span>
    (<span class="org-keyword">unless</span> (region-active-p) (<span class="org-warning">error</span> <span class="org-string">"No active region."</span>))
    (<span class="org-keyword">save-excursion</span>
      (<span class="org-keyword">let</span> ((text (delete-and-extract-region start end)))
        (insert (funcall func text)))))
  (<span class="org-keyword">defun</span> <span class="org-function-name">url-encode</span> (start end)
    <span class="org-doc">"URL encode the region between START and END in current buffer."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"r"</span>)
    (func-region start end 'url-hexify-string))
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">url-escape</span> 'url-encode)
  (<span class="org-keyword">defun</span> <span class="org-function-name">url-decode</span> (start end)
    <span class="org-doc">"URL decode the region between START and END in current buffer."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"r"</span>)
    (func-region start end 'url-unhex-string))
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">url-unescape</span> 'url-decode))
</pre>
</div>
</div>
</li>
<li><a id="org5476650"></a>winner-mode<br />
<div class="outline-text-5" id="text-org5476650">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package winner
  <span class="org-builtin">:demand</span>
  <span class="org-builtin">:config</span> (winner-mode))
</pre>
</div>
</div>
</li>

<li><a id="org2c36586"></a>with-editor<br />
<div class="outline-text-5" id="text-org2c36586">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package with-editor
  <span class="org-builtin">:disabled</span>
  <span class="org-builtin">:hook</span>
  ((shell-mode eshell-mode) . with-editor-export-editor))
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org67c67c5" class="outline-3">
<h3 id="org67c67c5">END</h3>
<div class="outline-text-3" id="text-org67c67c5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">provide</span> '<span class="org-constant">default</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgac4f3b5" class="outline-2">
<h2 id="profiles">Profiles</h2>
<div class="outline-text-2" id="text-profiles">
<p>
All of these files live outside of Emacs but are necessary for a usable
developer environment. They are basic shell profile and some git configuration
scripts as well.
</p>
</div>

<div id="outline-container-org00a7650" class="outline-3">
<h3 id="org00a7650"><code>.profile</code></h3>
<div class="outline-text-3" id="text-org00a7650">
<p>
To use this, you must create a short ~/.profile file. Here is an example,
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-variable-name">bootstrap</span>=<span class="org-string">"$HOME/.nix-profile/etc/profile"</span>
[ -f $<span class="org-variable-name">bootstrap</span> ] &amp;&amp; . $<span class="org-variable-name">bootstrap</span>
</pre>
</div>

<p>
Set some Nix variables that never seem to get set correctly. There are a few bug
that break how this works. Also need to set some common exports that are needed.
Lots of common variables need to know about the <code>.nix-profile</code> directory. We
leave the first MANPATH separator empty so it uses the default PATH lookup as
well. CVS_RSH is needed if your ever need to do cvs. HISTFILE sets where to
store the bash or zsh history. We set the history size to 10000 for good
measure. EDITOR should point to this editor.
</p>

<p>
Here we setup <code>.profile</code>. First, setup exports. We leave the first part of
MANPATH empty so it resolves using the PATH-based method. Fallbacks are provided
just in case.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ -z <span class="org-string">"${__BAUER_ADD_PATHS-}"</span> ]; <span class="org-keyword">then</span>
  <span class="org-builtin">export</span> <span class="org-variable-name">__BAUER_ADD_PATHS</span>=1 <span class="org-sh-escaped-newline">\</span>
         <span class="org-variable-name">PATH</span>=<span class="org-string">"$HOME/bin"</span>:<span class="org-string">"$HOME/.nix-profile/bin"</span>:$<span class="org-variable-name">PREFIX</span>/bin:@PATH@${<span class="org-variable-name">PATH</span>:+:$<span class="org-variable-name">PATH</span>} <span class="org-sh-escaped-newline">\</span>
         <span class="org-variable-name">INFOPATH</span>=<span class="org-string">"$HOME/.nix-profile/share/info"</span>:@INFOPATH@${<span class="org-variable-name">INFOPATH</span>:+:$<span class="org-variable-name">INFOPATH</span>} <span class="org-sh-escaped-newline">\</span>
         <span class="org-variable-name">MANPATH</span>=:<span class="org-string">"$HOME/.nix-profile/share/man"</span>:@MANPATH@${<span class="org-variable-name">MANPATH</span>:+:$<span class="org-variable-name">MANPATH</span>} <span class="org-sh-escaped-newline">\</span>
         <span class="org-variable-name">XDG_DATA_DIRS</span>=<span class="org-string">"$HOME/.nix-profile/share"</span>:@XDG_DATA_DIRS@${<span class="org-variable-name">XDG_DATA_DIRS</span>:+:$<span class="org-variable-name">XDG_DATA_DIRS</span>} <span class="org-sh-escaped-newline">\</span>
         <span class="org-variable-name">TERMINFO_DIRS</span>=@TERMINFO_DIRS@${<span class="org-variable-name">TERMINFO_DIRS</span>:+:$<span class="org-variable-name">TERMINFO_DIRS</span>}
<span class="org-keyword">fi</span>

<span class="org-variable-name">HISTSIZE</span>=50000
<span class="org-variable-name">SAVEHIST</span>=10000

<span class="org-keyword">if</span> [ -z <span class="org-string">"${TERM-}"</span> ] || [ <span class="org-string">"$TERM"</span> = dumb ] || [ <span class="org-string">"$TERM"</span> = dumb-emacs-ansi ] || [ <span class="org-string">"$TERM"</span> = eterm-color ]; <span class="org-keyword">then</span>
  <span class="org-keyword">if</span> [ -n <span class="org-string">"${DISPLAY-}"</span> ]; <span class="org-keyword">then</span>
    <span class="org-builtin">export</span> <span class="org-variable-name">EDITOR</span>=<span class="org-string">'emacsclient -a emacs -c'</span>
  <span class="org-keyword">else</span>
    <span class="org-builtin">export</span> <span class="org-variable-name">EDITOR</span>=<span class="org-string">'emacsclient -a emacs'</span>
  <span class="org-keyword">fi</span>
<span class="org-keyword">elif</span> [ -n <span class="org-string">"${PS1-}"</span> ]; <span class="org-keyword">then</span>
  <span class="org-builtin">export</span> <span class="org-variable-name">EDITOR</span>=<span class="org-string">'emacsclient -a "emacs -nw" -t'</span>
<span class="org-keyword">else</span>
  <span class="org-builtin">export</span> <span class="org-variable-name">EDITOR</span>=<span class="org-string">'emacsclient -a emacs'</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> [ -n <span class="org-string">"${SSH_CONNECTION-}"</span> ]; <span class="org-keyword">then</span>
  <span class="org-builtin">export</span> <span class="org-variable-name">PINENTRY_USER_DATA</span>=<span class="org-variable-name">USE_CURSES</span>=1
<span class="org-keyword">fi</span>

<span class="org-builtin">export</span> <span class="org-variable-name">LESS</span>=<span class="org-string">'-FRSMi'</span> <span class="org-sh-escaped-newline">\</span>
       <span class="org-variable-name">SYSTEMD_LESS</span>=FRSMi <span class="org-sh-escaped-newline">\</span>
       <span class="org-variable-name">INPUTRC</span>=@INPUTRC@ <span class="org-sh-escaped-newline">\</span>
       <span class="org-variable-name">GPG_TTY</span>=$<span class="org-variable-name">TTY</span>
       <span class="org-variable-name">CVS_RSH</span>=ssh

<span class="org-variable-name">HISTCONTROL</span>=ignoredups:erasedups:ignorespace
<span class="org-variable-name">PROMPT_DIRTRIM</span>=4

<span class="org-keyword">if</span> [ -n <span class="org-string">"${BASH_VERSION-}"</span> ]; <span class="org-keyword">then</span>
  shopt -s cdable_vars <span class="org-sh-escaped-newline">\</span>
           cdspell <span class="org-sh-escaped-newline">\</span>
           checkwinsize <span class="org-sh-escaped-newline">\</span>
           histappend <span class="org-sh-escaped-newline">\</span>
           histreedit <span class="org-sh-escaped-newline">\</span>
           lithist

  shopt -s autocd <span class="org-sh-escaped-newline">\</span>
           checkjobs <span class="org-sh-escaped-newline">\</span>
           direxpand <span class="org-sh-escaped-newline">\</span>
           dirspell <span class="org-sh-escaped-newline">\</span>
           histverify <span class="org-sh-escaped-newline">\</span>
           no_empty_cmd_completion <span class="org-sh-escaped-newline">\</span>
           globstar <span class="org-sh-escaped-newline">\</span>
  2&gt;/dev/null || <span class="org-builtin">true</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> [ <span class="org-string">"${TERM-}"</span> = dumb-emacs-ansi ] &amp;&amp; [ -n <span class="org-string">"${SSH_CONNECTION-}"</span> ]; <span class="org-keyword">then</span>
  <span class="org-variable-name">PROMPT_DIRTRIM</span>=0
  <span class="org-variable-name">PS1</span>=<span class="org-string">'\[\e[34m\]:/ssh:\u@\H:$PWD\[\e[33m\] $\[\e[0m\] '</span>
<span class="org-keyword">else</span>
  <span class="org-variable-name">PS1</span>=<span class="org-string">'\[\e[34m\]\u@\H:\[\e[36m\]\w \[\e[33m\]\$\[\e[0m\] '</span>
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Dircolors
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> != dumb ] &amp;&amp; [ -n <span class="org-string">"${SHELL-}"</span> ]; <span class="org-keyword">then</span>
  <span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> = dumb-emacs-ansi ]; <span class="org-keyword">then</span>
    <span class="org-builtin">eval</span> <span class="org-string">"$(TERM=ansi dircolors)"</span>
  <span class="org-keyword">else</span>
    <span class="org-builtin">eval</span> <span class="org-string">"$(dircolors)"</span>
  <span class="org-keyword">fi</span>
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Then setup aliases.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">alias</span> <span class="org-variable-name">rm</span>=<span class="org-string">'rm -I --preserve-root'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">mv</span>=<span class="org-string">'mv -i'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">cp</span>=<span class="org-string">'cp -i'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">ln</span>=<span class="org-string">'ln -i'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">chown</span>=<span class="org-string">'chown --preserve-root'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">chmod</span>=<span class="org-string">'chmod --preserve-root'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">chgrp</span>=<span class="org-string">'chgrp --preserve-root'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">curl</span>=<span class="org-string">'curl -L --proto-default https'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">upgrade_bauer</span>=<span class="org-string">'git -C "$HOME/.local/share/bauer" pull &amp;&amp; nix-env -if "$HOME/.local/share/bauer"'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">upgrade</span>=upgrade_bauer <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">df</span>=<span class="org-string">'df -hT'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">du</span>=<span class="org-string">'du -h'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">free</span>=<span class="org-string">'free -m'</span> <span class="org-sh-escaped-newline">\</span>
      <span class="org-variable-name">gdb</span>=<span class="org-string">'gdb --quiet --args'</span>

<span class="org-function-name">open</span>() {
  <span class="org-keyword">if</span> command -v open &gt; /dev/null; <span class="org-keyword">then</span>
    command open <span class="org-string">"$@"</span>
  <span class="org-keyword">elif</span> command -v xdg-open &gt; /dev/null; <span class="org-keyword">then</span>
    xdg-open <span class="org-string">"$@"</span>
  <span class="org-keyword">else</span>
    <span class="org-builtin">echo</span> Can&#8217;t find open.
    <span class="org-keyword">exit</span> 1
  <span class="org-keyword">fi</span>
}

<span class="org-function-name">help</span>() {
  <span class="org-keyword">if</span> command -v xdg-open &gt; /dev/null; <span class="org-keyword">then</span>
    xdg-open https://matthewbauer.us/bauer/
  <span class="org-keyword">elif</span> command -v open &gt; /dev/null; <span class="org-keyword">then</span>
    open https://matthewbauer.us/bauer/
  <span class="org-keyword">elif</span> [ -n <span class="org-string">"${EDITOR-}"</span> ]; <span class="org-keyword">then</span>
    $<span class="org-variable-name">EDITOR</span> <span class="org-string">"$HOME/.local/share/bauer/README.org"</span>
  <span class="org-keyword">else</span>
    <span class="org-builtin">echo</span> Can&#8217;t find help.
    <span class="org-keyword">exit</span> 1
  <span class="org-keyword">fi</span>
}

<span class="org-builtin">set</span> -o noclobber -o notify

<span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> != <span class="org-string">"dumb"</span> ]; <span class="org-keyword">then</span>
    <span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> != eterm-color ]; <span class="org-keyword">then</span>
        <span class="org-builtin">alias</span> <span class="org-variable-name">l</span>=<span class="org-string">'ls -lFh --hyperlink=auto --color=auto'</span> <span class="org-sh-escaped-newline">\</span>
              <span class="org-variable-name">ls</span>=<span class="org-string">'ls -h --hyperlink=auto --color=auto'</span>
    <span class="org-keyword">else</span>
        <span class="org-builtin">alias</span> <span class="org-variable-name">l</span>=<span class="org-string">'ls -lFh --color=auto'</span> <span class="org-sh-escaped-newline">\</span>
              <span class="org-variable-name">ls</span>=<span class="org-string">'ls -h --color=auto'</span>
    <span class="org-keyword">fi</span>
    <span class="org-builtin">alias</span> <span class="org-variable-name">grep</span>=<span class="org-string">'grep --color=auto'</span> <span class="org-sh-escaped-newline">\</span>
          <span class="org-variable-name">egrep</span>=<span class="org-string">'grep -E --color=auto'</span> <span class="org-sh-escaped-newline">\</span>
          <span class="org-variable-name">diff</span>=<span class="org-string">'diff --color=auto'</span> <span class="org-sh-escaped-newline">\</span>
          <span class="org-variable-name">rsync</span>=<span class="org-string">'rsync --progress --human-readable'</span> <span class="org-sh-escaped-newline">\</span>
          <span class="org-variable-name">dd</span>=<span class="org-string">'dd status=progress'</span>
<span class="org-keyword">else</span>
    <span class="org-builtin">alias</span> <span class="org-variable-name">l</span>=<span class="org-string">'ls -lFh'</span> <span class="org-sh-escaped-newline">\</span>
          <span class="org-variable-name">egrep</span>=<span class="org-string">'grep -E'</span>
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Configure INSIDE_EMACS.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ <span class="org-string">"${TERM-}"</span> = dumb ] &amp;&amp; [ -n <span class="org-string">"${INSIDE_EMACS-}"</span> ]; <span class="org-keyword">then</span>
    <span class="org-builtin">export</span> <span class="org-variable-name">TERM</span>=dumb-emacs-ansi <span class="org-sh-escaped-newline">\</span>
           <span class="org-variable-name">COLORTERM</span>=1
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Last, we source the HOME profile to make sure it is used by zsh.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ -f <span class="org-string">"$HOME/.profile"</span> ] &amp;&amp; [ -z <span class="org-string">"${__BAUER_SOURCED_PROFILE-}"</span> ]; <span class="org-keyword">then</span>
  <span class="org-variable-name">__BAUER_SOURCED_PROFILE</span>=1
  <span class="org-comment-delimiter"># </span><span class="org-comment">shellcheck source=/dev/null</span>
  . <span class="org-string">"$HOME/.profile"</span>
<span class="org-keyword">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org30bd607" class="outline-3">
<h3 id="zshrc"><code>.zshrc</code></h3>
<div class="outline-text-3" id="text-zshrc">
<p>
This is a profile for use with <a href="http://www.zsh.org">Zsh</a>. It is closely based off of <a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a>.
</p>

<p>
Setup ZSH profile. First, we just source the global profile.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">shellcheck source=/dev/null</span>
. @out@/etc/profile
</pre>
</div>

<p>
Handle dumb options.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">case</span> <span class="org-string">"$TERM"</span><span class="org-keyword"> in</span>
    dumb)
        <span class="org-builtin">setopt</span> no_zle <span class="org-sh-escaped-newline">\</span>
               no_prompt_cr <span class="org-sh-escaped-newline">\</span>
               no_prompt_subst <span class="org-sh-escaped-newline">\</span>
               no_rcs
        <span class="org-variable-name">PS1</span>=<span class="org-string">'$ '</span>
        <span class="org-variable-name">PROMPT</span>=<span class="org-string">'$ '</span>
        <span class="org-builtin">whence</span> -w precmd &gt;/dev/null &amp;&amp; <span class="org-builtin">unfunction</span> precmd
        <span class="org-builtin">whence</span> -w preexec &gt;/dev/null &amp;&amp; <span class="org-builtin">unfunction</span> preexec
        <span class="org-keyword">return</span>
        ;;
    eterm*)
        <span class="org-builtin">setopt</span> nopromptsp <span class="org-sh-escaped-newline">\</span>
               single_line_zle
        ;;
<span class="org-keyword">esac</span>
</pre>
</div>

<p>
Turn on ZSH-specific options.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">setopt</span> always_to_end <span class="org-sh-escaped-newline">\</span>
       auto_cd <span class="org-sh-escaped-newline">\</span>
       auto_name_dirs <span class="org-sh-escaped-newline">\</span>
       auto_pushd <span class="org-sh-escaped-newline">\</span>
       cdable_vars <span class="org-sh-escaped-newline">\</span>
       complete_in_word <span class="org-sh-escaped-newline">\</span>
       correct <span class="org-sh-escaped-newline">\</span>
       extended_history <span class="org-sh-escaped-newline">\</span>
       hist_ignore_space <span class="org-sh-escaped-newline">\</span>
       hist_reduce_blanks <span class="org-sh-escaped-newline">\</span>
       hist_save_no_dups <span class="org-sh-escaped-newline">\</span>
       hist_verify <span class="org-sh-escaped-newline">\</span>
       inc_append_history_time <span class="org-sh-escaped-newline">\</span>
       interactive_comments <span class="org-sh-escaped-newline">\</span>
       long_list_jobs <span class="org-sh-escaped-newline">\</span>
       multios <span class="org-sh-escaped-newline">\</span>
       prompt_subst <span class="org-sh-escaped-newline">\</span>
       pushd_minus <span class="org-sh-escaped-newline">\</span>
       transient_rprompt

<span class="org-builtin">alias</span> -g ...=<span class="org-string">'../..'</span> <span class="org-sh-escaped-newline">\</span>
         ....=<span class="org-string">'../../..'</span> <span class="org-sh-escaped-newline">\</span>
         .....=<span class="org-string">'../../../..'</span> <span class="org-sh-escaped-newline">\</span>
         ......=<span class="org-string">'../../../../..'</span>
</pre>
</div>

<p>
Load up site-functions in ZSH. Use XDG_DATA_DIRS variable. Then we use this to
initialize completions.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> != dumb-emacs-ansi ]; <span class="org-keyword">then</span>
  <span class="org-comment-delimiter"># </span><span class="org-comment">shellcheck disable=SC2154</span>
  <span class="org-keyword">for</span> dir<span class="org-keyword"> in</span> @completions@/share ${(s.:.)XDG_DATA_DIRS-}; <span class="org-keyword">do</span>
    <span class="org-keyword">if</span> [ -d <span class="org-string">"$dir/zsh/site-functions"</span> ]; <span class="org-keyword">then</span>
      <span class="org-variable-name">fpath</span>+=$<span class="org-variable-name">dir</span>/zsh/site-functions
    <span class="org-keyword">fi</span>
    <span class="org-keyword">if</span> [ -d <span class="org-string">"$dir/zsh/vendor-completions"</span> ]; <span class="org-keyword">then</span>
      <span class="org-variable-name">fpath</span>+=$<span class="org-variable-name">dir</span>/zsh/vendor-completions
    <span class="org-keyword">fi</span>
  <span class="org-keyword">done</span>

  <span class="org-builtin">autoload</span> -U compinit

  <span class="org-keyword">if</span> <span class="org-negation-char">!</span> [ -f <span class="org-string">"$HOME/.zcompdump"</span> ] || [ <span class="org-string">"$(@coreutils@/bin/date +%j)"</span> != <span class="org-string">"$(@coreutils@/bin/date +%j -r "$HOME/.zcompdump")"</span> ]; <span class="org-keyword">then</span>
    compinit -i -d <span class="org-string">"$HOME/.zcompdump"</span>
  <span class="org-keyword">else</span>
    compinit -i -d <span class="org-string">"$HOME/.zcompdump"</span> -C
  <span class="org-keyword">fi</span>
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Bind to emacs&#x2026;
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">bindkey</span> -e

<span class="org-builtin">autoload</span> -U tetris
zle -N tetris

<span class="org-builtin">autoload</span> -U tetriscurses
zle -N tetriscurses

<span class="org-builtin">autoload</span> -U bracketed-paste-magic
zle -N bracketed-paste bracketed-paste-magic

<span class="org-builtin">bindkey</span> <span class="org-string">' '</span> magic-space
<span class="org-builtin">bindkey</span> <span class="org-string">';5D'</span> emacs-backward-word
<span class="org-builtin">bindkey</span> <span class="org-string">';5C'</span> emacs-forward-word

<span class="org-builtin">autoload</span> -Uz up-line-or-beginning-search down-line-or-beginning-search
zle -N up-line-or-beginning-search
zle -N down-line-or-beginning-search

<span class="org-builtin">autoload</span> -U zmv

<span class="org-builtin">autoload</span> -U url-quote-magic
zle -N self-insert url-quote-magic

<span class="org-builtin">bindkey</span> <span class="org-string">'^[[A'</span>  up-line-or-beginning-search
<span class="org-builtin">bindkey</span> <span class="org-string">'^[OA'</span>  up-line-or-beginning-search
<span class="org-builtin">bindkey</span> <span class="org-string">'^[[B'</span>  down-line-or-beginning-search
<span class="org-builtin">bindkey</span> <span class="org-string">'^[OB'</span>  down-line-or-beginning-search

<span class="org-builtin">autoload</span> -U edit-command-line
zle -N edit-command-line
<span class="org-builtin">bindkey</span> <span class="org-string">"^X^E"</span> edit-command-line

<span class="org-builtin">bindkey</span> <span class="org-string">"^[m"</span> copy-prev-shell-word
<span class="org-builtin">bindkey</span> <span class="org-string">'^[w'</span> kill-region
<span class="org-builtin">bindkey</span> <span class="org-string">'^[[Z'</span> reverse-menu-complete
<span class="org-builtin">bindkey</span> <span class="org-string">"^[^R"</span> history-incremental-search-forward
</pre>
</div>

<p>
Zstyle completions.
</p>

<div class="org-src-container">
<pre class="src src-shell">zstyle <span class="org-string">':completion:*'</span> ignored-patterns <span class="org-string">'*~'</span> <span class="org-string">'_*'</span> <span class="org-string">'*\\\#*\\\#'</span>
zstyle <span class="org-string">':completion:*:*:*:users'</span> ignored-patterns <span class="org-string">'nixbld*'</span> <span class="org-string">'_*'</span> <span class="org-string">'systemd-*'</span> <span class="org-sh-escaped-newline">\</span>
  apache avahi daemon dbus messagebus nobody nginx nscd polkituser rpc sshd
zstyle <span class="org-string">':completion:*'</span> list-colors ${(s.:.)LS_COLORS}
zstyle <span class="org-string">':completion:*'</span> insert-tab pending
zstyle <span class="org-string">':completion:*'</span> matcher-list <span class="org-string">'m:{a-zA-Z-_}={A-Za-z_-}'</span> <span class="org-string">'r:|=*'</span> <span class="org-string">'l:|=* r:|=*'</span>
zstyle <span class="org-string">':completion:*'</span> special-dirs yes
zstyle <span class="org-string">':completion:*'</span> squeeze-slashes yes
zstyle <span class="org-string">':completion:*'</span> expand yes
zstyle <span class="org-string">':completion:*:match:*'</span> original only
zstyle <span class="org-string">':completion:*:approximate:*'</span> max-errors 1 numeric
zstyle <span class="org-string">':completion:*:*:*:*:*'</span> menu select
zstyle <span class="org-string">':completion:*:*:kill:*:processes'</span> list-colors <span class="org-string">'=(#b) #([0-9]#) ([0-9a-z-]#)*=01;34=0=01'</span>
zstyle <span class="org-string">':completion:*:history-words'</span> list no
zstyle <span class="org-string">':completion:*:history-words'</span> remove-all-dups yes
zstyle <span class="org-string">':completion:*:history-words'</span> stop yes
zstyle <span class="org-string">':completion:*:rm:*'</span> file-patterns <span class="org-string">'*:all-files'</span>
zstyle <span class="org-string">':completion::complete:*'</span> cache-path <span class="org-string">"$HOME/.zcompcache"</span>
zstyle <span class="org-string">':completion::complete:*'</span> use-cache yes
zstyle <span class="org-string">':vcs_info:*'</span> enable git
zstyle <span class="org-string">'*'</span> single-ignored show
zstyle -e <span class="org-string">':completion:*:(ssh|scp|sftp|rsh|rsync):hosts'</span> hosts <span class="org-string">'reply=(${=${${(f)"$(cat {/etc/ssh_,~/.ssh/known_}hosts(|2)(N) /dev/null)"}%%[# ]*}//,/ })'</span>
</pre>
</div>

<p>
Turn on prompt with colors.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-variable-name">PROMPT</span>=<span class="org-string">'%F{blue}'</span>
<span class="org-keyword">if</span> [ -n <span class="org-string">"${SSH_CONNECTION-}"</span> ]; <span class="org-keyword">then</span>
    <span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> = dumb-emacs-ansi ]; <span class="org-keyword">then</span>
      <span class="org-variable-name">PROMPT</span>+=<span class="org-string">':/ssh:'</span>
    <span class="org-keyword">else</span>
      <span class="org-variable-name">PROMPT</span>+=<span class="org-string">'ssh://'</span>
    <span class="org-keyword">fi</span>
    <span class="org-variable-name">PROMPT</span>+=<span class="org-string">'%n@'</span>

    <span class="org-builtin">echo</span> <span class="org-string">"$SSH_CONNECTION"</span> | <span class="org-builtin">read</span> client_ip client_port server_ip server_port

    <span class="org-variable-name">hostname</span>=

    <span class="org-keyword">if</span> [[ <span class="org-string">"$server_ip"</span> =~ fe80::* ]]; <span class="org-keyword">then</span>
        <span class="org-variable-name">server_ip</span>=<span class="org-string">"$(echo "$server_ip" | sed 's,%[a-z0-9]*$,,')"</span>
    <span class="org-keyword">fi</span>

    <span class="org-keyword">if</span> [[ <span class="org-string">"$client_ip"</span> =~ fe80::* ]]; <span class="org-keyword">then</span>
        <span class="org-variable-name">client_ip</span>=<span class="org-string">"$(echo "$client_ip" | sed 's,%[a-z0-9]*$,,')"</span>
    <span class="org-keyword">fi</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">localhost</span>
    <span class="org-keyword">if</span> [ <span class="org-string">"$server_ip"</span> = 127.0.0.1 ] || [ <span class="org-string">"$server_ip"</span> = ::1 ] || [ <span class="org-string">"$server_ip"</span> = <span class="org-string">"$client_ip"</span> ]; <span class="org-keyword">then</span>
        <span class="org-variable-name">hostname</span>=localhost

    <span class="org-comment-delimiter"># </span><span class="org-comment">private network</span>
    <span class="org-keyword">elif</span> { [[ <span class="org-string">"$server_ip"</span> =~ 192.168.* ]] &amp;&amp; [[ <span class="org-string">"$client_ip"</span> =~ 192.168.* ]] } || { [[ <span class="org-string">"$server_ip"</span> =~ 10.* ]] &amp;&amp; [[ <span class="org-string">"$client_ip"</span> =~ 10.* ]] } || { [[ <span class="org-string">"$server_ip"</span> =~ fe80::* ]] &amp;&amp; [[ <span class="org-string">"$client_ip"</span> =~ fe80::* ]] }; <span class="org-keyword">then</span>
        <span class="org-keyword">if</span> command -v avahi-resolve-address &gt; /dev/null; <span class="org-keyword">then</span>
            <span class="org-variable-name">hostname</span>=<span class="org-string">"$(avahi-resolve-address "$server_ip" | awk '{ print $2 }')"</span>
        <span class="org-keyword">fi</span>

        <span class="org-keyword">if</span> [ -z <span class="org-string">"$hostname"</span> ] &amp;&amp; command -v dig &gt; /dev/null; <span class="org-keyword">then</span>
            <span class="org-variable-name">hostname</span>=<span class="org-string">"$(dig +noall +answer -x "$server_ip" | awk '{ print $5 }' | sed 's,\.$,,')"</span>
        <span class="org-keyword">fi</span>
    <span class="org-keyword">fi</span>

    <span class="org-keyword">if</span> [ -z <span class="org-string">"$hostname"</span> ] &amp;&amp; command -v getent &gt; /dev/null; <span class="org-keyword">then</span>
        <span class="org-variable-name">hostname</span>=<span class="org-string">"$(getent hosts "$server_ip" | awk '{ print $2 }')"</span>
    <span class="org-keyword">fi</span>

    <span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> = dumb-emacs-ansi ]; <span class="org-keyword">then</span>
        <span class="org-variable-name">PROMPT</span>+=<span class="org-string">"$HOST"</span>
    <span class="org-keyword">elif</span> [ -n <span class="org-string">"$hostname"</span> ]; <span class="org-keyword">then</span>
        <span class="org-variable-name">PROMPT</span>+=<span class="org-string">"$hostname"</span>
    <span class="org-keyword">else</span>
        <span class="org-variable-name">PROMPT</span>+=%M
    <span class="org-keyword">fi</span>

    <span class="org-keyword">if</span> [ <span class="org-string">"$server_port"</span> -ne 22 ]; <span class="org-keyword">then</span>
        <span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> = dumb-emacs-ansi ]; <span class="org-keyword">then</span>
          <span class="org-variable-name">PROMPT</span>+=<span class="org-string">"#"</span>
        <span class="org-keyword">else</span>
          <span class="org-variable-name">PROMPT</span>+=<span class="org-string">":"</span>
        <span class="org-keyword">fi</span>
        <span class="org-variable-name">PROMPT</span>+=<span class="org-string">"$server_port"</span>
    <span class="org-keyword">fi</span>

    <span class="org-builtin">unset</span> client_ip client_port server_ip server_port hostname

    <span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> = dumb-emacs-ansi ]; <span class="org-keyword">then</span>
      <span class="org-variable-name">PROMPT</span>+=<span class="org-string">':%/'</span>
    <span class="org-keyword">else</span>
      <span class="org-variable-name">PROMPT</span>+=<span class="org-string">'%F{cyan}%/'</span>
    <span class="org-keyword">fi</span>
<span class="org-keyword">else</span>
    <span class="org-variable-name">PROMPT</span>+=<span class="org-string">'%n@%M:%F{cyan}%4~'</span>
<span class="org-keyword">fi</span>
<span class="org-variable-name">PROMPT</span>+=<span class="org-string">'%F{yellow} $ '</span>
<span class="org-variable-name">PROMPT</span>+=<span class="org-string">'%F{reset}'</span>
<span class="org-builtin">export</span> PROMPT

<span class="org-builtin">unset</span> RPS1

<span class="org-variable-name">HISTFILE</span>=<span class="org-string">"$HOME/.zsh_history"</span>
<span class="org-variable-name">REPORTTIME</span>=4
</pre>
</div>

<p>
Update eterm cwds.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-function-name">update_eterm_cwd</span> () {
    printf <span class="org-string">'\eAnSiTc %s\n'</span> <span class="org-string">"$PWD"</span>
    printf <span class="org-string">'\eAnSiTh %s\n'</span> <span class="org-string">"$HOST"</span>
    printf <span class="org-string">'\eAnSiTu %s\n'</span> <span class="org-string">"$USER"</span>
}

<span class="org-keyword">if</span> [ <span class="org-string">"$TERM"</span> = <span class="org-string">"eterm-color"</span> ]; <span class="org-keyword">then</span>
    <span class="org-variable-name">chpwd_functions</span>+=(update_eterm_cwd)
    update_eterm_cwd
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Setup Apple Terminal so that CWD is shown.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-function-name">update_apple_terminal_cwd</span> () {
    printf <span class="org-string">'\e]7;%s\a'</span> <span class="org-string">"file://${HOST-}${PWD// /%20}"</span>
}

<span class="org-keyword">if</span> [ <span class="org-string">"${TERM_PROGRAM-}"</span> = Apple_Terminal ] <span class="org-sh-escaped-newline">\</span>
   &amp;&amp; [ -z <span class="org-string">"${INSIDE_EMACS-}"</span> ] <span class="org-sh-escaped-newline">\</span>
   &amp;&amp; [ -n <span class="org-string">"${TERM_SESSION_ID-}"</span> ]; <span class="org-keyword">then</span>
    <span class="org-variable-name">chpwd_functions</span>+=(update_apple_terminal_cwd)
    update_apple_terminal_cwd
<span class="org-keyword">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0a3d19" class="outline-3">
<h3 id="orga0a3d19"><code>etc-profile.sh</code></h3>
<div class="outline-text-3" id="text-orga0a3d19">
<p>
This just sources everything in the <code>/etc/profile.d</code> dir. <code>PREFIX</code> can be
used to reference the Nix output dir.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-variable-name">PREFIX</span>=@out@
</pre>
</div>

<p>
This will source everything in <code>/etc/profile.d</code>. We skip <code>nix-daemon.sh</code> because
it is put in the global profile, and sets values incorrectly when we are in
single user mode. We need @out@ to come after $HOME so that it gets the last
word in these settings.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ -n <span class="org-string">"${BASH_VERSION-}"</span> ]; <span class="org-keyword">then</span>
    shopt -s nullglob
<span class="org-keyword">fi</span>
<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> <span class="org-string">"$HOME"</span>/.nix-profile/etc/profile.d/*.sh @out@/etc/profile.d/*.sh; <span class="org-keyword">do</span>
  <span class="org-keyword">if</span> [ -r <span class="org-string">"$i"</span> ] &amp;&amp; [ <span class="org-string">"$(@coreutils@/bin/basename "$i")"</span> != nix-daemon.sh ]; <span class="org-keyword">then</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">shellcheck source=/dev/null</span>
    . <span class="org-string">"$i"</span>
  <span class="org-keyword">fi</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org49be47d" class="outline-2">
<h2 id="bootstrap">Bootstrapping</h2>
<div class="outline-text-2" id="text-bootstrap">
</div>

<div id="outline-container-orge8f446c" class="outline-3">
<h3 id="site-paths"><code>site-paths.el.in</code></h3>
<div class="outline-text-3" id="text-site-paths">
<p>
This file provides site-specific paths. However, it must be substituted in Nix
before we can actually run it in Emacs. To prevent Emacs from trying to run
this, I’ve set the syntax to <code>text</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">set-defaults</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">subr-x</span>)
</pre>
</div>

<p>
<code>output-directory</code> points to the nix-profile directory created by Nix.
Ideally, this could point to a Nix store path, but the order of building
means that we don’t know this until too late.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">output-directory</span>
        (expand-file-name <span class="org-string">".nix-profile"</span> (getenv <span class="org-string">"HOME"</span>)))
(<span class="org-keyword">defvar</span> <span class="org-variable-name">zsh-command</span>
        (expand-file-name <span class="org-string">"bin/zsh"</span> output-directory))
</pre>
</div>

<p>
Setup <code>exec-path</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> exec-path
      (append `(,(expand-file-name <span class="org-string">"bin"</span> output-directory)
                <span class="org-string">"@bins@/bin"</span>)
              (split-string <span class="org-string">"@PATH@"</span> <span class="org-string">":"</span>)
              exec-path))
</pre>
</div>

<p>
Setup <code>man-path</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">man-path</span> (append
                  `(<span class="org-string">""</span>
                    ,(expand-file-name <span class="org-string">"share/man"</span> output-directory)
                    <span class="org-string">"@manpages@/share/man"</span>)
                  (split-string <span class="org-string">"@MANPATH@"</span> <span class="org-string">":"</span>)))
</pre>
</div>

<p>
Setup history and stuff. This gets messy, but we need to make sure these are set
otherwise zsh will default to 500 and not save at all!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">bauer-set-history-file</span> (sym val)
  <span class="org-doc">"Setter for history-file."</span>
  (setenv <span class="org-string">"HISTFILE"</span> (eval val))
  (custom-set-default sym val))

(<span class="org-keyword">defcustom</span> <span class="org-variable-name">history-file</span> (expand-file-name <span class="org-string">".zsh_history"</span> (getenv <span class="org-string">"HOME"</span>))
  <span class="org-doc">"The history file to use."</span>
  <span class="org-builtin">:type</span> 'string
  <span class="org-builtin">:group</span> 'bauer
  <span class="org-builtin">:set</span> 'bauer-set-history-file)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">eshell-history-size</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">comint-input-ring-size</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">bauer-set-history-size</span> (sym val)
  <span class="org-doc">"Setter for history-size."</span>
  (setenv <span class="org-string">"HISTSIZE"</span> (format <span class="org-string">"%i"</span> val))
  (setenv <span class="org-string">"SAVEHIST"</span> (format <span class="org-string">"%i"</span> val))
  (<span class="org-keyword">setq</span> eshell-history-size val
        comint-input-ring-size val)
  (custom-set-default sym val))

(<span class="org-keyword">defcustom</span> <span class="org-variable-name">history-size</span> 50000
  <span class="org-doc">"The history size to use."</span>
  <span class="org-builtin">:type</span> 'integer
  <span class="org-builtin">:group</span> 'bauer
  <span class="org-builtin">:set</span> 'bauer-set-history-size)
</pre>
</div>

<p>
Set some more misc. vars.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(append-envs <span class="org-string">":"</span>
 `(<span class="org-string">"MANPATH"</span> ,man-path))
(prepend-envs <span class="org-string">":"</span>
 `(<span class="org-string">"PATH"</span> ,exec-path))
(set-envs
 `(<span class="org-string">"XDG_DATA_DIRS"</span> ,(string-join `(,(expand-file-name <span class="org-string">"share"</span>
                                                      output-directory)
                                   <span class="org-string">"@XDG_DATA_DIRS@"</span>)
                                 <span class="org-string">":"</span>))
 `(<span class="org-string">"TERMINFO_DIRS"</span> <span class="org-string">"@TERMINFO_DIRS@"</span>)
 `(<span class="org-string">"INFOPATH"</span> ,(string-join `(,(expand-file-name <span class="org-string">"share/info"</span>
                                                 output-directory)
                              <span class="org-string">"@INFOPATH@"</span>)
                            <span class="org-string">":"</span>)))
</pre>
</div>

<p>
Set paths provided by Nix,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">gnutls-program</span> <span class="org-string">"gnutls"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">pdf2dsc-command</span> <span class="org-string">"pdf2dsc"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">dvips-command</span> <span class="org-string">"dvips"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">dvipng-command</span> <span class="org-string">"dvipng"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">xetex-command</span> <span class="org-string">"xetex"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">xelatex-command</span> <span class="org-string">"xelatex"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">luatex-command</span> <span class="org-string">"luatex"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">makeinfo-command</span> <span class="org-string">"makeinfo"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">LaTeX-command</span> <span class="org-string">"LaTeX"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">pdftex-command</span> <span class="org-string">"pdftex"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">context-command</span> <span class="org-string">"context"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">bibtex-command</span> <span class="org-string">"bibtex"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">makeindex-command</span> <span class="org-string">"makeindex"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">dvipdfmx-command</span> <span class="org-string">"dvipdfmx"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">ag-executable</span> <span class="org-string">"ag"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">ripgrep-executable</span> <span class="org-string">"ripgrep"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">lacheck-command</span> <span class="org-string">"lacheck"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">chktex-command</span> <span class="org-string">"chktex"</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">ps2pdf-command</span> <span class="org-string">"ps2pdf"</span>)

(set-paths
 '(company-cmake-executable <span class="org-string">"@cmake@/bin/cmake"</span>)
 '(doc-view-dvipdf-program <span class="org-string">"@ghostscript@/bin/dvipdf"</span>)
 '(calc-gnuplot-name <span class="org-string">"@gnuplot@/bin/gnuplot"</span>)
 '(gnuplot-program <span class="org-string">"@gnuplot@/bin/gnuplot"</span>)
 '(doc-view-ps2pdf-program <span class="org-string">"@ghostscript@/bin/ps2pdf"</span>)
 '(dired-touch-program <span class="org-string">"@coreutils@/bin/touch"</span>)
 '(dired-chmod-program <span class="org-string">"@coreutils@/bin/chmod"</span>)
 '(dired-chown-program <span class="org-string">"@coreutils@/bin/chown"</span>)
 '(diff-command <span class="org-string">"@diffutils@/bin/diff"</span>)
 '(find-program <span class="org-string">"@findutils@/bin/find"</span>)
 '(epg-gpg-program <span class="org-string">"@gpg@/bin/gpg"</span>)
 '(epg-gpgconf-program <span class="org-string">"@gpg@/bin/gpgconf"</span>)
 '(epg-gpgsm-program <span class="org-string">"@gpg@/bin/gpgsm"</span>)
 '(flycheck-sh-bash-executable <span class="org-string">"@bash@/bin/bash"</span>)
 '(flycheck-sh-zsh-executable <span class="org-string">"@zsh@/bin/zsh"</span>)
 '(flycheck-perl-executable <span class="org-string">"@perl@/bin/perl"</span>)
 <span class="org-comment-delimiter">;; </span><span class="org-comment">'(flycheck-go-golint-executable "@golint@/bin/golint")</span>
 '(flycheck-haskell-hlint-executable <span class="org-string">"@hlint@/bin/hlint"</span>)
 '(flycheck-python-flake8-executable <span class="org-string">"@flake8@/bin/flake8"</span>)
 '(flycheck-asciidoc-executable <span class="org-string">"@asciidoc@/bin/asciidoc"</span>)
 '(flycheck-less-executable <span class="org-string">"@lessc@/bin/lessc"</span>)
 '(flycheck-c/c++-gcc-executable <span class="org-string">"@gcc@/bin/gcc"</span>)
 '(flycheck-javascript-eslint-executable <span class="org-string">"@eslint@/bin/eslint"</span>)
 '(flycheck-javascript-jshint-executable <span class="org-string">"@jshint@/bin/jshint"</span>)
 <span class="org-comment-delimiter">;; </span><span class="org-comment">'(flycheck-go-build-executable "@go@/bin/go")</span>
 <span class="org-comment-delimiter">;; </span><span class="org-comment">'(flycheck-go-test-executable "@go@/bin/go")</span>
 '(flycheck-lua-executable <span class="org-string">"@lua@/bin/luac"</span>)
 '(flycheck-xml-xmllint-executable <span class="org-string">"@libxml2@/bin/xmllint"</span>)
 '(flycheck-html-tidy-executable <span class="org-string">"@tidy@/bin/tidy"</span>)
 '(fortune-dir <span class="org-string">"@fortune@/share/games/fortunes"</span>)
 '(fortune-program <span class="org-string">"@fortune@/bin/fortune"</span>)
 '(fortune-file <span class="org-string">"@fortune@/share/games/fortunes/debian"</span>)
 '(grep-program <span class="org-string">"@gnugrep@/bin/grep"</span>)
 '(haskell-check-command <span class="org-string">"@hlint@/bin/hlint"</span>)
 '(haskell-hoogle-command <span class="org-string">"@hoogle@/bin/hoogle"</span>)
 '(haskell-hasktags-path <span class="org-string">"@hasktags@/bin/hasktags"</span>)
 '(ispell-grep-command <span class="org-string">"@gnugrep@/bin/grep"</span>)
 '(irony-cmake-executable <span class="org-string">"@cmake@/bin/cmake"</span>)
 '(jka-compr-info-compress-program <span class="org-string">"@ncompress@/bin/compress"</span>)
 '(jka-compr-info-uncompress-program <span class="org-string">"@ncompress@/bin/uncompress"</span>)
 <span class="org-comment-delimiter">;; </span><span class="org-comment">'(irony-server-install-prefix "@irony@")</span>
 '(jka-compr-dd-program <span class="org-string">"@coreutils@/bin/dd"</span>)
 <span class="org-comment-delimiter">;; </span><span class="org-comment">'(magit-git-executable "@git@/bin/git")</span>
 '(markdown-command <span class="org-string">"@markdown2@/bin/markdown2"</span>)
 '(manual-program <span class="org-string">"@man@/bin/man"</span>)
 '(man-awk-command <span class="org-string">"@gawk@/bin/awk"</span>)
 '(man-sed-command <span class="org-string">"@gnused@/bin/sed"</span>)
 '(man-untabify-command <span class="org-string">"@coreutils@/bin/pr"</span>)
 '(nethack-executable <span class="org-string">"@nethack@/bin/nethack"</span>)
 '(org-pandoc-command <span class="org-string">"@pandoc@/bin/pandoc"</span>)
 '(pandoc-binary <span class="org-string">"@pandoc@/bin/pandoc"</span>)
 '(remote-shell-program <span class="org-string">"@openssh@/bin/ssh"</span>)
 '(ripgrep-executable <span class="org-string">"@ripgrep@/bin/rg"</span>)
 '(rtags-path <span class="org-string">"@rtags@/bin"</span>)
 '(sql-ingres-program <span class="org-string">"@parallel@/bin/sql"</span>)
 '(sql-interbase-program <span class="org-string">"@unixODBC@/bin/isql"</span>)
 <span class="org-comment-delimiter">;; </span><span class="org-comment">'(sql-mysql-program "@mariadb@/bin/mysql")</span>
 '(sql-ms-program <span class="org-string">"@freetds@/bin/osql"</span>)
 '(sql-postgres-program <span class="org-string">"@freetds@/bin/osql"</span>)
 '(sql-sqlite-program <span class="org-string">"@sqliteInteractive@/bin/sqlite3"</span>)
 '(tramp-encoding-shell <span class="org-string">"@bash@/bin/sh"</span>)
 '(tex-shell <span class="org-string">"@bash@/bin/sh"</span>)
 '(xargs-program <span class="org-string">"@findutils@/bin/xargs"</span>)
 '(vc-git-program <span class="org-string">"@git@/bin/git"</span>)
 '(gnutls-program <span class="org-string">"@gnutls@/bin/gnutls-cli"</span>)
 '(pdf2dsc-command <span class="org-string">"@ghostscript@/bin/pdf2dsc"</span>)
 '(preview-gs-command <span class="org-string">"@texlive@/bin/rungs"</span>)
 '(TeX-command <span class="org-string">"@texlive@/bin/tex"</span>)
 '(LaTeX-command <span class="org-string">"@texlive@/bin/latex"</span>)
 '(latex-run-command <span class="org-string">"@texlive@/bin/latex"</span>)
 '(tex-run-command <span class="org-string">"@texlive@/bin/tex"</span>)
 '(luatex-command <span class="org-string">"@texlive@/bin/luatex"</span>)
 '(xetex-command <span class="org-string">"@texlive@/bin/xetex"</span>)
 '(xelatex-command <span class="org-string">"@texlive@/bin/xelatex"</span>)
 '(makeinfo-command <span class="org-string">"@texinfoInteractive@/bin/makeinfo"</span>)
 '(pdftex-command <span class="org-string">"@texlive@/bin/pdftex"</span>)
 '(context-command <span class="org-string">"@texlive@/bin/context"</span>)
 '(bibtex-command <span class="org-string">"@texlive@/bin/bibtex"</span>)
 '(dvipdfmx-command <span class="org-string">"@texlive@/bin/dvipdfmx"</span>)
 '(makeindex-command <span class="org-string">"@texlive@/bin/makeindex"</span>)
 '(chktex-command <span class="org-string">"@texlive@/bin/chktex"</span>)
 '(lacheck-command <span class="org-string">"@texlive@/bin/lacheck"</span>)
 '(dvipdfmx-command <span class="org-string">"@texlive@/bin/dvipdfmx"</span>)
 '(dvips-command <span class="org-string">"@texlive@/bin/dvips"</span>)
 '(dvipng-command <span class="org-string">"@texlive@/bin/dvipng"</span>)
 '(ps2pdf-command <span class="org-string">"@ghostscript@/bin/ps2pdf"</span>)
 '(locate-executable <span class="org-string">"@findutils@/bin/locate"</span>)
 '(ag-executable <span class="org-string">"@ag@/bin/ag"</span>)
 '(notmuch-command <span class="org-string">"@notmuch@/bin/notmuch"</span>)
 '(dumb-jump-rg-cmd <span class="org-string">"@ripgrep@/bin/rg"</span>)
 '(dumb-jump-ag-cmd <span class="org-string">"@ag@/bin/ag"</span>)
 '(gud-gdb-command-name <span class="org-string">"@gdb@/bin/gdb"</span>)
 '(coq-prog-name <span class="org-string">"@coq@/bin/coqtop"</span>)
 '(coq-dependency-analyzer <span class="org-string">"@coq@/bin/coqdep"</span>)
 '(coq-compiler <span class="org-string">"@coq@/bin/coqc"</span>)
 )
</pre>
</div>

<p>
Set some defaults that depend on the path variables below,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-defaults
 '(imap-ssl-program `(,(concat gnutls-program <span class="org-string">" --tofu -p %p %s"</span>)))
 '(tls-program (concat gnutls-program <span class="org-string">" --tofu -p %p %h"</span>))
 '(preview-pdf2dsc-command
   (concat pdf2dsc-command <span class="org-string">" %s.pdf %m/preview.dsc"</span>))
 '(preview-dvips-command
   (concat dvips-command <span class="org-string">" -Pwww %d -o %m/preview.ps"</span>))
 '(preview-fast-dvips-command
   (concat dvips-command <span class="org-string">" -Pwww %d -o %m/preview.ps"</span>))
 '(preview-dvipng-command
   (concat dvipng-command
     <span class="org-string">" -picky -noghostscript %d -o \"%m/prev%%03d.png\""</span>))
 '(TeX-engine-alist
   `((xetex <span class="org-string">"XeTeX"</span>
      xetex-command
      xelatex-command
      xetex-command)
     (luatex <span class="org-string">"LuaTeX"</span> luatex-command
      ,(concat luatex-command <span class="org-string">" --jobname=%s"</span>)
      luatex-command)))
 '(TeX-command-list
   `((<span class="org-string">"TeX"</span>
      ,(concat <span class="org-string">"%(PDF)%(tex) %(file-line-error) "</span>
               <span class="org-string">"%(extraopts) %`%S%(PDFout)%(mode)%' %t"</span>)
      TeX-run-TeX nil
      (plain-tex-mode ams-tex-mode texinfo-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Run plain TeX"</span>)
     (<span class="org-string">"LaTeX"</span> <span class="org-string">"%`%l%(mode)%' %t"</span> TeX-run-TeX nil
      (latex-mode doctex-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Run LaTeX"</span>)
     (<span class="org-string">"Makeinfo"</span> ,(concat makeinfo-command
                          <span class="org-string">" %(extraopts) %t"</span>)
      TeX-run-compile nil
      (texinfo-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Run Makeinfo with Info output"</span>)
     (<span class="org-string">"Makeinfo HTML"</span>
      ,(concat makeinfo-command
               <span class="org-string">" %(extraopts) --html %t"</span>)
      TeX-run-compile nil
      (texinfo-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Run Makeinfo with HTML output"</span>)
     (<span class="org-string">"AmSTeX"</span>
      ,(concat pdftex-command
           <span class="org-string">" %(PDFout) %(extraopts) %`%S%(mode)%' %t"</span>)
      TeX-run-TeX nil
      (ams-tex-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Run AMSTeX"</span>)
     (<span class="org-string">"ConTeXt"</span>
      ,(concat context-command
           <span class="org-string">" --once --texutil %(extraopts) %(execopts)%t"</span>)
      TeX-run-TeX nil
      (context-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Run ConTeXt once"</span>)
     (<span class="org-string">"ConTeXt Full"</span>
      ,(concat context-command
               <span class="org-string">" %(extraopts) %(execopts)%t"</span>)
      TeX-run-TeX nil
      (context-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Run ConTeXt until completion"</span>)
     (<span class="org-string">"BibTeX"</span> ,(concat bibtex-command <span class="org-string">" %s"</span>)
      TeX-run-BibTeX nil t <span class="org-builtin">:help</span> <span class="org-string">"Run BibTeX"</span>)
     (<span class="org-string">"Biber"</span> <span class="org-string">"biber %s"</span> TeX-run-Biber nil t
              <span class="org-builtin">:help</span> <span class="org-string">"Run Biber"</span>)
     (<span class="org-string">"View"</span> <span class="org-string">"%V"</span> TeX-run-discard-or-function t t
             <span class="org-builtin">:help</span> <span class="org-string">"Run Viewer"</span>)
     (<span class="org-string">"Print"</span> <span class="org-string">"%p"</span> TeX-run-command t t
             <span class="org-builtin">:help</span> <span class="org-string">"Print the file"</span>)
     (<span class="org-string">"Queue"</span> <span class="org-string">"%q"</span> TeX-run-background nil t
             <span class="org-builtin">:help</span> <span class="org-string">"View the printer queue"</span>
             <span class="org-builtin">:visible</span> TeX-queue-command)
     (<span class="org-string">"File"</span> ,(concat dvips-command <span class="org-string">" %d -o %f "</span>)
      TeX-run-dvips t t <span class="org-builtin">:help</span> <span class="org-string">"Generate PostScript file"</span>)
     (<span class="org-string">"Dvips"</span> ,(concat dvips-command <span class="org-string">" %d -o %f "</span>)
      TeX-run-dvips nil t
      <span class="org-builtin">:help</span> <span class="org-string">"Convert DVI file to PostScript"</span>)
     (<span class="org-string">"Dvipdfmx"</span> ,(concat dvipdfmx-command <span class="org-string">" %d"</span>)
      TeX-run-dvipdfmx nil t
      <span class="org-builtin">:help</span> <span class="org-string">"Convert DVI file to PDF with dvipdfmx"</span>)
     (<span class="org-string">"Ps2pdf"</span> ,(concat ps2pdf-command <span class="org-string">" %f"</span>)
      TeX-run-ps2pdf nil t
      <span class="org-builtin">:help</span> <span class="org-string">"Convert PostScript file to PDF"</span>)
     (<span class="org-string">"Index"</span> ,(concat makeindex-command <span class="org-string">" %s"</span>)
      TeX-run-index nil t
      <span class="org-builtin">:help</span> <span class="org-string">"Run makeindex to create index file"</span>)
     (<span class="org-string">"upMendex"</span> <span class="org-string">"upmendex %s"</span>
      TeX-run-index t t
      <span class="org-builtin">:help</span> <span class="org-string">"Run mendex to create index file"</span>)
     (<span class="org-string">"Xindy"</span> <span class="org-string">"xindy %s"</span>
      TeX-run-command nil t
      <span class="org-builtin">:help</span> <span class="org-string">"Run xindy to create index file"</span>)
     (<span class="org-string">"Check"</span> ,(concat lacheck-command <span class="org-string">" %s"</span>)
      TeX-run-compile nil
      (latex-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Check LaTeX file for correctness"</span>)
     (<span class="org-string">"ChkTeX"</span> ,(concat chktex-command <span class="org-string">" -v6 %s"</span>)
      TeX-run-compile nil
      (latex-mode)
      <span class="org-builtin">:help</span> <span class="org-string">"Check LaTeX file for common mistakes"</span>)
     (<span class="org-string">"Spell"</span> <span class="org-string">"(TeX-ispell-document \"\")"</span>
      TeX-run-function nil t
      <span class="org-builtin">:help</span> <span class="org-string">"Spell-check the document"</span>)
     (<span class="org-string">"Clean"</span> <span class="org-string">"TeX-clean"</span>
      TeX-run-function nil t
      <span class="org-builtin">:help</span> <span class="org-string">"Delete generated intermediate files"</span>)
     (<span class="org-string">"Clean All"</span> <span class="org-string">"(TeX-clean t)"</span> TeX-run-function nil t
      <span class="org-builtin">:help</span>
      <span class="org-string">"Delete generated intermediate and output files"</span>)
     (<span class="org-string">"Other"</span> <span class="org-string">""</span> TeX-run-command t t
      <span class="org-builtin">:help</span> <span class="org-string">"Run an arbitrary command"</span>)))
 '(counsel-grep-base-command
   (concat ripgrep-executable
    <span class="org-string">" -i -M 120 --no-heading --line-number --color never '%s' %s"</span>))
 '(counsel-rg-base-command
   (concat ripgrep-executable
           <span class="org-string">" -i --no-heading --line-number %s ."</span>))
 '(counsel-ag-base-command
   (concat ag-executable <span class="org-string">" --nocolor --nogroup %s"</span>))
 '(org-preview-latex-process-alist
   `((dvipng
      <span class="org-builtin">:programs</span> (<span class="org-string">"latex"</span> <span class="org-string">"dvipng"</span>)
          <span class="org-builtin">:description</span> <span class="org-string">"dvi &gt; png"</span>
          <span class="org-builtin">:message</span> <span class="org-string">""</span>
          <span class="org-builtin">:image-input-type</span> <span class="org-string">"dvi"</span>
          <span class="org-builtin">:image-output-type</span> <span class="org-string">"png"</span>
          <span class="org-builtin">:image-size-adjust</span> (1.0 . 1.0)
          <span class="org-builtin">:latex-compiler</span>
      (,(concat LaTeX-command
         <span class="org-string">" -interaction nonstopmode -output-directory %o %f"</span>))
          <span class="org-builtin">:image-converter</span>
      (,(concat dvipng-command
         <span class="org-string">" -fg %F -bg %B -D %D -T tight -o %O %f"</span>)))))
 '(Info-directory-list '(<span class="org-string">"@infopages@/share/info"</span>))
 '(tramp-remote-path
   `(tramp-own-remote-path
         <span class="org-string">"/run/current-system/sw/bin"</span>
         tramp-default-remote-path
         <span class="org-string">"/bin"</span>
         <span class="org-string">"/usr/bin"</span>
         <span class="org-string">"/sbin"</span>
         <span class="org-string">"/usr/sbin"</span>
         <span class="org-string">"/usr/local/bin"</span>
         <span class="org-string">"/usr/local/sbin"</span>
         <span class="org-string">"/opt/bin"</span>
         <span class="org-string">"/opt/sbin"</span>
         ,(expand-file-name <span class="org-string">"bin"</span> output-directory)))
 '(woman-manpath man-path)
 '(Man-header-file-path
   `(<span class="org-string">"@sysheaders@/include"</span>
     <span class="org-string">"/usr/include"</span>
     <span class="org-string">"/usr/local/include"</span>))
 '(ffap-c-path
   '(<span class="org-string">"@sysheaders@/include"</span>
     <span class="org-string">"/usr/include"</span>
     <span class="org-string">"/usr/local/include"</span>))
 '(rng-schema-locating-files
   `(<span class="org-string">"schemas.xml"</span>
         <span class="org-string">"@schemas@"</span>
         ,(expand-file-name
            <span class="org-string">"schema/schemas.xml"</span> data-directory)))
 <span class="org-comment-delimiter">;; </span><span class="org-comment">'(irony-additional-clang-options</span>
 <span class="org-comment-delimiter">;;   </span><span class="org-comment">'("-I@sysheaders@/include"</span>
 <span class="org-comment-delimiter">;;         </span><span class="org-comment">"-I@sysheaders@/include/c++/v1"</span>
 <span class="org-comment-delimiter">;;         </span><span class="org-comment">"-F@sysframeworks@/Library/Frameworks"))</span>
 )
</pre>
</div>
</div>
</div>

<div id="outline-container-org427435c" class="outline-3">
<h3 id="org427435c"><code>bootstrap.sh</code></h3>
<div class="outline-text-3" id="text-org427435c">
<p>
This is the bootstrap script that is mentioned above. We use it to install the
IDE. It ensures Nix is installed as well as that the Git repo is available &amp;
up-to-date. Note, this script will automatically install Nix and Git for you if
they are not already installed! Use it at your own risk.
</p>

<p>
Install Nix if it isn’t already.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">set</span> -e

<span class="org-builtin">echo</span> This script will install Nix and Git
<span class="org-builtin">echo</span> if they are not already installed.

<span class="org-keyword">if</span> <span class="org-negation-char">!</span> command -v nix-env &gt;/dev/null 2&gt;&amp;1; <span class="org-keyword">then</span>
    <span class="org-variable-name">nix_installer</span>=$(mktemp)
    curl -L -s https://nixos.org/nix/install <span class="org-sh-escaped-newline">\</span>
      &gt; $<span class="org-variable-name">nix_installer</span>
    sh $<span class="org-variable-name">nix_installer</span>
    [ -f $<span class="org-variable-name">HOME</span>/.profile ] &amp;&amp; . $<span class="org-variable-name">HOME</span>/.profile
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Check for Git. Install if it’s not there.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> <span class="org-negation-char">!</span> command -v git &gt;/dev/null 2&gt;&amp;1 || <span class="org-sh-escaped-newline">\</span>
   { [ <span class="org-string">"$(uname)"</span> = Darwin ] &amp;&amp; <span class="org-sh-escaped-newline">\</span>
     [ <span class="org-string">"$(command -v git)"</span> = /usr/bin/git ] &amp;&amp;
     xcode-select -p &gt;/dev/null 2&gt;&amp;1; }; <span class="org-keyword">then</span>
    nix-env -iA nixpkgs.git || nix-env -iA nixos.git
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
If we are in a Git repo already, we’ll pull to get latest updates.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ -d .git ]; <span class="org-keyword">then</span>
    git pull origin master || <span class="org-builtin">true</span>
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
If we can’t find default.nix then we’ll clone from GitHub. This will be stored in
<code>~/.local/share/bauer</code>. 
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> <span class="org-negation-char">!</span> [ -f default.nix ]; <span class="org-keyword">then</span>
    <span class="org-variable-name">repo_dir</span>=$<span class="org-variable-name">HOME</span>/.local/share/bauer
    mkdir -p $(dirname $<span class="org-variable-name">repo_dir</span>)
    <span class="org-keyword">if</span> <span class="org-negation-char">!</span> [ -d $<span class="org-variable-name">repo_dir</span>/.git ]; <span class="org-keyword">then</span>
      git clone https://github.com/matthewbauer/bauer <span class="org-sh-escaped-newline">\</span>
                $<span class="org-variable-name">repo_dir</span>
    <span class="org-keyword">else</span>
      git -C $<span class="org-variable-name">repo_dir</span> pull
    <span class="org-keyword">fi</span>
    <span class="org-builtin">cd</span> $<span class="org-variable-name">repo_dir</span>
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Install our new derivation.
</p>

<div class="org-src-container">
<pre class="src src-shell">nix-env -if .
</pre>
</div>

<p>
Source the profile.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> <span class="org-negation-char">!</span> [ -f <span class="org-string">"$HOME/.profile"</span> ] || <span class="org-negation-char">!</span> grep -q <span class="org-string">'source "\?$HOME/.nix-profile/etc/profile"\?'</span> <span class="org-string">"$HOME/.profile"</span>; <span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> <span class="org-string">'[ -f "$HOME/.nix-profile/etc/profile" ] &amp;&amp; source "$HOME/.nix-profile/etc/profile"'</span> &gt;&gt; <span class="org-string">"$HOME/.profile"</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> <span class="org-negation-char">!</span> [ -f <span class="org-string">"$HOME/.zshrc"</span> ] || <span class="org-negation-char">!</span> grep -q <span class="org-string">'source "\?$HOME/.nix-profile/etc/zshrc"\?'</span> <span class="org-string">"$HOME/.zshrc"</span>; <span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> <span class="org-string">'[ -f "$HOME/.nix-profile/etc/zshrc" ] &amp;&amp; source "$HOME/.nix-profile/etc/zshrc"'</span> &gt;&gt; <span class="org-string">"$HOME/.zshrc"</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if</span> <span class="org-negation-char">!</span> [ -f <span class="org-string">"$HOME/.bashrc"</span> ] || <span class="org-negation-char">!</span> grep -q <span class="org-string">'source "\?$HOME/.nix-profile/etc/profile"\?'</span> <span class="org-string">"$HOME/.bashrc"</span>; <span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> <span class="org-string">'[ -f "$HOME/.nix-profile/etc/profile" ] &amp;&amp; source "$HOME/.nix-profile/etc/profile"'</span> &gt;&gt; <span class="org-string">"$HOME/.bashrc"</span>
<span class="org-keyword">fi</span>

<span class="org-builtin">source</span> <span class="org-string">"$HOME/.nix-profile/etc/profile"</span>

<span class="org-builtin">echo</span> To use bauer correctly, you must first source the profile.
<span class="org-builtin">echo</span>
<span class="org-builtin">echo</span> To do this, just run:
<span class="org-builtin">echo</span> $ source $<span class="org-variable-name">HOME</span>/.nix-profile/etc/profile

<span class="org-keyword">if</span> [ -n <span class="org-string">"${ZSH_NAME-}"</span> ]; <span class="org-keyword">then</span>
    <span class="org-builtin">source</span> <span class="org-string">"$HOME/.nix-profile/etc/zshrc"</span>
    <span class="org-builtin">echo</span> $ source $<span class="org-variable-name">HOME</span>/.nix-profile/etc/zshrc
<span class="org-keyword">fi</span>

<span class="org-builtin">echo</span> From you command line
<span class="org-builtin">echo</span> You can also run either emacs or zsh to launch the environment
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ -n <span class="org-string">"$1"</span> ] &amp;&amp; <span class="org-sh-escaped-newline">\</span>
   command -v git &gt;/dev/null 2&gt;&amp;1 <span class="org-sh-escaped-newline">\</span>
   &amp;&amp; (<span class="org-builtin">echo</span> <span class="org-string">"$1"</span> | grep -q <span class="org-string">"^[0-9a-f]\{5,40\}$"</span>); <span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> Found Gist commit $<span class="org-variable-name">1</span>, cloning now.
    ./gist-unpack.sh <span class="org-string">"$1"</span>
<span class="org-keyword">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb27a49" class="outline-3">
<h3 id="runemacs"><code>runemacs.sh</code></h3>
<div class="outline-text-3" id="text-runemacs">
<p>
Cross-platform script to execute the app. Uses <code>open</code> on macOS to get the
graphical version of Emacs.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">case</span> $(uname) <span class="org-keyword">in</span>
    Darwin)
        open @emacs@/Applications/Emacs.app
    ;;
    *)
        @emacs@/bin/emacs
    ;;
<span class="org-keyword">esac</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgcd7a926" class="outline-2">
<h2 id="build">Building</h2>
<div class="outline-text-2" id="text-build">
<p>
No tests currently exists, but some things are important to keep in mind. Some
high level goals that should be verified:
</p>

<ul class="org-ul">
<li>Keep closure size under 1GB (currently 800MB)</li>
<li>Don’t assume users’ language, locales, time zone, etc.</li>
<li>Don’t hard code any personal information</li>
<li>Everything should run on Linux, and macOS.</li>
<li>Nix usage is optional (see Withou Nix above).</li>
</ul>

<p>
The editor and environment should be general purpose and portable
</p>
</div>

<div id="outline-container-orga13971f" class="outline-3">
<h3 id="orga13971f"><code>default.nix</code>: the tangler</h3>
<div class="outline-text-3" id="text-orga13971f">
<p>
Here we being the building process. There are a couple of stages to this not
normally seen in configurations. The first part is the ‘default.nix’ which will
tangle the README.org file. This should be the only file that has to live
outside of this ORG document. This is meant to be very minimal so that once we
tangle README.org, we can get a working .nix file to import from using Nix’s
import from derivation.
</p>

<p>
The function header defines some arguments you can pass. It will use the latest
nixpkgs-unstable from nixos.org. If you want to change this, you can pass in
your own pkgs variable.
</p>

<p>
The small argument is a bit of a hack. Nix will only recognize args that have
been explicitly listed so we cannot rely on the ‘&#x2026;’ syntax to pick up random
args.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-comment-delimiter"># </span><span class="org-comment">-*- mode: nix; coding: utf-8; -*-</span>
{ version ? <span class="org-string">"20.03"</span>
, channel ? {
    <span class="org-string">"x86_64-darwin"</span> = <span class="org-string">"nixpkgs-</span><span class="org-nix-antiquote">${</span>version<span class="org-nix-antiquote">}</span><span class="org-string">-darwin"</span>;
  }.${builtins.currentSystem} <span class="org-nix-keyword">or</span> <span class="org-string">"nixos-</span><span class="org-nix-antiquote">${</span>version<span class="org-nix-antiquote">}</span>"
, nixpkgs-url ?
  <span class="org-string">"https://nixos.org/channels/</span><span class="org-nix-antiquote">${</span>channel<span class="org-nix-antiquote">}</span><span class="org-string">/nixexprs.tar.xz"</span>
, system ? builtins.currentSystem
, crossSystem ? <span class="org-nix-builtin">null</span>
, config ? {}
, overlays ? []
, pkgs ? <span class="org-nix-builtin">import</span> (builtins.fetchTarball nixpkgs-url) {
  <span class="org-nix-keyword">inherit</span> crossSystem system config overlays;
}
, small ? <span class="org-nix-builtin">true</span>
, ...
} @ args:
</pre>
</div>

<p>
Now let&rsquo;s tangle README.org&#x2026; This uses ORG’s babel functionality to generate a
.nix file. The .nix file is renamed to default.nix to replace this script.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-keyword">let</span>
  <span class="org-nix-attribute">ensure</span> = f: n: <span class="org-nix-keyword">if</span> builtins.pathExists f <span class="org-nix-keyword">then</span> f
     <span class="org-nix-keyword">else</span> builtins.fetchurl
     <span class="org-string">"https://matthewbauer.us/bauer/</span><span class="org-nix-antiquote">${</span>n<span class="org-nix-antiquote">}</span>";
<span class="org-nix-keyword">in</span> <span class="org-nix-builtin">import</span> (pkgs.runCommand <span class="org-string">"README"</span> {
  <span class="org-nix-attribute">buildInputs</span> = <span class="org-nix-keyword">with</span> pkgs; [ emacs git ];
} (<span class="org-string">''</span>
<span class="org-string">  install -D </span><span class="org-nix-antiquote">${</span>ensure <span class="org-nix-constant">./README.org</span> <span class="org-string">"README.org"</span><span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">    $out/README.org</span>
<span class="org-string">  cd $out</span>
<span class="org-string">''</span> + pkgs.lib.optionalString (builtins.pathExists <span class="org-nix-constant">./site-lisp</span>) <span class="org-string">''</span>
<span class="org-string">  cp -r </span><span class="org-nix-antiquote">${</span><span class="org-nix-constant">./site-lisp</span><span class="org-nix-antiquote">}</span><span class="org-string"> site-lisp</span>
<span class="org-string">''</span> + <span class="org-string">''</span>
<span class="org-string">  emacs --batch --quick \</span>
<span class="org-string">  -l ob-tangle \</span>
<span class="org-string">  --eval "(org-babel-tangle-file \"README.org\")" &gt; /dev/null</span>
<span class="org-string">  cp bauer.nix default.nix</span>
<span class="org-string">''</span>)) { <span class="org-nix-keyword">inherit</span> ensure pkgs small; }
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc801148" class="outline-3">
<h3 id="orgc801148"><code>bauer.nix</code>: the build script</h3>
<div class="outline-text-3" id="text-orgc801148">
<p>
Here we have the actual Nix file that will build our Emacs configuration. Again
we have some options that can be provided&#x2026;
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-comment-delimiter"># </span><span class="org-comment">-*- mode: nix; coding: utf-8; -*-</span>
{ system ? builtins.currentSystem
, crossSystem ? <span class="org-nix-builtin">null</span>
, config ? {}
, overlays ? []
, pkgs ? <span class="org-nix-builtin">import</span> <span class="org-nix-constant">&lt;nixpkgs&gt;</span> { <span class="org-nix-keyword">inherit</span> crossSystem system config overlays; }
, ensure ? f: n: f
, small ? pkgs.config.bauer.small <span class="org-nix-keyword">or</span> <span class="org-nix-builtin">true</span>
, ... }: <span class="org-nix-keyword">let</span>
<span class="org-nix-keyword">inherit</span> (pkgs) stdenv lib runCommand buildEnv config writeText;
<span class="org-nix-keyword">inherit</span> (stdenv) hostPlatform;
<span class="org-nix-attribute">big</span> = !small;
<span class="org-nix-attribute">allowUnfree</span> = config.allowUnfree <span class="org-nix-keyword">or</span> <span class="org-nix-builtin">false</span>;
</pre>
</div>

<p>
By default, you will be building the &ldquo;small&rdquo; version which is about 500MB. The
normal version has a huge closure totalling in at over 5GB. This is extremely
useful for integrations with developer tools and manuals, but also inconvenient
when wanting to start running for the first time. If you want to enable the big
version, you can just do ‘config.bauer.small = false’ in your
~/.config/nixpkgs/config.nix file.
Alternatively, if you <i>want</i> the small version, just do
‘nixpkgs.config.bauer.small = true’.
</p>

<p>
Next we start defining some packages. R is one of the simpler ones right now,
so let&rsquo;s start with that.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">rEnv</span> = pkgs.rWrapper.override {
  <span class="org-nix-attribute">packages</span> = <span class="org-nix-keyword">with</span> pkgs.rPackages; [
    RCurl
  ];
};
</pre>
</div>

<p>
Here we define our package set. This will just give us access to all of the
Emacs packages defined in Nixpkgs.
</p>

<p>
We also define our Emacs version to use. Mitsuharo’s Emacs package is much
better for MacOS so we use that when we’re on Darwin systems. Otherwise, just
default to ‘emacs’ which should be the latest (Nixpkgs-unstable has version 26.1
currently).
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">customEmacsPackages</span> = pkgs.emacsPackagesNgGen
  (<span class="org-nix-keyword">if</span> hostPlatform.isDarwin <span class="org-nix-keyword">then</span> pkgs.emacsMacport <span class="org-nix-keyword">else</span> pkgs.emacs);
</pre>
</div>

<p>
Tex live provides some LaTeX commads for us.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">myTex</span> = pkgs.texlive.combine {
  <span class="org-nix-keyword">inherit</span> (pkgs.texlive) xetex setspace
    fontspec chktex enumitem xifthen
    ifmtarg filehook wrapfig inconsolata
    upquote minted lastpage collection-basic
    collection-binextra collection-context
    collection-fontsrecommended collection-fontutils
    collection-langenglish collection-latex
    collection-latexrecommended collection-luatex
    collection-metapost collection-texworks
    collection-xetex capt-of ulem hyperref titlesec;
};
</pre>
</div>
</div>

<div id="outline-container-orge78b1ca" class="outline-4">
<h4 id="orge78b1ca">Emacs configuration</h4>
<div class="outline-text-4" id="text-orge78b1ca">
<p>
Here, we start building up the site-paths.el file. This does a simple
substitution of all the attributes set.
</p>

<div class="org-src-container">
<pre class="src src-nix">  <span class="org-nix-attribute">site-paths</span> = runCommand <span class="org-string">"site-paths.el"</span> (<span class="org-nix-keyword">with</span> pkgs; ({
    <span class="org-nix-keyword">inherit</span> (customEmacsPackages) emacs;
    <span class="org-nix-attribute">bash</span> = bashInteractive;
    <span class="org-nix-keyword">inherit</span> ripgrep ag
      coreutils findutils openssh
      zsh diffutils man gawk
      gnugrep gnused cacert git;

    <span class="org-nix-keyword">inherit</span> manpages sysheaders sysframeworks
      schemas bins infopages;

    <span class="org-nix-keyword">inherit</span> MANPATH PATH XDG_DATA_DIRS INFOPATH TERMINFO_DIRS;
  } // (lib.optionalAttrs big {
    <span class="org-nix-attribute">gpg</span> = gnupg1compat;
    <span class="org-nix-keyword">inherit</span> ant perl perlcritic
      asciidoc lessc lua gcc
      pandoc clang cmake ghostscript
      sqliteInteractive freetds
      parallel unixODBC ncompress
      texinfoInteractive notmuch gnuplot
      gdb coq rtags gnutls
      ;
    <span class="org-nix-keyword">inherit</span> (pythonPackages) flake8;
    <span class="org-nix-keyword">inherit</span> (nodePackages) jshint eslint;
    <span class="org-nix-keyword">inherit</span> (haskellPackages) hoogle hlint;
    <span class="org-nix-attribute">texlive</span> = myTex;
    <span class="org-nix-attribute">markdown2</span> = pythonPackages.markdown2;
    <span class="org-nix-attribute">tidy</span> = html-tidy;
    <span class="org-nix-attribute">libxml2</span> = libxml2.bin;
  }))) <span class="org-string">''</span>
<span class="org-string">    substituteAll </span><span class="org-nix-antiquote">${</span><span class="org-nix-constant">./site-paths.el.in</span><span class="org-nix-antiquote">}</span><span class="org-string"> $out</span>
<span class="org-string">    substituteInPlace $out \</span>
<span class="org-string">      --subst-var-by PATH </span><span class="org-nix-antiquote">${</span>PATH<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">      --subst-var-by INFOPATH </span><span class="org-nix-antiquote">${</span>INFOPATH<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">      --subst-var-by MANPATH </span><span class="org-nix-antiquote">${</span>MANPATH<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">      --subst-var-by XDG_DATA_DIRS </span><span class="org-nix-antiquote">${</span>XDG_DATA_DIRS<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">      --subst-var-by TERMINFO_DIRS </span><span class="org-nix-antiquote">${</span>TERMINFO_DIRS<span class="org-nix-antiquote">}</span>
'';
</pre>
</div>

<p>
Emacs building can be divided into phases. Each phase will run through the Elisp
once.
</p>
</div>

<ul class="org-ul">
<li><a id="orgefa054f"></a>Phase 1: picking up dependencies<br />
<div class="outline-text-5" id="text-orgefa054f">
<p>
myEmacsPackages gets a listing of all of the packages that are needed by the
Emacs configuration. use-package-list generates this list automatically.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">package-list</span> =
  runCommand <span class="org-string">"package-list"</span> {
    <span class="org-nix-attribute">buildInputs</span> = [ customEmacsPackages.emacs ];
  } <span class="org-string">''</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nix">emacs --batch --quick \
      -L ${customEmacsPackages.use-package
    }<span class="org-nix-constant">/share/emacs/site-lisp/elpa/use-package-</span>* \
      -L ${customEmacsPackages.delight
    }<span class="org-nix-constant">/share/emacs/site-lisp/elpa/delight-</span>* \
      -L ${customEmacsPackages.bind-key
    }<span class="org-nix-constant">/share/emacs/site-lisp/elpa/bind-key-</span>* \
      -l ${ensure <span class="org-nix-constant">./site-lisp/set-defaults.el</span>
       <span class="org-string">"site-lisp/set-defaults.el"</span>} \
      -l ${ensure <span class="org-nix-constant">./site-lisp/bauer.el</span>
       <span class="org-string">"site-lisp/bauer.el"</span>} \
      -l ${ensure <span class="org-nix-constant">./site-lisp/use-package-list.el</span>
       <span class="org-string">"site-lisp/use-package-list.el"</span>} \
      --eval <span class="org-string">"(use-package-list \"</span><span class="org-nix-antiquote">${</span><span class="org-nix-constant">./README.el</span><span class="org-nix-antiquote">}</span><span class="org-string">\")"</span> \
      &gt; $out 2&gt;<span class="org-nix-constant">/dev/null</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-string">'';</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">myEmacsPackages'</span> = builtins.fromJSON
       (builtins.readFile package-list);
</pre>
</div>
</div>
</li>

<li><a id="orge7a7090"></a>Phase 2: byte compiling<br />
<div class="outline-text-5" id="text-orge7a7090">
<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">default</span> = runCommand <span class="org-string">"bauer-emacs"</span> {
  <span class="org-nix-attribute">buildInputs</span> = [ pkgs.emacs ];
} <span class="org-string">''</span>
</pre>
</div>

<p>
Install our lisp files. Many of these should be released into MELPA but don’t
have the time to do it currently.
</p>

<div class="org-src-container">
<pre class="src src-nix">install -D ${site-paths} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/site-paths.el</span>
install -D ${<span class="org-nix-constant">./README.el</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/default.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/em-dired.el</span>
         <span class="org-string">"site-lisp/em-dired.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/em-dired.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/dired-column.el</span>
         <span class="org-string">"site-lisp/dired-column.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/dired-column.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/macho-mode.el</span>
         <span class="org-string">"site-lisp/macho-mode.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/macho-mode.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/nethack.el</span>
         <span class="org-string">"site-lisp/nethack.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/nethack.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/set-defaults.el</span>
         <span class="org-string">"site-lisp/set-defaults.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/set-defaults.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/installer.el</span>
         <span class="org-string">"site-lisp/installer.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/installer.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/restart-emacs.el</span>
         <span class="org-string">"site-lisp/restart-emacs.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/restart-emacs.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/use-package-list.el</span>
         <span class="org-string">"site-lisp/use-package-list.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/use-package-list.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/bauer.el</span>
        <span class="org-string">"site-lisp/bauer.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/bauer.el</span>
install -D ${ensure <span class="org-nix-constant">./site-lisp/comint-hyperlink.el</span>
        <span class="org-string">"site-lisp/comint-hyperlink.el"</span>} \
  $<span class="org-nix-constant">out/share/emacs/site-lisp/comint-hyperlink.el</span>
</pre>
</div>

<p>
This is fairly complicated. What happens is we batch compile all of the .el
files. The problem is the .el files all are going to depend on dependencies
that we have just found in package-list. The solution is that complex eval
below where we add all of the paths (plus their requisites) to the load
path. This works but is hacky &amp; I am interested in fixing it.
</p>

<div class="org-src-container">
<pre class="src src-nix">cd $<span class="org-nix-constant">out/share/emacs/site-lisp</span>
export <span class="org-nix-attribute">HOME</span>=$PWD
emacs --batch --quick \
      --eval \
<span class="org-string">"(let ((default-directory \"</span><span class="org-nix-antiquote">${</span>emacsWrapper
  ((requiredPackages customEmacsPackages myEmacsPackages')
   ++ (<span class="org-nix-keyword">with</span> customEmacsPackages; [use-package delight]))
<span class="org-nix-antiquote">}</span><span class="org-string">/share/emacs/site-lisp\"))</span>
<span class="org-string">  (normal-top-level-add-subdirs-to-load-path))"</span> \
      -L . -f batch-byte-compile *.el
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-string">'';</span>
</pre>
</div>
</div>
</li>

<li><a id="orgca9541f"></a>Phase 3: wrapping into Emacs<br />
<div class="outline-text-5" id="text-orgca9541f">
<p>
This phase wraps the byte compiled lisp into an Emacs binary. Each package
listed in <code>use-package</code> above is pulled into the closure.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">emacsWrapper</span> = explicitRequires:
 runCommand <span class="org-string">"emacs-packages-deps"</span>
 { <span class="org-nix-attribute">nativeBuildInputs</span> = [ pkgs.xorg.lndir pkgs.emacs ];
   <span class="org-nix-keyword">inherit</span> explicitRequires; } <span class="org-string">''</span>
<span class="org-string">findInputsOld() {</span>
<span class="org-string">    local pkg="$1"; shift</span>
<span class="org-string">    local var="$1"; shift</span>
<span class="org-string">    local propagatedBuildInputsFiles=("$@")</span>
<span class="org-string">    local varSlice="$var[*]"</span>
<span class="org-string">    case "''${!varSlice-}" in</span>
<span class="org-string">  *" $pkg "*) return 0 ;;</span>
<span class="org-string">    esac</span>
<span class="org-string">    unset -v varSlice</span>
<span class="org-string">    eval "$var"'+=("$pkg")'</span>
<span class="org-string">    if ! [ -e "$pkg" ]; then</span>
<span class="org-string">  echo "build input $pkg does not exist" &gt;&amp;2</span>
<span class="org-string">  exit 1</span>
<span class="org-string">    fi</span>
<span class="org-string">    local file</span>
<span class="org-string">    for file in "''${propagatedBuildInputsFiles[@]}"; do</span>
<span class="org-string">  file="$pkg/nix-support/$file"</span>
<span class="org-string">  [[ -f "$file" ]] || continue</span>
<span class="org-string">  local pkgNext</span>
<span class="org-string">  for pkgNext in $(&lt; "$file"); do</span>
<span class="org-string">      findInputsOld "$pkgNext" "$var" \</span>
<span class="org-string">        "''${propagatedBuildInputsFiles[@]}"</span>
<span class="org-string">  done</span>
<span class="org-string">    done</span>
<span class="org-string">}</span>
<span class="org-string">mkdir -p $out/bin</span>
<span class="org-string">mkdir -p $out/share/emacs/site-lisp</span>
<span class="org-string">local requires</span>
<span class="org-string">for pkg in $explicitRequires; do</span>
<span class="org-string">  findInputsOld $pkg requires propagated-user-env-packages</span>
<span class="org-string">done</span>
<span class="org-string">linkPath() {</span>
<span class="org-string">  local pkg=$1</span>
<span class="org-string">  local origin_path=$2</span>
<span class="org-string">  local dest_path=$3</span>
<span class="org-string">  if [ -d "$pkg/$origin_path" ]; then</span>
<span class="org-string">    lndir -silent "$pkg/$origin_path" \</span>
<span class="org-string">           "$out/$dest_path"</span>
<span class="org-string">  fi</span>
<span class="org-string">}</span>
<span class="org-string">linkEmacsPackage() {</span>
<span class="org-string">  linkPath "$1" "bin" "bin"</span>
<span class="org-string">  linkPath "$1" "share/emacs/site-lisp" \</span>
<span class="org-string">    "share/emacs/site-lisp"</span>
<span class="org-string">}</span>
<span class="org-string">for pkg in "''${requires[@]}"; do</span>
<span class="org-string">  linkEmacsPackage $pkg</span>
<span class="org-string">done</span>
<span class="org-string">emacs --batch -f batch-byte-compile \</span>
<span class="org-string">        "$siteStart"</span>
<span class="org-string">''</span>;
</pre>
</div>

<p>
requiredPackages is a function that takes two arguments.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">requiredPackages</span> = epkgs: <span class="org-nix-builtin">map</span> (x:
  <span class="org-nix-keyword">if</span> builtins.hasAttr x epkgs
    <span class="org-nix-keyword">then</span> builtins.getAttr x epkgs
  <span class="org-nix-keyword">else</span> if builtins.hasAttr x pkgs.emacsPackages
    <span class="org-nix-keyword">then</span> builtins.getAttr x pkgs.emacsPackages
  <span class="org-nix-keyword">else</span> <span class="org-nix-keyword-warning">abort</span> <span class="org-string">"no attribute found for use-package </span><span class="org-nix-antiquote">${</span>x<span class="org-nix-antiquote">}</span>");
</pre>
</div>

<p>
Now we build our Emacs distribution.
</p>

<p>
TODO: use dump-emacs here to speed up config.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">myEmacsPackages</span> = buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"emacs-packages-env"</span>;
  <span class="org-nix-attribute">paths</span> = (requiredPackages customEmacsPackages myEmacsPackages')
  ++ [ customEmacsPackages.use-package customEmacsPackages.delight ];
};

<span class="org-nix-attribute">myEmacs</span> = customEmacsPackages.emacsWithPackages (epkgs:
  (requiredPackages epkgs myEmacsPackages')
  ++ [default epkgs.use-package epkgs.delight]
);
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgc706095" class="outline-4">
<h4 id="orgc706095">The environment</h4>
<div class="outline-text-4" id="text-orgc706095">
<p>
Finally, we can actually build the environment. This just uses Nixpkgs
<code>buildEnv</code> to generate Nix paths for the different packages. Some need special handling.
</p>

<p>
First, we build the info pages. This takes all of the packages listed in
<code>userPackages</code> and runs <code>install-info</code> on them. Info pages are usually found in
the <code>$out/share/info</code> directory, but in Emacs packages can be found anywhere in
<code>$out/share/emacs</code>.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">infopages</span> = buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"info-pages"</span>;
  <span class="org-nix-attribute">buildInputs</span> = [ pkgs.texinfoInteractive ];
  <span class="org-nix-attribute">paths</span> = userPackages ++ [customEmacsPackages.emacs]
    ++ lib.optional hostPlatform.isLinux pkgs.glibcInfo;
  <span class="org-nix-attribute">extraOutputsToInstall</span> = [ <span class="org-string">"info"</span> <span class="org-string">"doc"</span> <span class="org-string">"devdoc"</span> ];
  <span class="org-nix-attribute">pathsToLink</span> = [ <span class="org-string">"/share/info"</span> ];
  <span class="org-nix-attribute">postBuild</span> = <span class="org-string">''</span>
<span class="org-string">    shopt -s nullglob</span>
<span class="org-string">    find -L </span><span class="org-nix-antiquote">${</span>myEmacsPackages<span class="org-nix-antiquote">}</span><span class="org-string">/share/emacs/ -name '*.info*' -exec ln -s {} $out/share/info \;</span>
<span class="org-string">    for i in $out/share/info/*.info*; do</span>
<span class="org-string">      install-info $i $out/share/info/dir</span>
<span class="org-string">    done</span>
<span class="org-string">  ''</span>;
};
</pre>
</div>

<p>
Next, we build the man pages. Again, these come from <code>userPackages</code> and are in
the <code>/share/man</code> directory. In addition, some extra man pages are added like the
POSIX man pages, and the C++ stdlib man pages. Other OS-specific ones are also
included where appropriate Linux man pages (<code>man-pages</code>), and the ones from the
Apple SDK.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">manpages</span> = buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"man-pages"</span>;
  <span class="org-nix-attribute">ignoreCollisions</span> = (!(config.bauer.small <span class="org-nix-keyword">or</span> <span class="org-nix-builtin">false</span>));
  <span class="org-nix-attribute">paths</span> = userPackages ++ [pkgs.posix_man_pages
         pkgs.stdman
         <span class="org-comment"># pkgs.llvmPackages.clang-manpages</span>
         <span class="org-comment"># pkgs.llvmPackages.llvm-manpages</span>
         ]
    ++ lib.optional (hostPlatform.isDarwin &amp;&amp; big &amp;&amp; allowUnfree)
         <span class="org-string">"</span><span class="org-nix-antiquote">${</span>apple_sdk<span class="org-nix-antiquote">}</span><span class="org-string">/usr"</span>
    ++ lib.optional hostPlatform.isLinux pkgs.man-pages;
  <span class="org-nix-attribute">extraOutputsToInstall</span> = [ <span class="org-string">"man"</span> <span class="org-string">"doc"</span> <span class="org-string">"devdoc"</span> <span class="org-string">"devman"</span> ];
  <span class="org-nix-attribute">pathsToLink</span> = [ <span class="org-string">"/share/man"</span> ];
};
</pre>
</div>

<p>
Next, build the XDG / FreeDesktop directory paths. These come from
<code>userPackages</code> and include relevnt information for Desktop files, MIME info,
menus, and icons. This updates the caches where appropriate as well. The
location of these directories is defined in the FreeDesktop specification.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">xdg-data</span> = buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"xdg-data-dirs"</span>;
  <span class="org-nix-attribute">buildInputs</span> = [ pkgs.desktop-file-utils pkgs.shared-mime-info ];
  <span class="org-nix-attribute">paths</span> = userPackages ++ [ customEmacsPackages.emacs pkgs.zsh ];
  <span class="org-nix-attribute">pathsToLink</span> = [
    <span class="org-string">"/share/applications"</span>
    <span class="org-string">"/share/mime"</span>
    <span class="org-string">"/share/menus"</span>
    <span class="org-string">"/share/icons"</span>
  ];
  <span class="org-nix-attribute">postBuild</span> = <span class="org-string">''</span>
<span class="org-string">    export XDG_DATA_DIRS=$out/share</span>

<span class="org-string">    if [ -w $out/share/applications ]; then</span>
<span class="org-string">      update-desktop-database $out/share/applications</span>
<span class="org-string">    fi</span>

<span class="org-string">    if [ -w $out/share/mime ] \</span>
<span class="org-string">       &amp;&amp; [ -w $out/share/mime/packages ]; then</span>
<span class="org-string">      update-mime-database -V $out/share/mime</span>
<span class="org-string">    fi</span>
<span class="org-string">  ''</span>;
};
</pre>
</div>

<p>
Next, ZSH completions are built. These all reside in the
<code>$out/share/zsh/site-functions</code> directory.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">zsh-completions</span> = buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"zsh-completions"</span>;
  <span class="org-nix-attribute">paths</span> = [ pkgs.zsh-completions pkgs.nix-zsh-completions ] ++ userPackages;
  <span class="org-nix-attribute">pathsToLink</span> = [ <span class="org-string">"/share/zsh"</span> ];
};
</pre>
</div>

<p>
Next, setup the binary directory. This will be put in the user’s <code>PATH</code>. We also
remove binaries starting with <code>.</code>, as they are used in Nixpkgs for the “wrapped”
version of executables.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">bins</span> = buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"bins"</span>;
  <span class="org-nix-attribute">paths</span> = userPackages;
  <span class="org-nix-attribute">extraOutputsToInstall</span> = [ <span class="org-string">"bin"</span> ];
  <span class="org-nix-attribute">pathsToLink</span> = [ <span class="org-string">"/bin"</span> ];
  <span class="org-nix-attribute">postBuild</span> = <span class="org-string">''</span>
<span class="org-string">    find $out/bin -maxdepth 1 -name ".*" -type l -delete</span>
<span class="org-string">  ''</span>;
};
</pre>
</div>

<p>
Setup the system headers path. This is delibirately light to avoid huge
closures. Right now, only <code>libc</code> and <code>libcxx</code> are included by default.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">sysheaders</span> = buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"headers"</span>;
  <span class="org-nix-attribute">pathsToLink</span> = [ <span class="org-string">"/include"</span> ];
  <span class="org-nix-attribute">extraOutputsToInstall</span> = [ <span class="org-string">"dev"</span> ];
  <span class="org-nix-attribute">paths</span> = [ stdenv.cc.libc ]
    ++ lib.optional hostPlatform.isDarwin pkgs.libcxx
    ++ lib.optional (hostPlatform.isDarwin &amp;&amp; big &amp;&amp; allowUnfree)
        <span class="org-string">"</span><span class="org-nix-antiquote">${</span>apple_sdk<span class="org-nix-antiquote">}</span><span class="org-string">/usr"</span>;
};
</pre>
</div>

<p>
Also setup the Apple framework paths. These are a mix between lib directory and
include directory. This is oinly useful on macOS/Darwin machines.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">apple_sdk</span> = <span class="org-string">"</span><span class="org-nix-antiquote">${</span>pkgs.darwin.xcode<span class="org-nix-antiquote">}</span><span class="org-string">/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk"</span>;
<span class="org-nix-attribute">sysframeworks</span> = buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"frameworks"</span>;
  <span class="org-nix-attribute">paths</span> = lib.optionals (hostPlatform.isDarwin &amp;&amp; big &amp;&amp; allowUnfree)
    [ <span class="org-string">"</span><span class="org-nix-antiquote">${</span>apple_sdk<span class="org-nix-antiquote">}</span><span class="org-string">/System/Library/Frameworks"</span>
      <span class="org-string">"</span><span class="org-nix-antiquote">${</span>apple_sdk<span class="org-nix-antiquote">}</span><span class="org-string">/System/Library/PrivateFrameworks"</span> ];
};
</pre>
</div>

<p>
Setup XML schema needed for editing some docbooks in Emacs. Not entirely sure
why this is necessary, but nXML complains otherwise.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">schemas</span> = writeText <span class="org-string">"schemas.xml"</span> <span class="org-string">''</span>
<span class="org-string">&lt;locatingRules</span>
<span class="org-string">    xmlns="http://thaiopensource.com/ns/locating-rules/1.0"</span>
<span class="org-string">&gt;</span>
<span class="org-string">  &lt;documentElement localName="section" typeId="DocBook"/&gt;</span>
<span class="org-string">  &lt;documentElement localName="chapter" typeId="DocBook"/&gt;</span>
<span class="org-string">  &lt;documentElement localName="article" typeId="DocBook"/&gt;</span>
<span class="org-string">  &lt;documentElement localName="book" typeId="DocBook"/&gt;</span>
<span class="org-string">  &lt;typeId id="DocBook"</span>
<span class="org-string">    uri="</span><span class="org-nix-antiquote">${</span>pkgs.docbook5<span class="org-nix-antiquote">}</span><span class="org-string">/xml/rng/docbook/docbookxi.rnc"</span>
<span class="org-string">  /&gt;</span>
<span class="org-string">&lt;/locatingRules&gt;</span>
<span class="org-string">''</span>;
</pre>
</div>

<p>
Full listing of packages that will be made available.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">userPackages</span> = (<span class="org-nix-keyword">with</span> pkgs; [
  <span class="org-comment"># From common-path.nix</span>
  coreutils findutils diffutils gnused gnugrep gawk gnutar
  gzip bzip2 gnumake bashInteractive patch xz

  <span class="org-comment"># Helpful core tools</span>
  curl zsh cacert file lsof pstree which rsync
  unzip man openssh less calc ag ripgrep
  tree gnutls
] ++ lib.optionals big ([
  <span class="org-comment"># Useful tools</span>
  isync notmuch graphviz indent
  graphviz imagemagick

  bazaar mercurial

  <span class="org-comment"># Programming interpreters/compilers</span>
  myTex rEnv perl python lua coq ocaml
  openjdk nodejs gcc gdb

  travis v8
] ++ (<span class="org-nix-keyword">with</span> netbsd; [ getent getconf ])
  ++ (<span class="org-nix-keyword">with</span> nodePackages; [ tern heroku node2nix ])
  ++ (<span class="org-nix-keyword">with</span> gitAndTools; [ hub ])
  ++ (<span class="org-nix-keyword">with</span> haskellPackages; [ ghc jq nix-diff cabal2nix cabal-install ])
  ++ (<span class="org-nix-keyword">with</span> unixtools; [ utillinux nettools procps ])
));
</pre>
</div>

<p>
Setup global environment variables &amp; directories. Most of the global directories
will not exist, but the way search paths work, means that is okay. We aim to
support all directories in a common system, prioritizing ones that the user has
the most direct access to. Global directories should only contain system paths.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-attribute">global-dirs</span> = [ <span class="org-string">"/nix/var/nix/profiles/default"</span>
    <span class="org-string">"/run/wrappers"</span>
    <span class="org-string">"/run/current-system/sw"</span>
    <span class="org-string">"/usr/local"</span>
    <span class="org-string">"/usr"</span>
    <span class="org-string">""</span> ];

<span class="org-nix-attribute">PATH</span> = lib.concatStringsSep <span class="org-string">":"</span> [
   (lib.makeBinPath ([ bins customEmacsPackages.emacs pkgs.zsh ]
         ++ global-dirs))
   (lib.makeSearchPath <span class="org-string">"sbin"</span> [ <span class="org-string">"/usr"</span> <span class="org-string">""</span> ])
       ];
<span class="org-nix-attribute">MANPATH</span> = <span class="org-string">":"</span> + lib.makeSearchPathOutput <span class="org-string">"man"</span> <span class="org-string">"share/man"</span>
  ([ manpages customEmacsPackages.emacs pkgs.zsh ] ++ global-dirs);
<span class="org-nix-attribute">INFOPATH</span> = <span class="org-string">"</span><span class="org-nix-antiquote">${</span>infopages<span class="org-nix-antiquote">}</span><span class="org-string">/share/info"</span>;
<span class="org-nix-attribute">XDG_DATA_DIRS</span> = lib.makeSearchPathOutput <span class="org-string">"xdg"</span> <span class="org-string">"share"</span>
  ([ xdg-data ] ++ global-dirs);
<span class="org-nix-attribute">TERMINFO_DIRS</span> = lib.makeSearchPathOutput <span class="org-string">"terminfo"</span> <span class="org-string">"share/terminfo"</span>
  ([ pkgs.ncurses ]);

<span class="org-nix-attribute">INPUTRC</span> = builtins.toFile <span class="org-string">"inputrc"</span> <span class="org-string">''</span>
<span class="org-string">  $include /etc/inputrc</span>

<span class="org-string">  "\C-p":history-search-backward</span>
<span class="org-string">  "\C-n":history-search-forward</span>

<span class="org-string">  set colored-stats on</span>
<span class="org-string">  set completion-ignore-case on</span>
<span class="org-string">  set completion-prefix-display-length 3</span>
<span class="org-string">  set mark-symlinked-directories on</span>
<span class="org-string">  set show-all-if-ambiguous on</span>
<span class="org-string">  set show-all-if-unmodified on</span>
<span class="org-string">  set visible-stats on</span>
<span class="org-string">  set editing-mode emacs</span>

<span class="org-string">  Space:magic-space</span>
<span class="org-string">''</span>;
</pre>
</div>

<p>
Finally, build the final environment. This only contains Emacs and ZSH, which
have been configured to use the paths above.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-nix-keyword">in</span> buildEnv {
  <span class="org-nix-attribute">name</span> = <span class="org-string">"bauer-1.5.1"</span>;
  <span class="org-nix-attribute">buildInputs</span> = [ pkgs.makeWrapper pkgs.bash ];
  <span class="org-nix-attribute">postBuild</span> = <span class="org-string">''</span>
<span class="org-string">    mkdir -p $out/etc</span>
<span class="org-string">    substituteAll </span><span class="org-nix-antiquote">${</span><span class="org-nix-constant">./zshrc.sh</span><span class="org-nix-antiquote">}</span><span class="org-string"> $out/etc/.zshrc</span>
<span class="org-string">    substituteInPlace $out/etc/.zshrc \</span>
<span class="org-string">      --subst-var-by completions </span><span class="org-nix-antiquote">${</span>zsh-completions<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">      --subst-var-by coreutils </span><span class="org-nix-antiquote">${</span>pkgs.coreutils<span class="org-nix-antiquote">}</span>
<span class="org-string">    ln -s $out/etc/.zshrc $out/etc/zshrc</span>
<span class="org-string">    makeWrapper </span><span class="org-nix-antiquote">${</span>pkgs.zsh<span class="org-nix-antiquote">}</span><span class="org-string">/bin/zsh $out/bin/zsh --set ZDOTDIR $out/etc</span>
<span class="org-string">    substituteAll </span><span class="org-nix-antiquote">${</span><span class="org-nix-constant">./etc-profile.sh</span><span class="org-nix-antiquote">}</span><span class="org-string"> $out/etc/profile</span>
<span class="org-string">    substituteInPlace $out/etc/profile \</span>
<span class="org-string">      --subst-var-by coreutils </span><span class="org-nix-antiquote">${</span>pkgs.coreutils<span class="org-nix-antiquote">}</span>
<span class="org-string">    substitute </span><span class="org-nix-antiquote">${</span><span class="org-nix-constant">./runemacs.sh</span><span class="org-nix-antiquote">}</span><span class="org-string"> $out/bin/run \</span>
<span class="org-string">      --subst-var-by emacs </span><span class="org-nix-antiquote">${</span>myEmacs<span class="org-nix-antiquote">}</span>
<span class="org-string">    chmod +x $out/bin/run</span>
<span class="org-string">    patchShebangs $out/bin/run</span>
<span class="org-string">    ln -s $out/bin/run $out/bin/bauer</span>
<span class="org-string">  ''</span>;
  <span class="org-nix-attribute">pathsToLink</span> = [
    <span class="org-string">"/bin"</span>
    <span class="org-string">"/etc/profile.d"</span>
    <span class="org-string">"/share/applications"</span>
  ] ++ lib.optional hostPlatform.isDarwin <span class="org-string">"/Applications"</span>;
  <span class="org-nix-attribute">meta</span> = <span class="org-nix-keyword">with</span> lib; {
    <span class="org-nix-attribute">description</span> = <span class="org-string">"Bauer's automated unified Emacs realm"</span>;
    <span class="org-nix-attribute">maintainers</span> = <span class="org-nix-keyword">with</span> maintainers; [ matthewbauer ];
    <span class="org-nix-attribute">platforms</span> = platforms.all;
    <span class="org-nix-attribute">priority</span> = 4;
  };
  <span class="org-nix-attribute">passthru</span> = <span class="org-nix-keyword">with</span> lib; {
    <span class="org-nix-attribute">shellPath</span> = <span class="org-string">"/bin/zsh"</span>;
    <span class="org-nix-attribute">run</span> = <span class="org-string">"/bin/run"</span>;
    <span class="org-nix-attribute">sourceFile</span> = <span class="org-string">"/etc/profile.d/profile"</span>;
    <span class="org-nix-attribute">PATH</span> = makeSearchPath <span class="org-string">"bin"</span> [bins];
    <span class="org-nix-attribute">MANPATH</span> = makeSearchPath <span class="org-string">"share/man"</span> [manpages];
    <span class="org-nix-attribute">INFOPATH</span> = makeSearchPath <span class="org-string">"share/info"</span> [infopages];
    <span class="org-nix-attribute">XDG_DATA_DIRS</span> = makeSearchPath <span class="org-string">"share"</span> [xdg-data];
    <span class="org-nix-attribute">TERMINFO_DIRS</span> = makeSearchPath <span class="org-string">"share/terminfo"</span> [terminfo];
  };
  <span class="org-nix-attribute">paths</span> = [
    myEmacs
    (runCommand <span class="org-string">"my-profile"</span> {
      <span class="org-nix-attribute">emacs</span> = myEmacs;
      <span class="org-nix-keyword">inherit</span> (pkgs) cacert;
      <span class="org-nix-keyword">inherit</span> PATH MANPATH XDG_DATA_DIRS INFOPATH TERMINFO_DIRS;
    } <span class="org-string">''</span>
<span class="org-string">      mkdir -p $out/etc/profile.d</span>
<span class="org-string">      substituteAll </span><span class="org-nix-antiquote">${</span><span class="org-nix-constant">./profile.sh</span><span class="org-nix-antiquote">}</span><span class="org-string"> $out/etc/profile.d/my-profile.sh</span>
<span class="org-string">      substituteInPlace $out/etc/profile.d/my-profile.sh \</span>
<span class="org-string">  --subst-var-by PATH </span><span class="org-nix-antiquote">${</span>PATH<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">  --subst-var-by INFOPATH </span><span class="org-nix-antiquote">${</span>INFOPATH<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">  --subst-var-by MANPATH </span><span class="org-nix-antiquote">${</span>MANPATH<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">  --subst-var-by XDG_DATA_DIRS </span><span class="org-nix-antiquote">${</span>XDG_DATA_DIRS<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">  --subst-var-by TERMINFO_DIRS </span><span class="org-nix-antiquote">${</span>TERMINFO_DIRS<span class="org-nix-antiquote">}</span><span class="org-string"> \</span>
<span class="org-string">  --subst-var-by INPUTRC </span><span class="org-nix-antiquote">${</span>INPUTRC<span class="org-nix-antiquote">}</span>
<span class="org-string">    ''</span>)
    pkgs.git
  ];
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org99fbe76" class="outline-3">
<h3 id="org99fbe76">Invoking it</h3>
<div class="outline-text-3" id="text-org99fbe76">
<p>
We can build it with <code>nix-build</code>.
</p>

<div class="org-src-container">
<pre class="src src-shell">nix-build
./result/bin/run
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb318688" class="outline-2">
<h2 id="ci">Continuous integration</h2>
<div class="outline-text-2" id="text-ci">
<a href="https://travis-ci.org/matthewbauer/bauer">
  <img src="https://travis-ci.org/matthewbauer/bauer.svg?branch=master" alt="travis status"></img>
</a>

<p>
We&rsquo;ll set up Travis support here. We start by configuring <code>.travis.yml</code>.
</p>
</div>

<div id="outline-container-org02d8c41" class="outline-3">
<h3 id="travis"><code>.travis.yml</code></h3>
<div class="outline-text-3" id="text-travis">
<div class="org-src-container">
<pre class="src src-yaml">language: nix
</pre>
</div>

<p>
Next we&rsquo;ll set up nix-build &amp; pass the URL of Nixpkgs with the <code>NIXPKGS</code>.
</p>

<div class="org-src-container">
<pre class="src src-yaml">script:
  - nix-build -Q --argstr channel $CHANNEL
</pre>
</div>

<p>
Setup the OSs. Sadly no Windows support yet.
</p>

<div class="org-src-container">
<pre class="src src-yaml">git:
  depth: 1
</pre>
</div>

<p>
Setup some values for <code>NIXPKGS</code> variables.
</p>

<div class="org-src-container">
<pre class="src src-yaml">matrix:
  include:
    - os: linux
      dist: trusty
      env: CHANNEL=nixos-19.03
    - os: linux
      dist: trusty
      env: CHANNEL=nixos-19.09
    - os: linux
      dist: trusty
      env: CHANNEL=nixos-20.03
    - os: linux
      dist: trusty
      env: CHANNEL=nixos-unstable
    - os: osx
      env: CHANNEL=nixpkgs-19.03-darwin
    - os: osx
      env: CHANNEL=nixpkgs-19.09-darwin
    - os: osx
      env: CHANNEL=nixpkgs-20.03-darwin
    - os: osx
      env: CHANNEL=nixpkgs-unstable
</pre>
</div>

<p>
Setup the cache.
</p>

<div class="org-src-container">
<pre class="src src-yaml">cache:
  directories:
    - /nix/store
</pre>
</div>

<p>
Turn off those annoying Travis notifications.
</p>

<div class="org-src-container">
<pre class="src src-yaml">notifications:
  email: false
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbd6d6d6" class="outline-2">
<h2 id="extra">Extra</h2>
<div class="outline-text-2" id="text-extra">
<p>
These are some extra files that are checked in. They mostly deal with
maintainence and advanced usage of BAUER.
</p>
</div>

<div id="outline-container-org58c4ecf" class="outline-3">
<h3 id="org58c4ecf"><code>update.sh</code></h3>
<div class="outline-text-3" id="text-org58c4ecf">
<p>
This is a simple script that I use to make sure I&rsquo;ve updated the generated
files. It runs ORG mode tangler and then exports README.org to html.
</p>

<div class="org-src-container">
<pre class="src src-shell">emacs --batch <span class="org-sh-escaped-newline">\</span>
      -l ob-tangle <span class="org-sh-escaped-newline">\</span>
      --eval <span class="org-string">"(org-babel-tangle-file \"README.org\")"</span>
emacs README.org --batch <span class="org-sh-escaped-newline">\</span>
  --eval <span class="org-string">"(setq org-html-htmlize-output-type 'css)"</span> <span class="org-sh-escaped-newline">\</span>
  -l nix-mode <span class="org-sh-escaped-newline">\</span>
  -f org-html-export-to-html
</pre>
</div>
</div>
</div>
<div id="outline-container-org67d60fb" class="outline-3">
<h3 id="org67d60fb"><code>.gitignore</code></h3>
<div class="outline-text-3" id="text-org67d60fb">
<p>
If you end up with generated files, they’re easy to remove with Git. Just run
<code>git clean -xdf</code> &amp; it will remove all of the files that match the .gitignore
rules (which should never be added to the git tree).
</p>

<p>
These set up some paths for <code>.gitignore</code> that we don’t want getting put in
the repo. Start with Emacs/org-mode/LaTeX stuff.
</p>

<div class="org-src-container">
<pre class="src src-gitignore">flycheck_*.el
*.elc
*.pdf
*.html
*.tex
*.log
*.aux
*.out
*.toc
</pre>
</div>

<p>
Nix-related stuff. These are generate by <code>nix-build</code>.
</p>

<div class="org-src-container">
<pre class="src src-gitignore">result
result-*
</pre>
</div>

<p>
These are all tangled by <a href="./README.html">README.org</a>.
</p>

<div class="org-src-container">
<pre class="src src-gitignore">README.el
bauer.nix
zshrc.sh
etc-profile.sh
runemacs.sh
gitconfig
gitignore
default.el
profile.sh
site-paths.el.in
org-init.el
org-src-*
configuration.nix
install
auto/
*~
</pre>
</div>
</div>
</div>

<div id="outline-container-org69868c9" class="outline-3">
<h3 id="org69868c9"><code>.gitattributes</code></h3>
<div class="outline-text-3" id="text-org69868c9">
<p>
Mark generated files.
</p>

<div class="org-src-container">
<pre class="src src-gitattributes">.gitattributes linguist-generated=true
.gitignore     linguist-generated=true
.travis.yml    linguist-generated=true
LICENSE        linguist-generated=true
bootstrap.sh   linguist-generated=true
config.nix     linguist-generated=true
default.nix    linguist-generated=true
deploy.sh      linguist-generated=true
gist-unpack.sh linguist-generated=true
init.el        linguist-generated=true
install        linguist-generated=true
module.nix     linguist-generated=true
nixos.nix      linguist-generated=true
update.sh      linguist-generated=true
</pre>
</div>
</div>
</div>
<div id="outline-container-org8b8ccf3" class="outline-3">
<h3 id="org8b8ccf3"><code>init.el</code></h3>
<div class="outline-text-3" id="text-org8b8ccf3">
<p>
You can use this as part of <a href="file:///Users/mbauer/.emacs.d/init.el">your Emacs init file</a>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(load
  (expand-file-name <span class="org-string">"settings.el"</span> user-emacs-directory) t)
(package-initialize)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">bauer-dir</span>
        (expand-file-name <span class="org-string">".emacs.d"</span> (getenv <span class="org-string">"HOME"</span>)))
(<span class="org-keyword">defvar</span> <span class="org-variable-name">bauer-org</span>
        (expand-file-name <span class="org-string">"README.org"</span> bauer-dir))
(add-to-list 'load-path
             (expand-file-name <span class="org-string">"site-lisp"</span> bauer-dir))
(<span class="org-keyword">unless</span> (file-exists-p
          (expand-file-name <span class="org-string">"README.el"</span> bauer-dir))
  (<span class="org-keyword">let</span> ((default-directory bauer-dir))
    (autoload 'org-babel-tangle-file <span class="org-string">"ob-tangle"</span>)
    (org-babel-tangle-file bauer-org
                          <span class="org-string">"README.el"</span>
                          <span class="org-string">"emacs-lisp"</span>)))
(load (expand-file-name <span class="org-string">"README.el"</span> bauer-dir) t)
</pre>
</div>

<p>
This will boot the IDE. Note that this is done for you in the Nix-based
installation process. The above script should be used in places where Nix is
unavailable.
</p>
</div>
</div>

<div id="outline-container-org4388206" class="outline-3">
<h3 id="org4388206">NixOS module</h3>
<div class="outline-text-3" id="text-org4388206">
<p>
I’ve provided a module suitable for use with a NixOS configuration. To use it,
just add something like the following to your configuration.nix file.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-comment-delimiter"># </span><span class="org-comment">-*- mode: nix; coding: utf-8; -*-</span>
{ ... }:
{
  <span class="org-nix-attribute">imports</span> = [
    (builtins.fetchurl <span class="org-string">"https://matthewbauer.us/bauer/module.nix"</span>)
  ];
  <span class="org-nix-attribute">programs.bauer.enable</span> = <span class="org-nix-builtin">true</span>;
}
</pre>
</div>

<p>
The actual module implementation follow here. It will pull in some files needed
for all of this to work. It should provide ‘bauer’ as a runnable command.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-comment-delimiter"># </span><span class="org-comment">-*- mode: nix; coding: utf-8; -*-</span>
{ config, lib, pkgs, ... }: <span class="org-nix-keyword">with</span> lib;

<span class="org-nix-keyword">let</span>
  <span class="org-nix-attribute">ensure</span> = f: n: <span class="org-nix-keyword">if</span> builtins.pathExists f <span class="org-nix-keyword">then</span> f
     <span class="org-nix-keyword">else</span> builtins.fetchurl
    <span class="org-string">"https://matthewbauer.us/bauer/</span><span class="org-nix-antiquote">${</span>n<span class="org-nix-antiquote">}</span>";
  <span class="org-nix-attribute">bauer</span> = <span class="org-nix-builtin">import</span> (ensure <span class="org-nix-constant">./default.nix</span> <span class="org-string">"default.nix"</span>) {
    <span class="org-nix-keyword">inherit</span> pkgs;
  };
<span class="org-nix-keyword">in</span> {
  <span class="org-nix-attribute">options</span> = {
    <span class="org-nix-attribute">programs.bauer</span> = {
      <span class="org-nix-attribute">enable</span> = mkOption {
  <span class="org-nix-attribute">default</span> = <span class="org-nix-builtin">false</span>;
  <span class="org-nix-attribute">type</span> = types.bool;
      };
    };
  };

  <span class="org-nix-attribute">config</span> = mkIf config.programs.bauer.enable {
    <span class="org-nix-attribute">environment</span> = {
      <span class="org-nix-attribute">systemPackages</span> = [ bauer ];
      <span class="org-nix-attribute">variables</span> = <span class="org-nix-keyword">with</span> lib; {
  <span class="org-nix-attribute">PATH</span> = [bauer.PATH];
  <span class="org-nix-attribute">XDG_DATA_DIRS</span> = [bauer.XDG_DATA_DIRS];
  <span class="org-nix-attribute">TERMINFO_DIRS</span> = [bauer.TERMINFO_DIRS];
  <span class="org-nix-attribute">MANPATH</span> = [bauer.MANPATH];
  <span class="org-nix-attribute">INFOPATH</span> = [bauer.INFOPATH];
      };
    };
  };
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbbe7aaf" class="outline-3">
<h3 id="orgbbe7aaf">NixOS virtualbox &amp; installer</h3>
<div class="outline-text-3" id="text-orgbbe7aaf">
<p>
Use this to build a .ova file for demonstration purposes. This file can be
booted by VirtualBox. Useful for Windows users especially.
</p>

<div class="org-src-container">
<pre class="src src-nix"><span class="org-comment-delimiter"># </span><span class="org-comment">-*- mode: nix; coding: utf-8; -*-</span>
{ system ? builtins.currentSystem }:
<span class="org-nix-keyword">let</span>
  <span class="org-nix-attribute">ensure</span> = f: n: <span class="org-nix-keyword">if</span> builtins.pathExists f <span class="org-nix-keyword">then</span> f
     <span class="org-nix-keyword">else</span> builtins.fetchurl
    <span class="org-string">"https://matthewbauer.us/bauer/</span><span class="org-nix-antiquote">${</span>n<span class="org-nix-antiquote">}</span>";
<span class="org-nix-keyword">in</span> {
  <span class="org-nix-attribute">ova</span> = (<span class="org-nix-builtin">import</span> &lt;<span class="org-nix-constant">nixpkgs/nixos/lib/eval-config.nix</span>&gt; {
    <span class="org-nix-keyword">inherit</span> system;
    <span class="org-nix-attribute">modules</span> = [
      &lt;<span class="org-nix-constant">nixpkgs/nixos/modules/installer/virtualbox-demo.nix</span>&gt;
      (ensure <span class="org-nix-constant">./module.nix</span> <span class="org-string">"module.nix"</span>)
    ];
  }).config.system.build.virtualBoxOVA;
  <span class="org-nix-attribute">iso</span> = (<span class="org-nix-builtin">import</span> &lt;<span class="org-nix-constant">nixpkgs/nixos/lib/eval-config.nix</span>&gt; {
    <span class="org-nix-keyword">inherit</span> system;
    <span class="org-nix-attribute">modules</span> = [
      &lt;<span class="org-nix-constant">nixpkgs/nixos/modules/installer/cd-dvd/installation-cd-graphical-kde.nix</span>&gt;
      (ensure <span class="org-nix-constant">./module.nix</span> <span class="org-string">"module.nix"</span>)
    ];
  }).config.system.build.isoImage;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org72f911d" class="outline-3">
<h3 id="org72f911d">Deploy script</h3>
<div class="outline-text-3" id="text-org72f911d">
<p>
I use this script to deploy to the gh-pages branch. It merges master into
gh-pages and then runs ORG mode tangle and export. Unfortunately, merge
conflicts are not handled, and must be dealt with manually.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-function-name">setup</span>() {
  git stash push
  git checkout gh-pages
}

<span class="org-function-name">cleanup</span>() {
  git checkout master
  git stash pop
}

setup
<span class="org-keyword">trap</span> cleanup EXIT

git fetch origin
git reset --hard origin/gh-pages
git merge --no-edit master
./update.sh
git add .
git commit -m <span class="org-string">"Regen"</span>
git push origin gh-pages
</pre>
</div>
</div>
</div>
<div id="outline-container-orgea797ca" class="outline-3">
<h3 id="orgea797ca">Gist script</h3>
<div class="outline-text-3" id="text-orgea797ca">
<p>
Private file handling for new environments. Unpack private files from a Gist
into your environment. Must have already setup SSH GitHub authentication. To set
up GitHub SSH run:
</p>

<div class="org-src-container">
<pre class="src src-shell">$ ssh-keygen
</pre>
</div>

<p>
Then, add <code>$HOME/.ssh/id_rsa</code>.pub through GitHub’s Web UI. Invoke the script
with:
</p>

<div class="org-src-container">
<pre class="src src-shell">$ ./gist-unpack.sh 862843ce9216abda0b10e1d753ce9d0f
</pre>
</div>

<p>
Files that can be included in the gist are:
</p>

<ul class="org-ul">
<li>.authinfo: stores your passwords and credentials. Domains like smtp.gmail.com,
api.github.com, and irc.freenode.net require credentials.</li>
<li>.gitconfig: stores your personal Git configuration and settings. Things like
user.email, user.name, github.user should go here. Unfortunately, it also may
have credentials for smtpmail. Ideally these would be put in .authinfo to
avoid mixing secrets. See <a href="https://lists.gnu.org/archive/html/guix-devel/2018-04/msg00254.html">this thread</a> for more info.</li>
<li>.sshconfig: stores your SSH configuration corresponding to .ssh/config. Put
global host names and relates settings here.</li>
<li>settings.el: store your personal Emacs configurations. Settings like
<code>erc-nick</code>, <code>message-send-mail-function</code>, <code>send-mail-function</code>,
<code>smtpmail-smtp-server</code>, <code>smtpmail-smtp-service</code>, <code>user-full-name</code>, and
<code>user-mail-address</code> should go here.</li>
</ul>

<p>
The actual script follows. The main idea is just to download all of the files
from the Gist and copy them to the <code>$HOME</code> directory. <code>--force</code> can be passed to
allow overriding your current <code>$HOME</code> files.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -eq 0 ]; <span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> Usage: <span class="org-string">"$0"</span> GIST_ID &gt;&amp;2
    <span class="org-keyword">exit</span> 1
<span class="org-keyword">fi</span>

<span class="org-variable-name">FORCE</span>=
<span class="org-variable-name">GIST_ID</span>=
<span class="org-keyword">while</span> [ $<span class="org-variable-name">#</span> -gt 0 ]; <span class="org-keyword">do</span>
    <span class="org-keyword">case</span> <span class="org-string">"$1"</span><span class="org-keyword"> in</span>
        -f|--force)
            <span class="org-builtin">echo</span> Forcing install... &gt;&amp;2
            <span class="org-variable-name">FORCE</span>=1
            <span class="org-builtin">shift</span>
            ;;
        *)
            <span class="org-keyword">if</span> [ -n <span class="org-string">"${GIST_ID-}"</span> ]; <span class="org-keyword">then</span>
                <span class="org-builtin">echo</span> Multiple Gist ids passed! &gt;&amp;2
                <span class="org-keyword">exit</span> 1
            <span class="org-keyword">fi</span>
            <span class="org-variable-name">GIST_ID</span>=<span class="org-string">"$1"</span>
            <span class="org-builtin">echo</span> Using gist <span class="org-string">"$GIST_ID"</span>x &gt;&amp;2
            <span class="org-builtin">shift</span>
            ;;
    <span class="org-keyword">esac</span>
<span class="org-keyword">done</span>

<span class="org-keyword">if</span> [ -z <span class="org-string">"$GIST_ID"</span> ]; <span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> No gist id provided. &gt;&amp;2
    <span class="org-keyword">exit</span> 1
<span class="org-keyword">fi</span>

<span class="org-variable-name">gistdir</span>=<span class="org-string">"$(mktemp -d)"</span>
<span class="org-function-name">setup</span>() {
    git clone git@github.com:<span class="org-string">"$GIST_ID"</span>.git <span class="org-string">"$gistdir"</span>
    <span class="org-builtin">pushd</span> <span class="org-string">"$gistdir"</span> &gt;/dev/null
}

<span class="org-function-name">cleanup</span>() {
    <span class="org-builtin">popd</span> &gt;/dev/null
    rm -rf <span class="org-string">"$gistdir"</span>
}

setup
<span class="org-keyword">trap</span> cleanup EXIT

<span class="org-keyword">if</span> [ -n <span class="org-string">"${BASH_VERSION-}"</span> ]; <span class="org-keyword">then</span>
    shopt -s dotglob
<span class="org-keyword">fi</span>
<span class="org-keyword">for</span> f<span class="org-keyword"> in</span> *; <span class="org-keyword">do</span>
    <span class="org-keyword">if</span> [ <span class="org-string">"$f"</span> = <span class="org-string">".git"</span> ]; <span class="org-keyword">then</span>
        <span class="org-keyword">continue</span>
    <span class="org-keyword">fi</span>
    <span class="org-keyword">if</span> <span class="org-negation-char">!</span> [ -f <span class="org-string">"$f"</span> ]; <span class="org-keyword">then</span>
        <span class="org-builtin">echo</span> Skipping <span class="org-string">"$f"</span>, not a file &gt;&amp;2
        <span class="org-keyword">continue</span>
    <span class="org-keyword">fi</span>
    <span class="org-variable-name">DEST</span>=
    <span class="org-keyword">case</span> <span class="org-string">"$f"</span><span class="org-keyword"> in</span>
        settings.el) <span class="org-variable-name">DEST</span>=<span class="org-string">"$HOME/.emacs.d/settings.el"</span> ;;
        .sshconfig) <span class="org-variable-name">DEST</span>=<span class="org-string">"$HOME/.ssh/config"</span> ;;
        .ssh_authorized_keys) <span class="org-variable-name">DEST</span>=<span class="org-string">"$HOME/.ssh/authorized_keys"</span> ;;
        nix.conf) <span class="org-variable-name">DEST</span>=<span class="org-string">"$HOME/.config/nix/nix.conf"</span> ;;
        .gitignore) <span class="org-variable-name">DEST</span>=<span class="org-string">"$HOME/.config/git/ignore"</span> ;;
        .gitconfig) <span class="org-variable-name">DEST</span>=<span class="org-string">"$HOME/.config/git/config"</span> ;;
        *) <span class="org-variable-name">DEST</span>=<span class="org-string">"$HOME/$f"</span> ;;
    <span class="org-keyword">esac</span>
    <span class="org-variable-name">CONCAT</span>=
    <span class="org-keyword">case</span> <span class="org-string">"$f"</span><span class="org-keyword"> in</span>
        .authinfo) <span class="org-variable-name">CONCAT</span>=1 ;;
        .sshconfig) <span class="org-variable-name">CONCAT</span>=1 ;;
        .ssh_authorized_keys) <span class="org-variable-name">CONCAT</span>=1 ;;
        .gitignore) <span class="org-variable-name">CONCAT</span>=1 ;;
        nix.conf) <span class="org-variable-name">CONCAT</span>=1 ;;
    <span class="org-keyword">esac</span>
    <span class="org-keyword">if</span> [ -z <span class="org-string">"$DEST"</span> ]; <span class="org-keyword">then</span>
        <span class="org-builtin">echo</span> Skipping <span class="org-string">"$f"</span>, no destination found &gt;&amp;2
        <span class="org-keyword">continue</span>
    <span class="org-keyword">fi</span>
    <span class="org-keyword">if</span> [ -f <span class="org-string">"$DEST"</span> ] &amp;&amp; [ -z <span class="org-string">"$FORCE"</span> ] &amp;&amp; [ -z <span class="org-string">"$CONCAT"</span> ]; <span class="org-keyword">then</span>
        <span class="org-builtin">echo</span> Skipping <span class="org-string">"$f"</span>, destination already exists &gt;&amp;2
        <span class="org-keyword">continue</span>
    <span class="org-keyword">fi</span>
    mkdir -p <span class="org-string">"$(dirname "$DEST")"</span>
    <span class="org-keyword">if</span> [ -n <span class="org-string">"$CONCAT"</span> ]; <span class="org-keyword">then</span>
        cat <span class="org-string">"$f"</span> &gt;&gt; <span class="org-string">"$DEST"</span>
    <span class="org-keyword">else</span>
        cp <span class="org-string">"$f"</span> <span class="org-string">"$DEST"</span>
    <span class="org-keyword">fi</span>
    <span class="org-keyword">if</span> [ <span class="org-string">"$f"</span> = .authinfo ]; <span class="org-keyword">then</span>
        chmod 600 <span class="org-string">"$DEST"</span>
    <span class="org-keyword">fi</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org83e1fb3" class="outline-3">
<h3 id="org83e1fb3">LICENSE</h3>
<div class="outline-text-3" id="text-org83e1fb3">
<p>
Copyright © 2018-2020 Matthew Bauer
</p>

<p>
This program is free software: you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.
</p>

<p>
This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
details.
</p>

<p>
You should have received a copy of the GNU General Public License along with
this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Matthew Bauer</p>
<p class="email">Email: <a href="mailto:mjbauer95@gmail.com">mjbauer95@gmail.com</a></p>
<p class="date">Created: 2020-07-23 Thu 16:19</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.3)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
